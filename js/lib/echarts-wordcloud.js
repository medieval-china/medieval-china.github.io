"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e(require("echarts")):"function"==typeof define&&define.amd?define(["echarts"],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?exports["echarts-wordcloud"]=e(require("echarts")):t["echarts-wordcloud"]=e(t.echarts)}(self,function(e){return function(){var a={"./index.js":function(t,e,a){a.r(e);var m=a("echarts/lib/echarts");m.extendSeriesModel({type:"series.wordCloud",visualStyleAccessPath:"textStyle",visualStyleMapper:function(t){return{fill:t.get("color")}},visualDrawType:"fill",optionUpdated:function(){var t=this.option;t.gridSize=Math.max(Math.floor(t.gridSize),4)},getInitialData:function(t,e){var a=m.helper.createDimensions(t.data,{coordDimensions:["value"]}),o=new m.List(a,this);return o.initData(t.data),o},defaultOption:{maskImage:null,shape:"circle",left:"center",top:"center",width:"70%",height:"80%",sizeRange:[12,60],rotationRange:[-90,90],rotationStep:45,gridSize:8,drawOutOfBound:!1,textStyle:{fontWeight:"normal"}}}),m.extendChartView({type:"wordCloud",render:function(s,t,e){var l=this.group;l.removeAll();var d=s.getData(),u=s.get("gridSize");s.layoutInstance.ondraw=function(t,e,a,o){var n=d.getItemModel(a),i=n.getModel("textStyle"),r=new m.graphic.Text({style:m.helper.createTextStyle(i),scaleX:1/o.info.mu,scaleY:1/o.info.mu,x:(o.gx+o.info.gw/2)*u,y:(o.gy+o.info.gh/2)*u,rotation:o.rot});r.setStyle({x:o.info.fillTextOffsetX,y:o.info.fillTextOffsetY+.5*e,text:t,verticalAlign:"middle",fill:d.getItemVisual(a,"style").fill,fontSize:e}),l.add(r),d.setItemGraphicEl(a,r),r.ensureState("emphasis").style=m.helper.createTextStyle(n.getModel(["emphasis","textStyle"]),{state:"emphasis"}),r.ensureState("blur").style=m.helper.createTextStyle(n.getModel(["blur","textStyle"]),{state:"blur"}),m.helper.enableHoverEmphasis(r,n.get(["emphasis","focus"]),n.get(["emphasis","blurScope"])),r.stateTransition={duration:s.get("animation")?s.get(["stateAnimation","duration"]):0,easing:s.get(["stateAnimation","easing"])},r.__highDownDispatcher=!0},this._model=s},remove:function(){this.group.removeAll(),this._model.layoutInstance.dispose()},dispose:function(){this._model.layoutInstance.dispose()}}),window.setImmediate||(window.setImmediate=window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var a=[void 0],o="zero-timeout-message";return window.addEventListener("message",function(t){if("string"==typeof t.data&&t.data.substr(0,o.length)===o){t.stopImmediatePropagation();var e=parseInt(t.data.substr(o.length),36);a[e]&&(a[e](),a[e]=void 0)}},!0),window.clearImmediate=function(t){a[t]&&(a[t]=void 0)},function(t){var e=a.length;return a.push(t),window.postMessage(o+e.toString(36),"*"),e}}()||function(t){window.setTimeout(t,0)}),window.clearImmediate||(window.clearImmediate=window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)});var s=function(){var t=document.createElement("canvas");if(!t||!t.getContext)return!1;var e=t.getContext("2d");return!!e.getImageData&&(!!e.fillText&&(!!Array.prototype.some&&!!Array.prototype.push))}(),L=function(){if(s){for(var t,e,a=document.createElement("canvas").getContext("2d"),o=20;o;){if(a.font=o.toString(10)+"px sans-serif",a.measureText("Ｗ").width===t&&a.measureText("m").width===e)return o+1;t=a.measureText("Ｗ").width,e=a.measureText("m").width,o--}return 0}}(),W=function(t){for(var e,a,o=t.length;o;e=Math.floor(Math.random()*o),a=t[--o],t[o]=t[e],t[e]=a);return t},o=function(v,t){if(s){Array.isArray(v)||(v=[v]),v.forEach(function(t,e){if("string"==typeof t){if(v[e]=document.getElementById(t),!v[e])throw"The element id specified is not found."}else if(!t.tagName&&!t.appendChild)throw"You must pass valid HTML elements, or ID of the element."});var C={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,layoutAnimation:!0,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationStep:.1,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null};if(t)for(var e in t)e in C&&(C[e]=t[e]);if("function"!=typeof C.weightFactor){var a=C.weightFactor;C.weightFactor=function(t){return t*a}}if("function"!=typeof C.shape)switch(C.shape){case"circle":default:C.shape="circle";break;case"cardioid":C.shape=function(t){return 1-Math.sin(t)};break;case"diamond":case"square":C.shape=function(t){var e=t%(2*Math.PI/4);return 1/(Math.cos(e)+Math.sin(e))};break;case"triangle-forward":C.shape=function(t){var e=t%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"triangle":case"triangle-upright":C.shape=function(t){var e=(t+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"pentagon":C.shape=function(t){var e=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(e)+.726543*Math.sin(e))};break;case"star":C.shape=function(t){var e=(t+.955)%(2*Math.PI/10);return 0<=(t+.955)%(2*Math.PI/5)-2*Math.PI/10?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}C.gridSize=Math.max(Math.floor(C.gridSize),4);var p,w,y,x,M,S,b,E=C.gridSize,i=E-C.maskGapWidth,c=Math.abs(C.maxRotation-C.minRotation),h=Math.min(C.maxRotation,C.minRotation),m=C.rotationStep;switch(C.color){case"random-dark":b=function(){return n(10,50)};break;case"random-light":b=function(){return n(50,90)};break;default:"function"==typeof C.color&&(b=C.color)}var I=null;"function"==typeof C.classes&&(I=C.classes);var T,k=!1,O=[],o=function(t){var e,a,o=t.currentTarget,n=o.getBoundingClientRect();a=t.touches?(e=t.touches[0].clientX,t.touches[0].clientY):(e=t.clientX,t.clientY);var i=e-n.left,r=a-n.top,s=Math.floor(i*(o.width/n.width||1)/E),l=Math.floor(r*(o.height/n.height||1)/E);return O[s][l]},P=function(t){var e=o(t);T!==e&&((T=e)?C.hover(e.item,e.dimension,t):C.hover(void 0,void 0,t))},D=function(t){var e=o(t);e&&(C.click(e.item,e.dimension,t),t.preventDefault())},r=[],g=function(t){if(r[t])return r[t];var e=8*t,a=e,o=[];for(0===t&&o.push([x[0],x[1],0]);a--;){var n=1;"circle"!==C.shape&&(n=C.shape(a/e*2*Math.PI)),o.push([x[0]+t*n*Math.cos(-a/e*2*Math.PI),x[1]+t*n*Math.sin(-a/e*2*Math.PI)*C.ellipticity,a/e*2*Math.PI])}return r[t]=o},R=function(){return 0<C.abortThreshold&&(new Date).getTime()-S>C.abortThreshold},A=function(t,e,a,o,n){if(!(w<=t||y<=e||t<0||e<0)){if(p[t][e]=!1,a)v[0].getContext("2d").fillRect(t*E,e*E,i,i);k&&(O[t][e]={item:n,dimension:o})}},z=function(o){var n,i,r;Array.isArray(o)?(n=o[0],i=o[1]):(n=o.word,i=o.weight,r=o.attributes);var s=0===C.rotateRatio?0:Math.random()>C.rotateRatio?0:0===c?h:h+Math.round(Math.random()*c/m)*m,l=function(t,e,a){var o=C.weightFactor(e);if(o<=C.minSize)return!1;var n=1;o<L&&(n=function(){for(var t=2;t*o<L;)t+=2;return t}());var i=document.createElement("canvas"),r=i.getContext("2d",{willReadFrequently:!0});r.font=C.fontWeight+" "+(o*n).toString(10)+"px "+C.fontFamily;var s=r.measureText(t).width/n,l=Math.max(o*n,r.measureText("m").width,r.measureText("Ｗ").width)/n,d=s+2*l,u=3*l,f=Math.ceil(d/E),c=Math.ceil(u/E);d=f*E,u=c*E;var h=-s/2,m=.4*-l,g=Math.ceil((d*Math.abs(Math.sin(a))+u*Math.abs(Math.cos(a)))/E),p=Math.ceil((d*Math.abs(Math.cos(a))+u*Math.abs(Math.sin(a)))/E),v=p*E,w=g*E;i.setAttribute("width",v),i.setAttribute("height",w),r.scale(1/n,1/n),r.translate(v*n/2,w*n/2),r.rotate(-a),r.font=C.fontWeight+" "+(o*n).toString(10)+"px "+C.fontFamily,r.fillStyle="#000",r.textBaseline="middle",r.fillText(t,h*n,(m+.5*o)*n);var y=r.getImageData(0,0,v,w).data;if(R())return!1;for(var x,M,S,b=[],I=p,T=[g/2,p/2,g/2,p/2];I--;)for(x=g;x--;){S=E;t:for(;S--;)for(M=E;M--;)if(y[4*((x*E+S)*v+(I*E+M))+3]){b.push([I,x]),I<T[3]&&(T[3]=I),I>T[1]&&(T[1]=I),x<T[0]&&(T[0]=x),x>T[2]&&(T[2]=x);break t}}return{mu:n,occupied:b,bounds:T,gw:p,gh:g,fillTextOffsetX:h,fillTextOffsetY:m,fillTextWidth:s,fillTextHeight:l,fontSize:o}}(n,i,s);if(!l)return!1;if(R())return!1;if(!C.drawOutOfBound){var t=l.bounds;if(t[1]-t[3]+1>w||t[2]-t[0]+1>y)return!1}for(var d=M+1,e=function(t){var e=Math.floor(t[0]-l.gw/2),a=Math.floor(t[1]-l.gh/2);l.gw,l.gh;return!!function(t,e,a,o,n){for(var i=n.length;i--;){var r=t+n[i][0],s=e+n[i][1];if(w<=r||y<=s||r<0||s<0){if(!C.drawOutOfBound)return!1}else if(!p[r][s])return!1}return!0}(e,a,0,0,l.occupied)&&(function(l,d,u,f,t,e,a,c,h){var m,g,p=u.fontSize;m=b?b(f,t,p,e,a):C.color,g=I?I(f,t,p,e,a):C.classes;var o=u.bounds;o[3],o[0],o[1],o[3],o[2],o[0],v.forEach(function(t){if(t.getContext){var e=t.getContext("2d"),a=u.mu;e.save(),e.scale(1/a,1/a),e.font=C.fontWeight+" "+(p*a).toString(10)+"px "+C.fontFamily,e.fillStyle=m,e.translate((l+u.gw/2)*E*a,(d+u.gh/2)*E*a),0!==c&&e.rotate(-c),e.textBaseline="middle",e.fillText(f,u.fillTextOffsetX*a,(u.fillTextOffsetY+.5*p)*a),e.restore()}else{var o=document.createElement("span"),n="";n="rotate("+-c/Math.PI*180+"deg) ",1!==u.mu&&(n+="translateX(-"+u.fillTextWidth/4+"px) scale("+1/u.mu+")");var i={position:"absolute",display:"block",font:C.fontWeight+" "+p*u.mu+"px "+C.fontFamily,left:(l+u.gw/2)*E+u.fillTextOffsetX+"px",top:(d+u.gh/2)*E+u.fillTextOffsetY+"px",width:u.fillTextWidth+"px",height:u.fillTextHeight+"px",lineHeight:p+"px",whiteSpace:"nowrap",transform:n,webkitTransform:n,msTransform:n,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};for(var r in m&&(i.color=m),o.textContent=f,i)o.style[r]=i[r];if(h)for(var s in h)o.setAttribute(s,h[s]);g&&(o.className+=g),t.appendChild(o)}})}(e,a,l,n,i,M-d,t[2],s,r),function(t,e,a,o,n,i){var r,s,l=n.occupied,d=C.drawMask;if(d&&((r=v[0].getContext("2d")).save(),r.fillStyle=C.maskColor),k){var u=n.bounds;s={x:(t+u[3])*E,y:(e+u[0])*E,w:(u[1]-u[3]+1)*E,h:(u[2]-u[0]+1)*E}}for(var f=l.length;f--;){var c=t+l[f][0],h=e+l[f][1];w<=c||y<=h||c<0||h<0||A(c,h,d,s,i)}d&&r.restore()}(e,a,0,0,l,o),{gx:e,gy:a,rot:s,info:l})};d--;){var a=g(M-d);C.shuffle&&(a=[].concat(a),W(a));for(var u=0;u<a.length;u++){var f=e(a[u]);if(f)return f}}return null},F=function(a,o,n){if(o)return!v.some(function(t){var e=document.createEvent("CustomEvent");return e.initCustomEvent(a,!0,o,n||{}),!t.dispatchEvent(e)},this);v.forEach(function(t){var e=document.createEvent("CustomEvent");e.initCustomEvent(a,!0,o,n||{}),t.dispatchEvent(e)},this)};!function(){var e=v[0];if(e.getContext)w=Math.ceil(e.width/E),y=Math.ceil(e.height/E);else{var t=e.getBoundingClientRect();w=Math.ceil(t.width/E),y=Math.ceil(t.height/E)}if(F("wordcloudstart",!0)){var a,o,n,i,r;if(x=C.origin?[C.origin[0]/E,C.origin[1]/E]:[w/2,y/2],M=Math.floor(Math.sqrt(w*w+y*y)),p=[],!e.getContext||C.clearCanvas)for(v.forEach(function(t){if(t.getContext){var e=t.getContext("2d");e.fillStyle=C.backgroundColor,e.clearRect(0,0,w*(E+1),y*(E+1)),e.fillRect(0,0,w*(E+1),y*(E+1))}else t.textContent="",t.style.backgroundColor=C.backgroundColor,t.style.position="relative"}),a=w;a--;)for(p[a]=[],o=y;o--;)p[a][o]=!0;else{var s=document.createElement("canvas").getContext("2d");s.fillStyle=C.backgroundColor,s.fillRect(0,0,1,1);var l,d,u=s.getImageData(0,0,1,1).data,f=e.getContext("2d").getImageData(0,0,w*E,y*E).data;for(a=w;a--;)for(p[a]=[],o=y;o--;){d=E;t:for(;d--;)for(l=E;l--;)for(n=4;n--;)if(f[4*((o*E+d)*w*E+(a*E+l))+n]!==u[n]){p[a][o]=!1;break t}!1!==p[a][o]&&(p[a][o]=!0)}f=s=u=void 0}if(C.hover||C.click){for(k=!0,a=w+1;a--;)O[a]=[];C.hover&&e.addEventListener("mousemove",P),C.click&&(e.addEventListener("click",D),e.addEventListener("touchstart",D),e.addEventListener("touchend",function(t){t.preventDefault()}),e.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),e.addEventListener("wordcloudstart",function t(){e.removeEventListener("wordcloudstart",t),e.removeEventListener("mousemove",P),e.removeEventListener("click",D),T=void 0})}var c=!(n=0);r=C.layoutAnimation?0!==C.wait?(i=window.setTimeout,window.clearTimeout):(i=window.setImmediate,window.clearImmediate):(i=function(t){t()},function(){c=!1});var h=function(e,a){v.forEach(function(t){t.removeEventListener(e,a)},this)},m=function t(){h("wordcloudstart",t),r(g)};!function(e,a){v.forEach(function(t){t.addEventListener(e,a)},this)}("wordcloudstart",m);var g=(C.layoutAnimation?i:setTimeout)(function t(){if(c){if(n>=C.list.length)return r(g),F("wordcloudstop",!1),void h("wordcloudstart",m);S=(new Date).getTime();var e=z(C.list[n]),a=!F("wordclouddrawn",!0,{item:C.list[n],drawn:e});if(R()||a)return r(g),C.abort(),F("wordcloudabort",!1),F("wordcloudstop",!1),void h("wordcloudstart",m);n++,g=i(t,C.wait)}},C.wait)}}()}function n(t,e){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)"}};o.isSupported=s,o.minFontSize=L;var g=o;if(!g.isSupported)throw new Error("Sorry your browser not support wordCloud");m.registerLayout(function(c,h){c.eachSeriesByType("wordCloud",function(a){var o=m.helper.getLayoutRect(a.getBoxLayoutParams(),{width:h.getWidth(),height:h.getHeight()}),n=a.getData(),t=document.createElement("canvas");t.width=o.width,t.height=o.height;var e=t.getContext("2d"),i=a.get("maskImage");if(i)try{e.drawImage(i,0,0,t.width,t.height),function(t){for(var e=t.getContext("2d"),a=e.getImageData(0,0,t.width,t.height),o=e.createImageData(a),n=0,i=0,r=0;r<a.data.length;r+=4)128<a.data[r+3]&&(n+=l=a.data[r]+a.data[r+1]+a.data[r+2],++i);var s=n/i;for(r=0;r<a.data.length;r+=4){var l=a.data[r]+a.data[r+1]+a.data[r+2];a.data[r+3]<128||s<l?(o.data[r]=0,o.data[r+1]=0,o.data[r+2]=0,o.data[r+3]=0):(o.data[r]=255,o.data[r+1]=255,o.data[r+2]=255,o.data[r+3]=255)}e.putImageData(o,0,0)}(t)}catch(t){console.error("Invalid mask image"),console.error(t.toString())}var r=a.get("sizeRange"),s=a.get("rotationRange"),l=n.getDataExtent("value"),d=Math.PI/180,u=a.get("gridSize");function f(t){var e=t.detail.item;t.detail.drawn&&a.layoutInstance.ondraw&&(t.detail.drawn.gx+=o.x/u,t.detail.drawn.gy+=o.y/u,a.layoutInstance.ondraw(e[0],e[1],e[2],t.detail.drawn))}g(t,{list:n.mapArray("value",function(t,e){var a=n.getItemModel(e);return[n.getName(e),a.get("textStyle.fontSize",!0)||m.number.linearMap(t,l,r),e]}).sort(function(t,e){return e[1]-t[1]}),fontFamily:a.get("textStyle.fontFamily")||a.get("emphasis.textStyle.fontFamily")||c.get("textStyle.fontFamily"),fontWeight:a.get("textStyle.fontWeight")||a.get("emphasis.textStyle.fontWeight")||c.get("textStyle.fontWeight"),gridSize:u,ellipticity:o.height/o.width,minRotation:s[0]*d,maxRotation:s[1]*d,clearCanvas:!i,rotateRatio:1,rotationStep:a.get("rotationStep")*d,drawOutOfBound:a.get("drawOutOfBound"),layoutAnimation:a.get("layoutAnimation"),shuffle:!1,shape:a.get("shape")}),t.addEventListener("wordclouddrawn",f),a.layoutInstance&&a.layoutInstance.dispose(),a.layoutInstance={ondraw:null,dispose:function(){t.removeEventListener("wordclouddrawn",f),t.addEventListener("wordclouddrawn",function(t){t.preventDefault()})}}})}),m.registerPreprocessor(function(t){var e=(t||{}).series;!m.util.isArray(e)&&(e=e?[e]:[]);var a=["shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"];function o(e){e&&m.util.each(a,function(t){e.hasOwnProperty(t)&&(e["text"+m.format.capitalFirst(t)]=e[t])})}m.util.each(e,function(t){if(t&&"wordCloud"===t.type){var e=t.textStyle||{};o(e.normal),o(e.emphasis)}})})},"echarts/lib/echarts":function(t){t.exports=e}},o={};function n(t){if(o[t])return o[t].exports;var e=o[t]={exports:{}};return a[t](e,e.exports,n),e.exports}return n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n("./index.js")}()});