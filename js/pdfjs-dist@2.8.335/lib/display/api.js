"use strict";function _regeneratorRuntime(){_regeneratorRuntime=function(){return i};var i={},e=Object.prototype,c=e.hasOwnProperty,d=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},a=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",n=t.toStringTag||"@@toStringTag";function o(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(e){o=function(e,t,r){return e[t]=r}}function s(e,t,r,n){var o,i,s,l,a=t&&t.prototype instanceof f?t:f,u=Object.create(a.prototype),c=new C(n||[]);return d(u,"_invoke",{value:(o=e,i=r,s=c,l="suspendedStart",function(e,t){if("executing"===l)throw new Error("Generator is already running");if("completed"===l){if("throw"===e)throw t;return S()}for(s.method=e,s.arg=t;;){var r=s.delegate;if(r){var n=k(r,s);if(n){if(n===h)continue;return n}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if("suspendedStart"===l)throw l="completed",s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);l="executing";var a=p(o,i,s);if("normal"===a.type){if(l=s.done?"completed":"suspendedYield",a.arg===h)continue;return{value:a.arg,done:s.done}}"throw"===a.type&&(l="completed",s.method="throw",s.arg=a.arg)}})}),u}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}i.wrap=s;var h={};function f(){}function l(){}function u(){}var y={};o(y,a,function(){return this});var g=Object.getPrototypeOf,v=g&&g(g(x([])));v&&v!==e&&c.call(v,a)&&(y=v);var _=u.prototype=f.prototype=Object.create(y);function m(e){["next","throw","return"].forEach(function(t){o(e,t,function(e){return this._invoke(t,e)})})}function b(l,u){var t;d(this,"_invoke",{value:function(r,n){function e(){return new u(function(e,t){!function t(e,r,n,a){var o=p(l[e],l,r);if("throw"!==o.type){var i=o.arg,s=i.value;return s&&"object"==_typeof(s)&&c.call(s,"__await")?u.resolve(s.__await).then(function(e){t("next",e,n,a)},function(e){t("throw",e,n,a)}):u.resolve(s).then(function(e){i.value=e,n(i)},function(e){return t("throw",e,n,a)})}a(o.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function k(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var a=p(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,h;var o=a.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function x(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:S}}function S(){return{value:void 0,done:!0}}return d(_,"constructor",{value:l.prototype=u,configurable:!0}),d(u,"constructor",{value:l,configurable:!0}),l.displayName=o(u,n,"GeneratorFunction"),i.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))},i.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,o(e,n,"GeneratorFunction")),e.prototype=Object.create(_),e},i.awrap=function(e){return{__await:e}},m(b.prototype),o(b.prototype,r,function(){return this}),i.AsyncIterator=b,i.async=function(e,t,r,n,a){void 0===a&&(a=Promise);var o=new b(s(e,t,r,n),a);return i.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},m(_),o(_,n,"Generator"),o(_,a,function(){return this}),o(_,"toString",function(){return"[object Generator]"}),i.keys=function(e){var r=Object(e),n=[];for(var t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},i.values=x,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var a=this.tryEntries[t],o=a.completion;if("root"===a.tryLoc)return e("end");if(a.tryLoc<=this.prev){var i=c.call(a,"catchLoc"),s=c.call(a,"finallyLoc");if(i&&s){if(this.prev<a.catchLoc)return e(a.catchLoc,!0);if(this.prev<a.finallyLoc)return e(a.finallyLoc)}else if(i){if(this.prev<a.catchLoc)return e(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return e(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;P(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:x(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},i}function asyncGeneratorStep(e,t,r,n,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function _asyncToGenerator(s){return function(){var e=this,i=arguments;return new Promise(function(t,r){var n=s.apply(e,i);function a(e){asyncGeneratorStep(n,t,r,a,o,"next",e)}function o(e){asyncGeneratorStep(n,t,r,a,o,"throw",e)}a(void 0)})}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw o}}}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);var n=r.call(e,t||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,i,s=[],l=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw a}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.version=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultCMapReaderFactory=exports.DefaultCanvasFactory=exports.build=void 0;var _util=require("../shared/util.js"),_display_utils=require("./display_utils.js"),_font_loader=require("./font_loader.js"),_node_utils=require("./node_utils.js"),_annotation_storage=require("./annotation_storage.js"),_api_compatibility=require("./api_compatibility.js"),_canvas=require("./canvas.js"),_worker_options=require("./worker_options.js"),_is_node=require("../shared/is_node.js"),_message_handler=require("../shared/message_handler.js"),_metadata=require("./metadata.js"),_optional_content_config=require("./optional_content_config.js"),_transport_stream=require("./transport_stream.js"),_webgl=require("./webgl.js"),DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DefaultCanvasFactory=_is_node.isNodeJS?_node_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;var DefaultCMapReaderFactory=_is_node.isNodeJS?_node_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory,createPDFNetworkStream;function setPDFNetworkStreamFactory(e){createPDFNetworkStream=e}function getDocument(e){var t,i=new PDFDocumentLoadingTask;if("string"==typeof e||e instanceof URL)t={url:e};else if((0,_util.isArrayBuffer)(e))t={data:e};else if(e instanceof PDFDataRangeTransport)t={range:e};else{if("object"!==_typeof(e))throw new Error("Invalid parameter in getDocument, need either string, URL, Uint8Array, or parameter object.");if(!e.url&&!e.data&&!e.range)throw new Error("Invalid parameter object: need either .data, .range or .url");t=e}var s=Object.create(null),r=null,l=null;for(var n in t){var a=t[n];switch(n){case"url":if("undefined"!=typeof window)try{s[n]=new URL(a,window.location).href;continue}catch(e){(0,_util.warn)('Cannot create valid URL: "'.concat(e,'".'))}else if("string"==typeof a||a instanceof URL){s[n]=a.toString();continue}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.");case"range":r=a;continue;case"worker":l=a;continue;case"data":if(_is_node.isNodeJS&&"undefined"!=typeof Buffer&&a instanceof Buffer)s[n]=new Uint8Array(a);else{if(a instanceof Uint8Array)break;if("string"==typeof a)s[n]=(0,_util.stringToBytes)(a);else if("object"!==_typeof(a)||null===a||isNaN(a.length)){if(!(0,_util.isArrayBuffer)(a))throw new Error("Invalid PDF binary data: either typed array, string, or array-like object is expected in the data property.");s[n]=new Uint8Array(a)}else s[n]=new Uint8Array(a)}continue}s[n]=a}if(s.rangeChunkSize=s.rangeChunkSize||DEFAULT_RANGE_CHUNK_SIZE,s.CMapReaderFactory=s.CMapReaderFactory||DefaultCMapReaderFactory,s.ignoreErrors=!0!==s.stopAtErrors,s.fontExtraProperties=!0===s.fontExtraProperties,s.pdfBug=!0===s.pdfBug,s.enableXfa=!0===s.enableXfa,("string"!=typeof s.docBaseUrl||(0,_display_utils.isDataScheme)(s.docBaseUrl))&&(s.docBaseUrl=null),Number.isInteger(s.maxImageSize)||(s.maxImageSize=-1),"boolean"!=typeof s.isEvalSupported&&(s.isEvalSupported=!0),"boolean"!=typeof s.disableFontFace&&(s.disableFontFace=_api_compatibility.apiCompatibilityParams.disableFontFace||!1),void 0===s.ownerDocument&&(s.ownerDocument=globalThis.document),"boolean"!=typeof s.disableRange&&(s.disableRange=!1),"boolean"!=typeof s.disableStream&&(s.disableStream=!1),"boolean"!=typeof s.disableAutoFetch&&(s.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(s.verbosity),!l){var o={verbosity:s.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};l=o.port?PDFWorker.fromPort(o):new PDFWorker(o),i._worker=l}var u=i.docId;return l.promise.then(function(){if(i.destroyed)throw new Error("Loading aborted");var e=_fetchDocument(l,s,r,u),t=new Promise(function(e){var t;r?t=new _transport_stream.PDFDataTransportStream({length:s.length,initialData:s.initialData,progressiveDone:s.progressiveDone,contentDispositionFilename:s.contentDispositionFilename,disableRange:s.disableRange,disableStream:s.disableStream},r):s.data||(t=createPDFNetworkStream({url:s.url,length:s.length,httpHeaders:s.httpHeaders,withCredentials:s.withCredentials,rangeChunkSize:s.rangeChunkSize,disableRange:s.disableRange,disableStream:s.disableStream})),e(t)});return Promise.all([e,t]).then(function(e){var t=_slicedToArray(e,2),r=t[0],n=t[1];if(i.destroyed)throw new Error("Loading aborted");var a=new _message_handler.MessageHandler(u,r,l.port);a.postMessageTransfers=l.postMessageTransfers;var o=new WorkerTransport(a,i,n,s);i._transport=o,a.send("Ready",null)})}).catch(i._capability.reject),i}function _fetchDocument(t,e,r,n){return t.destroyed?Promise.reject(new Error("Worker was destroyed")):(r&&(e.length=r.length,e.initialData=r.initialData,e.progressiveDone=r.progressiveDone,e.contentDispositionFilename=r.contentDispositionFilename),t.messageHandler.sendWithPromise("GetDocRequest",{docId:n,apiVersion:"2.8.335",source:{data:e.data,url:e.url,password:e.password,disableAutoFetch:e.disableAutoFetch,rangeChunkSize:e.rangeChunkSize,length:e.length},maxImageSize:e.maxImageSize,disableFontFace:e.disableFontFace,postMessageTransfers:t.postMessageTransfers,docBaseUrl:e.docBaseUrl,ignoreErrors:e.ignoreErrors,isEvalSupported:e.isEvalSupported,fontExtraProperties:e.fontExtraProperties,enableXfa:e.enableXfa}).then(function(e){if(t.destroyed)throw new Error("Worker was destroyed");return e}))}exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;var PDFDocumentLoadingTask=function(){var t=0;return function(){function e(){_classCallCheck(this,e),this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId="d"+t++,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}return _createClass(e,[{key:"promise",get:function(){return this._capability.promise}},{key:"destroy",value:function(){var e=this;return this.destroyed=!0,(this._transport?this._transport.destroy():Promise.resolve()).then(function(){e._transport=null,e._worker&&(e._worker.destroy(),e._worker=null)})}}]),e}()}(),PDFDataRangeTransport=function(){function a(e,t){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;_classCallCheck(this,a),this.length=e,this.initialData=t,this.progressiveDone=r,this.contentDispositionFilename=n,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}return _createClass(a,[{key:"addRangeListener",value:function(e){this._rangeListeners.push(e)}},{key:"addProgressListener",value:function(e){this._progressListeners.push(e)}},{key:"addProgressiveReadListener",value:function(e){this._progressiveReadListeners.push(e)}},{key:"addProgressiveDoneListener",value:function(e){this._progressiveDoneListeners.push(e)}},{key:"onDataRange",value:function(e,t){var r,n=_createForOfIteratorHelper(this._rangeListeners);try{for(n.s();!(r=n.n()).done;){(0,r.value)(e,t)}}catch(e){n.e(e)}finally{n.f()}}},{key:"onDataProgress",value:function(r,n){var a=this;this._readyCapability.promise.then(function(){var e,t=_createForOfIteratorHelper(a._progressListeners);try{for(t.s();!(e=t.n()).done;){(0,e.value)(r,n)}}catch(e){t.e(e)}finally{t.f()}})}},{key:"onDataProgressiveRead",value:function(r){var n=this;this._readyCapability.promise.then(function(){var e,t=_createForOfIteratorHelper(n._progressiveReadListeners);try{for(t.s();!(e=t.n()).done;){(0,e.value)(r)}}catch(e){t.e(e)}finally{t.f()}})}},{key:"onDataProgressiveDone",value:function(){var r=this;this._readyCapability.promise.then(function(){var e,t=_createForOfIteratorHelper(r._progressiveDoneListeners);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(e){t.e(e)}finally{t.f()}})}},{key:"transportReady",value:function(){this._readyCapability.resolve()}},{key:"requestDataRange",value:function(e,t){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}},{key:"abort",value:function(){}}]),a}();exports.PDFDataRangeTransport=PDFDataRangeTransport;var PDFDocumentProxy=function(){function r(e,t){_classCallCheck(this,r),this._pdfInfo=e,this._transport=t}return _createClass(r,[{key:"annotationStorage",get:function(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}},{key:"numPages",get:function(){return this._pdfInfo.numPages}},{key:"fingerprint",get:function(){return this._pdfInfo.fingerprint}},{key:"isPureXfa",get:function(){return this._pdfInfo.isPureXfa}},{key:"getPage",value:function(e){return this._transport.getPage(e)}},{key:"getPageIndex",value:function(e){return this._transport.getPageIndex(e)}},{key:"getDestinations",value:function(){return this._transport.getDestinations()}},{key:"getDestination",value:function(e){return this._transport.getDestination(e)}},{key:"getPageLabels",value:function(){return this._transport.getPageLabels()}},{key:"getPageLayout",value:function(){return this._transport.getPageLayout()}},{key:"getPageMode",value:function(){return this._transport.getPageMode()}},{key:"getViewerPreferences",value:function(){return this._transport.getViewerPreferences()}},{key:"getOpenAction",value:function(){return this._transport.getOpenAction()}},{key:"getAttachments",value:function(){return this._transport.getAttachments()}},{key:"getJavaScript",value:function(){return this._transport.getJavaScript()}},{key:"getJSActions",value:function(){return this._transport.getDocJSActions()}},{key:"getOutline",value:function(){return this._transport.getOutline()}},{key:"getOptionalContentConfig",value:function(){return this._transport.getOptionalContentConfig()}},{key:"getPermissions",value:function(){return this._transport.getPermissions()}},{key:"getMetadata",value:function(){return this._transport.getMetadata()}},{key:"getMarkInfo",value:function(){return this._transport.getMarkInfo()}},{key:"getData",value:function(){return this._transport.getData()}},{key:"getDownloadInfo",value:function(){return this._transport.downloadInfoCapability.promise}},{key:"getStats",value:function(){return this._transport.getStats()}},{key:"cleanup",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this._transport.startCleanup(e||this.isPureXfa)}},{key:"destroy",value:function(){return this.loadingTask.destroy()}},{key:"loadingParams",get:function(){return this._transport.loadingParams}},{key:"loadingTask",get:function(){return this._transport.loadingTask}},{key:"saveDocument",value:function(e){return this._transport.saveDocument(e)}},{key:"getFieldObjects",value:function(){return this._transport.getFieldObjects()}},{key:"hasJSActions",value:function(){return this._transport.hasJSActions()}},{key:"getCalculationOrderIds",value:function(){return this._transport.getCalculationOrderIds()}}]),r}();exports.PDFDocumentProxy=PDFDocumentProxy;var PDFPageProxy=function(){function o(e,t,r,n){var a=4<arguments.length&&void 0!==arguments[4]&&arguments[4];_classCallCheck(this,o),this._pageIndex=e,this._pageInfo=t,this._ownerDocument=n,this._transport=r,this._stats=a?new _display_utils.StatTimer:null,this._pdfBug=a,this.commonObjs=r.commonObjs,this.objs=new PDFObjects,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this.destroyed=!1}return _createClass(o,[{key:"pageNumber",get:function(){return this._pageIndex+1}},{key:"rotate",get:function(){return this._pageInfo.rotate}},{key:"ref",get:function(){return this._pageInfo.ref}},{key:"userUnit",get:function(){return this._pageInfo.userUnit}},{key:"view",get:function(){return this._pageInfo.view}},{key:"getViewport",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.scale,r=e.rotation,n=void 0===r?this.rotate:r,a=e.offsetX,o=void 0===a?0:a,i=e.offsetY,s=void 0===i?0:i,l=e.dontFlip,u=void 0!==l&&l;return new _display_utils.PageViewport({viewBox:this.view,scale:t,rotation:n,offsetX:o,offsetY:s,dontFlip:u})}},{key:"getAnnotations",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).intent,t=void 0===e?null:e;return this._annotationsPromise&&this._annotationsIntent===t||(this._annotationsPromise=this._transport.getAnnotations(this._pageIndex,t),this._annotationsIntent=t),this._annotationsPromise}},{key:"getJSActions",value:function(){return this._jsActionsPromise||(this._jsActionsPromise=this._transport.getPageJSActions(this._pageIndex))}},{key:"getXfa",value:function(){return this._xfaPromise||(this._xfaPromise=this._transport.getPageXfa(this._pageIndex))}},{key:"render",value:function(e){var t,a=this,r=e.canvasContext,n=e.viewport,o=e.intent,i=void 0===o?"display":o,s=e.enableWebGL,l=void 0!==s&&s,u=e.renderInteractiveForms,c=void 0!==u&&u,d=e.transform,p=void 0===d?null:d,h=e.imageLayer,f=void 0===h?null:h,y=e.canvasFactory,g=void 0===y?null:y,v=e.background,_=void 0===v?null:v,m=e.annotationStorage,b=void 0===m?null:m,k=e.optionalContentConfigPromise,w=void 0===k?null:k;this._stats&&this._stats.time("Overall");var P="print"===i?"print":"display";this.pendingCleanup=!1,w||(w=this._transport.getOptionalContentConfig());var C=this._intentStates.get(P);C||(C=Object.create(null),this._intentStates.set(P,C)),C.streamReaderCancelTimeout&&(clearTimeout(C.streamReaderCancelTimeout),C.streamReaderCancelTimeout=null);var x=g||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),S=new _webgl.WebGLContext({enable:l});C.displayReadyCapability||(C.displayReadyCapability=(0,_util.createPromiseCapability)(),C.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList({pageIndex:this._pageIndex,intent:P,renderInteractiveForms:!0===c,annotationStorage:(null==b?void 0:b.serializable)||null}));var F=function(e){C.renderTasks.delete(D),(a.cleanupAfterRender||"print"===P)&&(a.pendingCleanup=!0),a._tryCleanup(),e?(D.capability.reject(e),a._abortOperatorList({intentState:C,reason:e})):D.capability.resolve(),a._stats&&(a._stats.timeEnd("Rendering"),a._stats.timeEnd("Overall"))},D=new InternalRenderTask({callback:F,params:{canvasContext:r,viewport:n,transform:p,imageLayer:f,background:_},objs:this.objs,commonObjs:this.commonObjs,operatorList:C.operatorList,pageIndex:this._pageIndex,canvasFactory:x,webGLContext:S,useRequestAnimationFrame:"print"!==P,pdfBug:this._pdfBug});((t=C).renderTasks||(t.renderTasks=new Set)).add(D);var L=D.task;return Promise.all([C.displayReadyCapability.promise,w]).then(function(e){var t=_slicedToArray(e,2),r=t[0],n=t[1];a.pendingCleanup?F():(a._stats&&a._stats.time("Rendering"),D.initializeGraphics({transparency:r,optionalContentConfig:n}),D.operatorListChanged())}).catch(F),L}},{key:"getOperatorList",value:function(){var e,t,r="oplist",n=this._intentStates.get(r);(n||(n=Object.create(null),this._intentStates.set(r,n)),n.opListReadCapability)||((e=Object.create(null)).operatorListChanged=function(){n.operatorList.lastChunk&&(n.opListReadCapability.resolve(n.operatorList),n.renderTasks.delete(e))},n.opListReadCapability=(0,_util.createPromiseCapability)(),((t=n).renderTasks||(t.renderTasks=new Set)).add(e),n.operatorList={fnArray:[],argsArray:[],lastChunk:!1},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList({pageIndex:this._pageIndex,intent:r}));return n.opListReadCapability.promise}},{key:"streamTextContent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.normalizeWhitespace,r=void 0!==t&&t,n=e.disableCombineTextItems,a=void 0!==n&&n;return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,normalizeWhitespace:!0===r,combineTextItems:!0!==a},{highWaterMark:100,size:function(e){return e.items.length}})}},{key:"getTextContent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=this.streamTextContent(e);return new Promise(function(a,e){var t=r.getReader(),o={items:[],styles:Object.create(null)};!function n(){t.read().then(function(e){var t,r=e.value;e.done?a(o):(Object.assign(o.styles,r.styles),(t=o.items).push.apply(t,_toConsumableArray(r.items)),n())},e)}()})}},{key:"_destroy",value:function(){this.destroyed=!0,this._transport.pageCache[this._pageIndex]=null;var e,t=[],r=_createForOfIteratorHelper(this._intentStates);try{for(r.s();!(e=r.n()).done;){var n=_slicedToArray(e.value,2),a=n[0],o=n[1];if(this._abortOperatorList({intentState:o,reason:new Error("Page was destroyed."),force:!0}),"oplist"!==a){var i,s=_createForOfIteratorHelper(o.renderTasks);try{for(s.s();!(i=s.n()).done;){var l=i.value;t.push(l.completed),l.cancel()}}catch(e){s.e(e)}finally{s.f()}}}}catch(e){r.e(e)}finally{r.f()}return this.objs.clear(),this._annotationsPromise=null,this._jsActionsPromise=null,this._xfaPromise=null,this.pendingCleanup=!1,Promise.all(t)}},{key:"cleanup",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return this.pendingCleanup=!0,this._tryCleanup(e)}},{key:"_tryCleanup",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];if(!this.pendingCleanup)return!1;var t,r=_createForOfIteratorHelper(this._intentStates.values());try{for(r.s();!(t=r.n()).done;){var n=t.value,a=n.renderTasks,o=n.operatorList;if(0<a.size||!o.lastChunk)return!1}}catch(e){r.e(e)}finally{r.f()}return this._intentStates.clear(),this.objs.clear(),this._annotationsPromise=null,this._jsActionsPromise=null,this._xfaPromise=null,e&&this._stats&&(this._stats=new _display_utils.StatTimer),!(this.pendingCleanup=!1)}},{key:"_startRenderPage",value:function(e,t){var r=this._intentStates.get(t);r&&(this._stats&&this._stats.timeEnd("Page Request"),r.displayReadyCapability&&r.displayReadyCapability.resolve(e))}},{key:"_renderPageChunk",value:function(e,t){for(var r=0,n=e.length;r<n;r++)t.operatorList.fnArray.push(e.fnArray[r]),t.operatorList.argsArray.push(e.argsArray[r]);t.operatorList.lastChunk=e.lastChunk;var a,o=_createForOfIteratorHelper(t.renderTasks);try{for(o.s();!(a=o.n()).done;){a.value.operatorListChanged()}}catch(e){o.e(e)}finally{o.f()}e.lastChunk&&this._tryCleanup()}},{key:"_pumpOperatorList",value:function(e){var n=this;(0,_util.assert)(e.intent,'PDFPageProxy._pumpOperatorList: Expected "intent" argument.');var t=this._transport.messageHandler.sendWithStream("GetOperatorList",e).getReader(),a=this._intentStates.get(e.intent);a.streamReader=t;!function r(){t.read().then(function(e){var t=e.value;e.done?a.streamReader=null:n._transport.destroyed||(n._renderPageChunk(t,a),r())},function(e){if(a.streamReader=null,!n._transport.destroyed){if(a.operatorList){a.operatorList.lastChunk=!0;var t,r=_createForOfIteratorHelper(a.renderTasks);try{for(r.s();!(t=r.n()).done;)t.value.operatorListChanged()}catch(e){r.e(e)}finally{r.f()}n._tryCleanup()}if(a.displayReadyCapability)a.displayReadyCapability.reject(e);else{if(!a.opListReadCapability)throw e;a.opListReadCapability.reject(e)}}})}()}},{key:"_abortOperatorList",value:function(e){var t=this,r=e.intentState,n=e.reason,a=e.force,o=void 0!==a&&a;if((0,_util.assert)(n instanceof Error||"object"===_typeof(n)&&null!==n,'PDFPageProxy._abortOperatorList: Expected "reason" argument.'),r.streamReader){if(!o){if(0<r.renderTasks.size)return;if(n instanceof _display_utils.RenderingCancelledException)return void(r.streamReaderCancelTimeout=setTimeout(function(){t._abortOperatorList({intentState:r,reason:n,force:!0}),r.streamReaderCancelTimeout=null},RENDERING_CANCELLED_TIMEOUT))}if(r.streamReader.cancel(new _util.AbortException(null==n?void 0:n.message)),r.streamReader=null,!this._transport.destroyed){var i,s=_createForOfIteratorHelper(this._intentStates);try{for(s.s();!(i=s.n()).done;){var l=_slicedToArray(i.value,2),u=l[0];if(l[1]===r){this._intentStates.delete(u);break}}}catch(e){s.e(e)}finally{s.f()}this.cleanup()}}}},{key:"stats",get:function(){return this._stats}}]),o}();exports.PDFPageProxy=PDFPageProxy;var LoopbackPort=function(){function e(){_classCallCheck(this,e),this._listeners=[],this._deferred=Promise.resolve(void 0)}return _createClass(e,[{key:"postMessage",value:function(e,g){var r=this;var v=new WeakMap,n={data:function e(t){if("object"!==_typeof(t)||null===t)return t;if(v.has(t))return v.get(t);var r,n;if((r=t.buffer)&&(0,_util.isArrayBuffer)(r))return n=null!=g&&g.includes(r)?new t.constructor(r,t.byteOffset,t.byteLength):new t.constructor(t),v.set(t,n),n;if(t instanceof Map){n=new Map,v.set(t,n);var a,o=_createForOfIteratorHelper(t);try{for(o.s();!(a=o.n()).done;){var i=_slicedToArray(a.value,2),s=i[0],l=i[1];n.set(s,e(l))}}catch(e){o.e(e)}finally{o.f()}return n}if(t instanceof Set){n=new Set,v.set(t,n);var u,c=_createForOfIteratorHelper(t);try{for(c.s();!(u=c.n()).done;){var d=u.value;n.add(e(d))}}catch(e){c.e(e)}finally{c.f()}return n}for(var p in n=Array.isArray(t)?[]:{},v.set(t,n),t){for(var h,f=void 0,y=t;!(f=Object.getOwnPropertyDescriptor(y,p));)y=Object.getPrototypeOf(y);if(void 0!==f.value)if("function"!=typeof f.value)n[p]=e(f.value);else if(null!==(h=t.hasOwnProperty)&&void 0!==h&&h.call(t,p))throw new Error("LoopbackPort.postMessage - cannot clone: ".concat(t[p]))}return n}(e)};this._deferred.then(function(){var e,t=_createForOfIteratorHelper(r._listeners);try{for(t.s();!(e=t.n()).done;){e.value.call(r,n)}}catch(e){t.e(e)}finally{t.f()}})}},{key:"addEventListener",value:function(e,t){this._listeners.push(t)}},{key:"removeEventListener",value:function(e,t){var r=this._listeners.indexOf(t);this._listeners.splice(r,1)}},{key:"terminate",value:function(){this._listeners.length=0}}]),e}();exports.LoopbackPort=LoopbackPort;var PDFWorker=function PDFWorkerClosure(){var pdfWorkerPorts=new WeakMap,isWorkerDisabled=!1,fallbackWorkerSrc,nextFakeWorkerId=0,fakeWorkerCapability;if(_is_node.isNodeJS&&"function"==typeof require)isWorkerDisabled=!0,fallbackWorkerSrc="../pdf.worker.js";else if("object"===("undefined"==typeof document?"undefined":_typeof(document))&&"currentScript"in document){var _document$currentScri,pdfjsFilePath=null===(_document$currentScri=document.currentScript)||void 0===_document$currentScri?void 0:_document$currentScri.src;pdfjsFilePath&&(fallbackWorkerSrc=pdfjsFilePath.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}function _getWorkerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(void 0!==fallbackWorkerSrc)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}function getMainThreadWorkerMessageHandler(){var e;try{var t;e=null===(t=globalThis.pdfjsWorker)||void 0===t?void 0:t.WorkerMessageHandler}catch(e){}return e||null}function setupFakeWorkerGlobal(){if(fakeWorkerCapability)return fakeWorkerCapability.promise;fakeWorkerCapability=(0,_util.createPromiseCapability)();var loader=function(){var _ref12=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(){var mainWorkerMessageHandler,worker;return _regeneratorRuntime().wrap(function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(mainWorkerMessageHandler=getMainThreadWorkerMessageHandler(),mainWorkerMessageHandler)return _context.abrupt("return",mainWorkerMessageHandler);_context.next=3;break;case 3:if(_is_node.isNodeJS&&"function"==typeof require)return worker=eval("require")(_getWorkerSrc()),_context.abrupt("return",worker.WorkerMessageHandler);_context.next=6;break;case 6:return _context.next=8,(0,_display_utils.loadScript)(_getWorkerSrc());case 8:return _context.abrupt("return",window.pdfjsWorker.WorkerMessageHandler);case 9:case"end":return _context.stop()}},_callee)}));return function(){return _ref12.apply(this,arguments)}}();return loader().then(fakeWorkerCapability.resolve,fakeWorkerCapability.reject),fakeWorkerCapability.promise}function createCDNWrapper(e){var t="importScripts('"+e+"');";return URL.createObjectURL(new Blob([t]))}var PDFWorker=function(){function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.name,r=void 0===t?null:t,n=e.port,a=void 0===n?null:n,o=e.verbosity,i=void 0===o?(0,_util.getVerbosityLevel)():o;if(_classCallCheck(this,s),a&&pdfWorkerPorts.has(a))throw new Error("Cannot use more than one PDFWorker per port");if(this.name=r,this.destroyed=!1,this.postMessageTransfers=!0,this.verbosity=i,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,a)return pdfWorkerPorts.set(a,this),void this._initializeFromPort(a);this._initialize()}return _createClass(s,[{key:"promise",get:function(){return this._readyCapability.promise}},{key:"port",get:function(){return this._port}},{key:"messageHandler",get:function(){return this._messageHandler}},{key:"_initializeFromPort",value:function(e){this._port=e,this._messageHandler=new _message_handler.MessageHandler("main","worker",e),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve()}},{key:"_initialize",value:function(){var r=this;if("undefined"!=typeof Worker&&!isWorkerDisabled&&!getMainThreadWorkerMessageHandler()){var e=_getWorkerSrc();try{(0,_util.isSameOrigin)(window.location.href,e)||(e=createCDNWrapper(new URL(e,window.location).href));var t=new Worker(e),n=new _message_handler.MessageHandler("main","worker",t),a=function(){t.removeEventListener("error",o),n.destroy(),t.terminate(),r.destroyed?r._readyCapability.reject(new Error("Worker was destroyed")):r._setupFakeWorker()},o=function(){r._webWorker||a()};t.addEventListener("error",o),n.on("test",function(e){t.removeEventListener("error",o),r.destroyed?a():e?(r._messageHandler=n,r._port=t,r._webWorker=t,e.supportTransfers||(r.postMessageTransfers=!1),r._readyCapability.resolve(),n.send("configure",{verbosity:r.verbosity})):(r._setupFakeWorker(),n.destroy(),t.terminate())}),n.on("ready",function(e){if(t.removeEventListener("error",o),r.destroyed)a();else try{i()}catch(e){r._setupFakeWorker()}});var i=function(){var t=new Uint8Array([r.postMessageTransfers?255:0]);try{n.send("test",t,[t.buffer])}catch(e){(0,_util.warn)("Cannot use postMessage transfers."),t[0]=0,n.send("test",t)}};return void i()}catch(e){(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}},{key:"_setupFakeWorker",value:function(){var o=this;isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),isWorkerDisabled=!0),setupFakeWorkerGlobal().then(function(e){if(o.destroyed)o._readyCapability.reject(new Error("Worker was destroyed"));else{var t=new LoopbackPort;o._port=t;var r="fake"+nextFakeWorkerId++,n=new _message_handler.MessageHandler(r+"_worker",r,t);e.setup(n,t);var a=new _message_handler.MessageHandler(r,r+"_worker",t);o._messageHandler=a,o._readyCapability.resolve(),a.send("configure",{verbosity:o.verbosity})}}).catch(function(e){o._readyCapability.reject(new Error('Setting up fake worker failed: "'.concat(e.message,'".')))})}},{key:"destroy",value:function(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),pdfWorkerPorts.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}}],[{key:"fromPort",value:function(e){if(!e||!e.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return pdfWorkerPorts.has(e.port)?pdfWorkerPorts.get(e.port):new s(e)}},{key:"getWorkerSrc",value:function(){return _getWorkerSrc()}}]),s}();return PDFWorker}();exports.PDFWorker=PDFWorker;var WorkerTransport=function(){function a(e,t,r,n){_classCallCheck(this,a),this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:t.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:n.ownerDocument}),this._params=n,this.CMapReaderFactory=new n.CMapReaderFactory({baseUrl:n.cMapUrl,isCompressed:n.cMapPacked}),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=r,this._fullReader=null,this._lastProgress=null,this.pageCache=[],this.pagePromises=[],this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}var e;return _createClass(a,[{key:"loadingTaskSettled",get:function(){return this.loadingTask._capability.settled}},{key:"destroy",value:function(){var e=this;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));var t=[];this.pageCache.forEach(function(e){e&&t.push(e._destroy())}),this.pageCache.length=0,this.pagePromises.length=0;var r=this.messageHandler.sendWithPromise("Terminate",null);if(t.push(r),this.loadingTaskSettled){var n=this.loadingTask.promise.then(function(e){e.hasOwnProperty("annotationStorage")&&e.annotationStorage.resetModified()}).catch(function(){});t.push(n)}return Promise.all(t).then(function(){e.commonObjs.clear(),e.fontLoader.clear(),e._hasJSActionsPromise=null,e._networkStream&&e._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),e.messageHandler&&(e.messageHandler.destroy(),e.messageHandler=null),e.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}},{key:"setupMessageHandler",value:function(){var c=this,d=this.messageHandler,n=this.loadingTask;d.on("GetReader",function(e,r){(0,_util.assert)(c._networkStream,"GetReader - no `IPDFStream` instance available."),c._fullReader=c._networkStream.getFullReader(),c._fullReader.onProgress=function(e){c._lastProgress={loaded:e.loaded,total:e.total}},r.onPull=function(){c._fullReader.read().then(function(e){var t=e.value;e.done?r.close():((0,_util.assert)((0,_util.isArrayBuffer)(t),"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(t),1,[t]))}).catch(function(e){r.error(e)})},r.onCancel=function(e){c._fullReader.cancel(e),r.ready.catch(function(e){if(!c.destroyed)throw e})}}),d.on("ReaderHeadersReady",function(e){var t=(0,_util.createPromiseCapability)(),r=c._fullReader;return r.headersReady.then(function(){r.isStreamingSupported&&r.isRangeSupported||(c._lastProgress&&n.onProgress&&n.onProgress(c._lastProgress),r.onProgress=function(e){n.onProgress&&n.onProgress({loaded:e.loaded,total:e.total})}),t.resolve({isStreamingSupported:r.isStreamingSupported,isRangeSupported:r.isRangeSupported,contentLength:r.contentLength})},t.reject),t.promise}),d.on("GetRangeReader",function(e,r){(0,_util.assert)(c._networkStream,"GetRangeReader - no `IPDFStream` instance available.");var t=c._networkStream.getRangeReader(e.begin,e.end);t?(r.onPull=function(){t.read().then(function(e){var t=e.value;e.done?r.close():((0,_util.assert)((0,_util.isArrayBuffer)(t),"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(t),1,[t]))}).catch(function(e){r.error(e)})},r.onCancel=function(e){t.cancel(e),r.ready.catch(function(e){if(!c.destroyed)throw e})}):r.close()}),d.on("GetDoc",function(e){var t=e.pdfInfo;c._numPages=t.numPages,n._capability.resolve(new PDFDocumentProxy(t,c))}),d.on("DocException",function(e){var t;switch(e.name){case"PasswordException":t=new _util.PasswordException(e.message,e.code);break;case"InvalidPDFException":t=new _util.InvalidPDFException(e.message);break;case"MissingPDFException":t=new _util.MissingPDFException(e.message);break;case"UnexpectedResponseException":t=new _util.UnexpectedResponseException(e.message,e.status);break;case"UnknownErrorException":t=new _util.UnknownErrorException(e.message,e.details)}if(!(t instanceof Error)){(0,_util.warn)("DocException - expected a valid Error.")}n._capability.reject(t)}),d.on("PasswordRequest",function(e){if(c._passwordCapability=(0,_util.createPromiseCapability)(),n.onPassword){try{n.onPassword(function(e){c._passwordCapability.resolve({password:e})},e.code)}catch(e){c._passwordCapability.reject(e)}}else c._passwordCapability.reject(new _util.PasswordException(e.message,e.code));return c._passwordCapability.promise}),d.on("DataLoaded",function(e){n.onProgress&&n.onProgress({loaded:e.length,total:e.length}),c.downloadInfoCapability.resolve(e)}),d.on("StartRenderPage",function(e){c.destroyed||c.pageCache[e.pageIndex]._startRenderPage(e.transparency,e.intent)}),d.on("commonobj",function(e){var t;if(!c.destroyed){var r=_slicedToArray(e,3),n=r[0],a=r[1],o=r[2];if(!c.commonObjs.has(n))switch(a){case"Font":var i=c._params;if("error"in o){var s=o.error;(0,_util.warn)("Error during font loading: ".concat(s)),c.commonObjs.resolve(n,s);break}var l=null;i.pdfBug&&null!==(t=globalThis.FontInspector)&&void 0!==t&&t.enabled&&(l={registerFont:function(e,t){globalThis.FontInspector.fontAdded(e,t)}});var u=new _font_loader.FontFaceObject(o,{isEvalSupported:i.isEvalSupported,disableFontFace:i.disableFontFace,ignoreErrors:i.ignoreErrors,onUnsupportedFeature:c._onUnsupportedFeature.bind(c),fontRegistry:l});c.fontLoader.bind(u).catch(function(e){return d.sendWithPromise("FontFallback",{id:n})}).finally(function(){!i.fontExtraProperties&&u.data&&(u.data=null),c.commonObjs.resolve(n,u)});break;case"FontPath":case"Image":c.commonObjs.resolve(n,o);break;default:throw new Error("Got unknown common object type ".concat(a))}}}),d.on("obj",function(e){var t;if(!c.destroyed){var r=_slicedToArray(e,4),n=r[0],a=r[1],o=r[2],i=r[3],s=c.pageCache[a];if(!s.objs.has(n))switch(o){case"Image":s.objs.resolve(n,i);8e6<(null==i?void 0:null===(t=i.data)||void 0===t?void 0:t.length)&&(s.cleanupAfterRender=!0);break;default:throw new Error("Got unknown object type ".concat(o))}}}),d.on("DocProgress",function(e){c.destroyed||n.onProgress&&n.onProgress({loaded:e.loaded,total:e.total})}),d.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),d.on("FetchBuiltInCMap",function(e,t){if(c.destroyed)t.error(new Error("Worker was destroyed"));else{var r=!1;t.onPull=function(){r?t.close():(r=!0,c.CMapReaderFactory.fetch(e).then(function(e){t.enqueue(e,1,[e.cMapData.buffer])}).catch(function(e){t.error(e)}))}}})}},{key:"_onUnsupportedFeature",value:function(e){var t=e.featureId;this.destroyed||this.loadingTask.onUnsupportedFeature&&this.loadingTask.onUnsupportedFeature(t)}},{key:"getData",value:function(){return this.messageHandler.sendWithPromise("GetData",null)}},{key:"getPage",value:function(e){var r=this;if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request"));var n=e-1;if(n in this.pagePromises)return this.pagePromises[n];var t=this.messageHandler.sendWithPromise("GetPage",{pageIndex:n}).then(function(e){if(r.destroyed)throw new Error("Transport destroyed");var t=new PDFPageProxy(n,e,r,r._params.ownerDocument,r._params.pdfBug);return r.pageCache[n]=t});return this.pagePromises[n]=t}},{key:"getPageIndex",value:function(e){return this.messageHandler.sendWithPromise("GetPageIndex",{ref:e}).catch(function(e){return Promise.reject(new Error(e))})}},{key:"getAnnotations",value:function(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}},{key:"saveDocument",value:function(e){var t,r;return this.messageHandler.sendWithPromise("SaveDocument",{numPages:this._numPages,annotationStorage:(null==e?void 0:e.serializable)||null,filename:null!==(t=null===(r=this._fullReader)||void 0===r?void 0:r.filename)&&void 0!==t?t:null}).finally(function(){e&&e.resetModified()})}},{key:"getFieldObjects",value:function(){return this.messageHandler.sendWithPromise("GetFieldObjects",null)}},{key:"hasJSActions",value:function(){return this._hasJSActionsPromise||(this._hasJSActionsPromise=this.messageHandler.sendWithPromise("HasJSActions",null))}},{key:"getCalculationOrderIds",value:function(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}},{key:"getDestinations",value:function(){return this.messageHandler.sendWithPromise("GetDestinations",null)}},{key:"getDestination",value:function(e){return"string"!=typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}},{key:"getPageLabels",value:function(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}},{key:"getPageLayout",value:function(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}},{key:"getPageMode",value:function(){return this.messageHandler.sendWithPromise("GetPageMode",null)}},{key:"getViewerPreferences",value:function(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}},{key:"getOpenAction",value:function(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}},{key:"getAttachments",value:function(){return this.messageHandler.sendWithPromise("GetAttachments",null)}},{key:"getJavaScript",value:function(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}},{key:"getDocJSActions",value:function(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}},{key:"getPageJSActions",value:function(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}},{key:"getPageXfa",value:function(e){return this.messageHandler.sendWithPromise("GetPageXfa",{pageIndex:e})}},{key:"getOutline",value:function(){return this.messageHandler.sendWithPromise("GetOutline",null)}},{key:"getOptionalContentConfig",value:function(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(function(e){return new _optional_content_config.OptionalContentConfig(e)})}},{key:"getPermissions",value:function(){return this.messageHandler.sendWithPromise("GetPermissions",null)}},{key:"getMetadata",value:function(){var o=this;return this.messageHandler.sendWithPromise("GetMetadata",null).then(function(e){var t,r,n,a;return{info:e[0],metadata:e[1]?new _metadata.Metadata(e[1]):null,contentDispositionFilename:null!==(t=null===(r=o._fullReader)||void 0===r?void 0:r.filename)&&void 0!==t?t:null,contentLength:null!==(n=null===(a=o._fullReader)||void 0===a?void 0:a.contentLength)&&void 0!==n?n:null}})}},{key:"getMarkInfo",value:function(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}},{key:"getStats",value:function(){return this.messageHandler.sendWithPromise("GetStats",null)}},{key:"startCleanup",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,r,n,a,o=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<o.length&&void 0!==o[0]&&o[0],e.next=3,this.messageHandler.sendWithPromise("Cleanup",null);case 3:if(this.destroyed)return e.abrupt("return");e.next=5;break;case 5:r=0,n=this.pageCache.length;case 6:if(!(r<n)){e.next=16;break}if(a=this.pageCache[r]){e.next=10;break}return e.abrupt("continue",13);case 10:if(a.cleanup()){e.next=13;break}throw new Error("startCleanup: Page ".concat(r+1," is currently rendering."));case 13:r++,e.next=6;break;case 16:this.commonObjs.clear(),t||this.fontLoader.clear(),this._hasJSActionsPromise=null;case 19:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"loadingParams",get:function(){var e=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e.disableAutoFetch,disableFontFace:e.disableFontFace})}}]),a}(),PDFObjects=function(){function e(){_classCallCheck(this,e),this._objs=Object.create(null)}return _createClass(e,[{key:"_ensureObj",value:function(e){return this._objs[e]?this._objs[e]:this._objs[e]={capability:(0,_util.createPromiseCapability)(),data:null,resolved:!1}}},{key:"get",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(t)return this._ensureObj(e).capability.promise.then(t),null;var r=this._objs[e];if(!r||!r.resolved)throw new Error("Requesting object that isn't resolved yet ".concat(e,"."));return r.data}},{key:"has",value:function(e){var t=this._objs[e];return(null==t?void 0:t.resolved)||!1}},{key:"resolve",value:function(e,t){var r=this._ensureObj(e);r.resolved=!0,r.data=t,r.capability.resolve(t)}},{key:"clear",value:function(){this._objs=Object.create(null)}}]),e}(),RenderTask=function(){function t(e){_classCallCheck(this,t),this._internalRenderTask=e,this.onContinue=null}return _createClass(t,[{key:"promise",get:function(){return this._internalRenderTask.capability.promise}},{key:"cancel",value:function(){this._internalRenderTask.cancel()}}]),t}(),InternalRenderTask=function(){var d=new WeakSet;return function(){function h(e){var t=e.callback,r=e.params,n=e.objs,a=e.commonObjs,o=e.operatorList,i=e.pageIndex,s=e.canvasFactory,l=e.webGLContext,u=e.useRequestAnimationFrame,c=void 0!==u&&u,d=e.pdfBug,p=void 0!==d&&d;_classCallCheck(this,h),this.callback=t,this.params=r,this.objs=n,this.commonObjs=a,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=i,this.canvasFactory=s,this.webGLContext=l,this._pdfBug=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===c&&"undefined"!=typeof window,this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=r.canvasContext.canvas}var e;return _createClass(h,[{key:"completed",get:function(){return this.capability.promise.catch(function(){})}},{key:"initializeGraphics",value:function(e){var t,r=e.transparency,n=void 0!==r&&r,a=e.optionalContentConfig;if(!this.cancelled){if(this._canvas){if(d.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");d.add(this._canvas)}this._pdfBug&&null!==(t=globalThis.StepperManager)&&void 0!==t&&t.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());var o=this.params,i=o.canvasContext,s=o.viewport,l=o.transform,u=o.imageLayer,c=o.background;this.gfx=new _canvas.CanvasGraphics(i,this.commonObjs,this.objs,this.canvasFactory,this.webGLContext,u,a),this.gfx.beginDrawing({transform:l,viewport:s,transparency:n,background:c}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}}},{key:"cancel",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&d.delete(this._canvas),this.callback(e||new _display_utils.RenderingCancelledException("Rendering cancelled, page ".concat(this._pageIndex+1),"canvas"))}},{key:"operatorListChanged",value:function(){this.graphicsReady?(this.stepper&&this.stepper.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)}},{key:"_continue",value:function(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}},{key:"_scheduleNext",value:function(){var e=this;this._useRequestAnimationFrame?window.requestAnimationFrame(function(){e._nextBound().catch(e._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}},{key:"_next",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cancelled)return e.abrupt("return");e.next=2;break;case 2:this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&d.delete(this._canvas),this.callback()));case 4:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})}]),h}()}(),version="2.8.335";exports.version=version;var build="228adbf67";exports.build=build;