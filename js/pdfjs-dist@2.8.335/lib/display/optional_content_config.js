"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){l=!0,i=t},f:function(){try{a||null==e.return||e.return()}finally{if(l)throw i}}}}function _unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return _arrayLikeToArray(t,r);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(t,r):void 0}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=new Array(r);e<r;e++)n[e]=t[e];return n}function _defineProperties(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,r,e){return r&&_defineProperties(t.prototype,r),e&&_defineProperties(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var r=_toPrimitive(t,"string");return"symbol"===_typeof(r)?r:String(r)}function _toPrimitive(t,r){if("object"!==_typeof(t)||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===r?String:Number)(t);var n=e.call(t,r||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.OptionalContentConfig=void 0;var _util=require("../shared/util.js"),OptionalContentGroup=_createClass(function t(r,e){_classCallCheck(this,t),this.visible=!0,this.name=r,this.intent=e}),OptionalContentConfig=function(){function p(t){if(_classCallCheck(this,p),this.name=null,this.creator=null,this._order=null,this._groups=new Map,null!==t){this.name=t.name,this.creator=t.creator,this._order=t.order;var r,e=_createForOfIteratorHelper(t.groups);try{for(e.s();!(r=e.n()).done;){var n=r.value;this._groups.set(n.id,new OptionalContentGroup(n.name,n.intent))}}catch(t){e.e(t)}finally{e.f()}if("OFF"===t.baseState){var o,i=_createForOfIteratorHelper(this._groups);try{for(i.s();!(o=i.n()).done;){o.value.visible=!1}}catch(t){i.e(t)}finally{i.f()}}var a,l=_createForOfIteratorHelper(t.on);try{for(l.s();!(a=l.n()).done;){var u=a.value;this._groups.get(u).visible=!0}}catch(t){l.e(t)}finally{l.f()}var s,f=_createForOfIteratorHelper(t.off);try{for(f.s();!(s=f.n()).done;){var c=s.value;this._groups.get(c).visible=!1}}catch(t){f.e(t)}finally{f.f()}}}return _createClass(p,[{key:"isVisible",value:function(t){if("OCG"===t.type)return this._groups.has(t.id)?this._groups.get(t.id).visible:((0,_util.warn)("Optional content group not found: ".concat(t.id)),!0);if("OCMD"!==t.type)return(0,_util.warn)("Unknown group type ".concat(t.type,".")),!0;if(t.expression&&(0,_util.warn)("Visibility expression not supported yet."),!t.policy||"AnyOn"===t.policy){var r,e=_createForOfIteratorHelper(t.ids);try{for(e.s();!(r=e.n()).done;){var n=r.value;if(!this._groups.has(n))return(0,_util.warn)("Optional content group not found: ".concat(n)),!0;if(this._groups.get(n).visible)return!0}}catch(t){e.e(t)}finally{e.f()}return!1}if("AllOn"===t.policy){var o,i=_createForOfIteratorHelper(t.ids);try{for(i.s();!(o=i.n()).done;){var a=o.value;if(!this._groups.has(a))return(0,_util.warn)("Optional content group not found: ".concat(a)),!0;if(!this._groups.get(a).visible)return!1}}catch(t){i.e(t)}finally{i.f()}return!0}if("AnyOff"===t.policy){var l,u=_createForOfIteratorHelper(t.ids);try{for(u.s();!(l=u.n()).done;){var s=l.value;if(!this._groups.has(s))return(0,_util.warn)("Optional content group not found: ".concat(s)),!0;if(!this._groups.get(s).visible)return!0}}catch(t){u.e(t)}finally{u.f()}return!1}if("AllOff"!==t.policy)return(0,_util.warn)("Unknown optional content policy ".concat(t.policy,".")),!0;var f,c=_createForOfIteratorHelper(t.ids);try{for(c.s();!(f=c.n()).done;){var p=f.value;if(!this._groups.has(p))return(0,_util.warn)("Optional content group not found: ".concat(p)),!0;if(this._groups.get(p).visible)return!1}}catch(t){c.e(t)}finally{c.f()}return!0}},{key:"setVisibility",value:function(t){var r=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this._groups.has(t)?this._groups.get(t).visible=!!r:(0,_util.warn)("Optional content group not found: ".concat(t))}},{key:"getOrder",value:function(){return this._groups.size?this._order?this._order.slice():Array.from(this._groups.keys()):null}},{key:"getGroups",value:function(){return 0<this._groups.size?(0,_util.objectFromMap)(this._groups):null}},{key:"getGroup",value:function(t){return this._groups.get(t)||null}}]),p}();exports.OptionalContentConfig=OptionalContentConfig;