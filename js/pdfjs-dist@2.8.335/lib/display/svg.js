"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i,n,a,l,s=[],o=!0,u=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;o=!1}else for(;!(o=(i=a.call(r)).done)&&(s.push(i.value),s.length!==e);o=!0);}catch(t){u=!0,n=t}finally{try{if(!o&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(u)throw n}}return s}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _createForOfIteratorHelper(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return l=t.done,t},e:function(t){s=!0,a=t},f:function(){try{l||null==r.return||r.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);var i=r.call(t,e||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.SVGGraphics=void 0;var _util=require("../shared/util.js"),_display_utils=require("./display_utils.js"),_is_node=require("../shared/is_node.js"),SVGGraphics=function(){throw new Error("Not implemented: SVGGraphics")};exports.SVGGraphics=SVGGraphics;var opListToTree=function(t){var e,r=[],i=[],n=_createForOfIteratorHelper(t);try{for(n.s();!(e=n.n()).done;){var a=e.value;"save"!==a.fn?"restore"===a.fn?r=i.pop():r.push(a):(r.push({fnId:92,fn:"group",items:[]}),i.push(r),r=r[r.length-1].items)}}catch(t){n.e(t)}finally{n.f()}return r},pf=function(t){if(Number.isInteger(t))return t.toString();var e=t.toFixed(10),r=e.length-1;if("0"!==e[r])return e;for(;"0"===e[--r];);return e.substring(0,"."===e[r]?r:r+1)},pm=function(t){if(0===t[4]&&0===t[5]){if(0===t[1]&&0===t[2])return 1===t[0]&&1===t[3]?"":"scale(".concat(pf(t[0])," ").concat(pf(t[3]),")");if(t[0]===t[3]&&t[1]===-t[2]){var e=180*Math.acos(t[0])/Math.PI;return"rotate(".concat(pf(e),")")}}else if(1===t[0]&&0===t[1]&&0===t[2]&&1===t[3])return"translate(".concat(pf(t[4])," ").concat(pf(t[5]),")");return"matrix(".concat(pf(t[0])," ").concat(pf(t[1])," ").concat(pf(t[2])," ").concat(pf(t[3])," ").concat(pf(t[4])," ")+"".concat(pf(t[5]),")")},SVG_DEFAULTS={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},XML_NS="http://www.w3.org/XML/1998/namespace",XLINK_NS="http://www.w3.org/1999/xlink",LINE_CAP_STYLES=["butt","round","square"],LINE_JOIN_STYLES=["miter","round","bevel"],convertImgDataToPng=function(){for(var _=new Uint8Array([137,80,78,71,13,10,26,10]),s=new Int32Array(256),t=0;t<256;t++){for(var e=t,r=0;r<8;r++)e=1&e?3988292384^e>>1&2147483647:e>>1&2147483647;s[t]=e}function k(t,e,r,i){var n=i,a=e.length;r[n]=a>>24&255,r[n+1]=a>>16&255,r[n+2]=a>>8&255,r[n+3]=255&a,r[n+=4]=255&t.charCodeAt(0),r[n+1]=255&t.charCodeAt(1),r[n+2]=255&t.charCodeAt(2),r[n+3]=255&t.charCodeAt(3),n+=4,r.set(e,n);var l=function(t,e,r){for(var i=-1,n=e;n<r;n++){var a=255&(i^t[n]);i=i>>>8^s[a]}return-1^i}(r,i+4,n+=e.length);r[n]=l>>24&255,r[n+1]=l>>16&255,r[n+2]=l>>8&255,r[n+3]=255&l}function A(t){var e=t.length,r=65535,i=Math.ceil(e/r),n=new Uint8Array(2+e+5*i+4),a=0;n[a++]=120,n[a++]=156;for(var l=0;r<e;)n[a++]=0,n[a++]=255,n[a++]=255,n[a++]=0,n[a++]=0,n.set(t.subarray(l,l+r),a),a+=r,l+=r,e-=r;n[a++]=1,n[a++]=255&e,n[a++]=e>>8&255,n[a++]=255&~e,n[a++]=(65535&~e)>>8&255,n.set(t.subarray(l),a),a+=t.length-l;var s=function(t,e,r){for(var i=1,n=0,a=e;a<r;++a)n=(n+(i=(i+(255&t[a]))%65521))%65521;return n<<16|i}(t,0,t.length);return n[a++]=s>>24&255,n[a++]=s>>16&255,n[a++]=s>>8&255,n[a++]=255&s,n}function i(t,e,r,i){var n,a,l,s=t.width,o=t.height,u=t.data;switch(e){case _util.ImageKind.GRAYSCALE_1BPP:a=0,n=1,l=s+7>>3;break;case _util.ImageKind.RGB_24BPP:a=2,n=8,l=3*s;break;case _util.ImageKind.RGBA_32BPP:a=6,n=8,l=4*s;break;default:throw new Error("invalid format")}for(var c=new Uint8Array((1+l)*o),h=0,p=0,f=0;f<o;++f)c[h++]=0,c.set(u.subarray(p,p+l),h),p+=l,h+=l;if(e===_util.ImageKind.GRAYSCALE_1BPP&&i)for(var d=h=0;d<o;d++){h++;for(var S=0;S<l;S++)c[h++]^=255}var y=new Uint8Array([s>>24&255,s>>16&255,s>>8&255,255&s,o>>24&255,o>>16&255,o>>8&255,255&o,n,a,0,0,0]),v=function(t){if(!_is_node.isNodeJS)return A(t);try{var e;e=8<=parseInt(process.versions.node)?t:Buffer.from(t);var r=require("zlib").deflateSync(e,{level:9});return r instanceof Uint8Array?r:new Uint8Array(r)}catch(t){(0,_util.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+t)}return A(t)}(c),b=_.length+36+y.length+v.length,m=new Uint8Array(b),g=0;return m.set(_,g),k("IHDR",y,m,g+=_.length),k("IDATA",v,m,g+=12+y.length),g+=12+v.length,k("IEND",new Uint8Array(0),m,g),(0,_util.createObjectURL)(m,"image/png",r)}return function(t,e,r){return i(t,void 0===t.kind?_util.ImageKind.GRAYSCALE_1BPP:t.kind,e,r)}}(),SVGExtraState=function(){function t(){_classCallCheck(this,t),this.fontSizeScale=1,this.fontWeight=SVG_DEFAULTS.fontWeight,this.fontSize=0,this.textMatrix=_util.IDENTITY_MATRIX,this.fontMatrix=_util.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=_util.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=SVG_DEFAULTS.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}return _createClass(t,[{key:"clone",value:function(){return Object.create(this)}},{key:"setCurrentPoint",value:function(t,e){this.x=t,this.y=e}}]),t}(),clipCount=0,maskCount=0,shadingCount=0;exports.SVGGraphics=SVGGraphics=function(){function n(t,e){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];for(var i in _classCallCheck(this,n),this.svgFactory=new _display_utils.DOMSVGFactory,this.current=new SVGExtraState,this.transformMatrix=_util.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=t,this.objs=e,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!r,this._operatorIdMapping=[],_util.OPS)this._operatorIdMapping[_util.OPS[i]]=i}return _createClass(n,[{key:"save",value:function(){this.transformStack.push(this.transformMatrix);var t=this.current;this.extraStack.push(t),this.current=t.clone()}},{key:"restore",value:function(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}},{key:"group",value:function(t){this.save(),this.executeOpTree(t),this.restore()}},{key:"loadDependencies",value:function(t){for(var i=this,e=t.fnArray,r=t.argsArray,n=0,a=e.length;n<a;n++)if(e[n]===_util.OPS.dependency){var l,s=_createForOfIteratorHelper(r[n]);try{var o=function(){var e=l.value,r=e.startsWith("g_")?i.commonObjs:i.objs,t=new Promise(function(t){r.get(e,t)});i.current.dependencies.push(t)};for(s.s();!(l=s.n()).done;)o()}catch(t){s.e(t)}finally{s.f()}}return Promise.all(this.current.dependencies)}},{key:"transform",value:function(t,e,r,i,n,a){var l=[t,e,r,i,n,a];this.transformMatrix=_util.Util.transform(this.transformMatrix,l),this.tgrp=null}},{key:"getSVG",value:function(t,e){var r=this;this.viewport=e;var i=this._initialize(e);return this.loadDependencies(t).then(function(){return r.transformMatrix=_util.IDENTITY_MATRIX,r.executeOpTree(r.convertOpList(t)),i})}},{key:"convertOpList",value:function(t){for(var e=this._operatorIdMapping,r=t.argsArray,i=t.fnArray,n=[],a=0,l=i.length;a<l;a++){var s=i[a];n.push({fnId:s,fn:e[s],args:r[a]})}return opListToTree(n)}},{key:"executeOpTree",value:function(t){var e,r=_createForOfIteratorHelper(t);try{for(r.s();!(e=r.n()).done;){var i=e.value,n=i.fn,a=i.fnId,l=i.args;switch(0|a){case _util.OPS.beginText:this.beginText();break;case _util.OPS.dependency:break;case _util.OPS.setLeading:this.setLeading(l);break;case _util.OPS.setLeadingMoveText:this.setLeadingMoveText(l[0],l[1]);break;case _util.OPS.setFont:this.setFont(l);break;case _util.OPS.showText:case _util.OPS.showSpacedText:this.showText(l[0]);break;case _util.OPS.endText:this.endText();break;case _util.OPS.moveText:this.moveText(l[0],l[1]);break;case _util.OPS.setCharSpacing:this.setCharSpacing(l[0]);break;case _util.OPS.setWordSpacing:this.setWordSpacing(l[0]);break;case _util.OPS.setHScale:this.setHScale(l[0]);break;case _util.OPS.setTextMatrix:this.setTextMatrix(l[0],l[1],l[2],l[3],l[4],l[5]);break;case _util.OPS.setTextRise:this.setTextRise(l[0]);break;case _util.OPS.setTextRenderingMode:this.setTextRenderingMode(l[0]);break;case _util.OPS.setLineWidth:this.setLineWidth(l[0]);break;case _util.OPS.setLineJoin:this.setLineJoin(l[0]);break;case _util.OPS.setLineCap:this.setLineCap(l[0]);break;case _util.OPS.setMiterLimit:this.setMiterLimit(l[0]);break;case _util.OPS.setFillRGBColor:this.setFillRGBColor(l[0],l[1],l[2]);break;case _util.OPS.setStrokeRGBColor:this.setStrokeRGBColor(l[0],l[1],l[2]);break;case _util.OPS.setStrokeColorN:this.setStrokeColorN(l);break;case _util.OPS.setFillColorN:this.setFillColorN(l);break;case _util.OPS.shadingFill:this.shadingFill(l[0]);break;case _util.OPS.setDash:this.setDash(l[0],l[1]);break;case _util.OPS.setRenderingIntent:this.setRenderingIntent(l[0]);break;case _util.OPS.setFlatness:this.setFlatness(l[0]);break;case _util.OPS.setGState:this.setGState(l[0]);break;case _util.OPS.fill:this.fill();break;case _util.OPS.eoFill:this.eoFill();break;case _util.OPS.stroke:this.stroke();break;case _util.OPS.fillStroke:this.fillStroke();break;case _util.OPS.eoFillStroke:this.eoFillStroke();break;case _util.OPS.clip:this.clip("nonzero");break;case _util.OPS.eoClip:this.clip("evenodd");break;case _util.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case _util.OPS.paintImageXObject:this.paintImageXObject(l[0]);break;case _util.OPS.paintInlineImageXObject:this.paintInlineImageXObject(l[0]);break;case _util.OPS.paintImageMaskXObject:this.paintImageMaskXObject(l[0]);break;case _util.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(l[0],l[1]);break;case _util.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case _util.OPS.closePath:this.closePath();break;case _util.OPS.closeStroke:this.closeStroke();break;case _util.OPS.closeFillStroke:this.closeFillStroke();break;case _util.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case _util.OPS.nextLine:this.nextLine();break;case _util.OPS.transform:this.transform(l[0],l[1],l[2],l[3],l[4],l[5]);break;case _util.OPS.constructPath:this.constructPath(l[0],l[1]);break;case _util.OPS.endPath:this.endPath();break;case 92:this.group(i.items);break;default:(0,_util.warn)("Unimplemented operator ".concat(n))}}}catch(t){r.e(t)}finally{r.f()}}},{key:"setWordSpacing",value:function(t){this.current.wordSpacing=t}},{key:"setCharSpacing",value:function(t){this.current.charSpacing=t}},{key:"nextLine",value:function(){this.moveText(0,this.current.leading)}},{key:"setTextMatrix",value:function(t,e,r,i,n,a){var l=this.current;l.textMatrix=l.lineMatrix=[t,e,r,i,n,a],l.textMatrixScale=Math.hypot(t,e),l.x=l.lineX=0,l.y=l.lineY=0,l.xcoords=[],l.ycoords=[],l.tspan=this.svgFactory.createElement("svg:tspan"),l.tspan.setAttributeNS(null,"font-family",l.fontFamily),l.tspan.setAttributeNS(null,"font-size","".concat(pf(l.fontSize),"px")),l.tspan.setAttributeNS(null,"y",pf(-l.y)),l.txtElement=this.svgFactory.createElement("svg:text"),l.txtElement.appendChild(l.tspan)}},{key:"beginText",value:function(){var t=this.current;t.x=t.lineX=0,t.y=t.lineY=0,t.textMatrix=_util.IDENTITY_MATRIX,t.lineMatrix=_util.IDENTITY_MATRIX,t.textMatrixScale=1,t.tspan=this.svgFactory.createElement("svg:tspan"),t.txtElement=this.svgFactory.createElement("svg:text"),t.txtgrp=this.svgFactory.createElement("svg:g"),t.xcoords=[],t.ycoords=[]}},{key:"moveText",value:function(t,e){var r=this.current;r.x=r.lineX+=t,r.y=r.lineY+=e,r.xcoords=[],r.ycoords=[],r.tspan=this.svgFactory.createElement("svg:tspan"),r.tspan.setAttributeNS(null,"font-family",r.fontFamily),r.tspan.setAttributeNS(null,"font-size","".concat(pf(r.fontSize),"px")),r.tspan.setAttributeNS(null,"y",pf(-r.y))}},{key:"showText",value:function(t){var e=this.current,r=e.font,i=e.fontSize;if(0!==i){var n,a=e.fontSizeScale,l=e.charSpacing,s=e.wordSpacing,o=e.fontDirection,u=e.textHScale*o,c=r.vertical,h=c?1:-1,p=r.defaultVMetrics,f=i*e.fontMatrix[0],d=0,S=_createForOfIteratorHelper(t);try{for(S.s();!(n=S.n()).done;){var y=n.value;if(null!==y)if((0,_util.isNum)(y))d+=h*y*i/1e3;else{var v=(y.isSpace?s:0)+l,b=y.fontChar,m=void 0,g=void 0,_=y.width;if(c){var k=void 0,A=y.vmetric||p;k=-(k=y.vmetric?A[1]:.5*_)*f;var x=A[2]*f;_=A?-A[0]:_,m=k/a,g=(d+x)/a}else m=d/a,g=0;(y.isInFont||r.missingFile)&&(e.xcoords.push(e.x+m),c&&e.ycoords.push(-e.y+g),e.tspan.textContent+=b);d+=c?_*f-v*o:_*f+v*o}else d+=o*s}}catch(t){S.e(t)}finally{S.f()}e.tspan.setAttributeNS(null,"x",e.xcoords.map(pf).join(" ")),c?e.tspan.setAttributeNS(null,"y",e.ycoords.map(pf).join(" ")):e.tspan.setAttributeNS(null,"y",pf(-e.y)),c?e.y-=d:e.x+=d*u,e.tspan.setAttributeNS(null,"font-family",e.fontFamily),e.tspan.setAttributeNS(null,"font-size","".concat(pf(e.fontSize),"px")),e.fontStyle!==SVG_DEFAULTS.fontStyle&&e.tspan.setAttributeNS(null,"font-style",e.fontStyle),e.fontWeight!==SVG_DEFAULTS.fontWeight&&e.tspan.setAttributeNS(null,"font-weight",e.fontWeight);var N=e.textRenderingMode&_util.TextRenderingMode.FILL_STROKE_MASK;if(N===_util.TextRenderingMode.FILL||N===_util.TextRenderingMode.FILL_STROKE?(e.fillColor!==SVG_DEFAULTS.fillColor&&e.tspan.setAttributeNS(null,"fill",e.fillColor),e.fillAlpha<1&&e.tspan.setAttributeNS(null,"fill-opacity",e.fillAlpha)):e.textRenderingMode===_util.TextRenderingMode.ADD_TO_PATH?e.tspan.setAttributeNS(null,"fill","transparent"):e.tspan.setAttributeNS(null,"fill","none"),N===_util.TextRenderingMode.STROKE||N===_util.TextRenderingMode.FILL_STROKE){var T=1/(e.textMatrixScale||1);this._setStrokeAttributes(e.tspan,T)}var C=e.textMatrix;0!==e.textRise&&((C=C.slice())[5]+=e.textRise),e.txtElement.setAttributeNS(null,"transform","".concat(pm(C)," scale(").concat(pf(u),", -1)")),e.txtElement.setAttributeNS(XML_NS,"xml:space","preserve"),e.txtElement.appendChild(e.tspan),e.txtgrp.appendChild(e.txtElement),this._ensureTransformGroup().appendChild(e.txtElement)}}},{key:"setLeadingMoveText",value:function(t,e){this.setLeading(-e),this.moveText(t,e)}},{key:"addFontStyle",value:function(t){if(!t.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.appendChild(this.cssStyle));var e=(0,_util.createObjectURL)(t.data,t.mimetype,this.forceDataSchema);this.cssStyle.textContent+='@font-face { font-family: "'.concat(t.loadedName,'";')+" src: url(".concat(e,"); }\n")}},{key:"setFont",value:function(t){var e=this.current,r=this.commonObjs.get(t[0]),i=t[1];e.font=r,!this.embedFonts||r.missingFile||this.embeddedFonts[r.loadedName]||(this.addFontStyle(r),this.embeddedFonts[r.loadedName]=r),e.fontMatrix=r.fontMatrix||_util.FONT_IDENTITY_MATRIX;var n="normal";r.black?n="900":r.bold&&(n="bold");var a=r.italic?"italic":"normal";e.fontDirection=i<0?(i=-i,-1):1,e.fontSize=i,e.fontFamily=r.loadedName,e.fontWeight=n,e.fontStyle=a,e.tspan=this.svgFactory.createElement("svg:tspan"),e.tspan.setAttributeNS(null,"y",pf(-e.y)),e.xcoords=[],e.ycoords=[]}},{key:"endText",value:function(){var t,e=this.current;e.textRenderingMode&_util.TextRenderingMode.ADD_TO_PATH_FLAG&&null!==(t=e.txtElement)&&void 0!==t&&t.hasChildNodes()&&(e.element=e.txtElement,this.clip("nonzero"),this.endPath())}},{key:"setLineWidth",value:function(t){0<t&&(this.current.lineWidth=t)}},{key:"setLineCap",value:function(t){this.current.lineCap=LINE_CAP_STYLES[t]}},{key:"setLineJoin",value:function(t){this.current.lineJoin=LINE_JOIN_STYLES[t]}},{key:"setMiterLimit",value:function(t){this.current.miterLimit=t}},{key:"setStrokeAlpha",value:function(t){this.current.strokeAlpha=t}},{key:"setStrokeRGBColor",value:function(t,e,r){this.current.strokeColor=_util.Util.makeHexColor(t,e,r)}},{key:"setFillAlpha",value:function(t){this.current.fillAlpha=t}},{key:"setFillRGBColor",value:function(t,e,r){this.current.fillColor=_util.Util.makeHexColor(t,e,r),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}},{key:"setStrokeColorN",value:function(t){this.current.strokeColor=this._makeColorN_Pattern(t)}},{key:"setFillColorN",value:function(t){this.current.fillColor=this._makeColorN_Pattern(t)}},{key:"shadingFill",value:function(t){var e=this.viewport.width,r=this.viewport.height,i=_util.Util.inverseTransform(this.transformMatrix),n=_util.Util.applyTransform([0,0],i),a=_util.Util.applyTransform([0,r],i),l=_util.Util.applyTransform([e,0],i),s=_util.Util.applyTransform([e,r],i),o=Math.min(n[0],a[0],l[0],s[0]),u=Math.min(n[1],a[1],l[1],s[1]),c=Math.max(n[0],a[0],l[0],s[0]),h=Math.max(n[1],a[1],l[1],s[1]),p=this.svgFactory.createElement("svg:rect");p.setAttributeNS(null,"x",o),p.setAttributeNS(null,"y",u),p.setAttributeNS(null,"width",c-o),p.setAttributeNS(null,"height",h-u),p.setAttributeNS(null,"fill",this._makeShadingPattern(t)),this.current.fillAlpha<1&&p.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().appendChild(p)}},{key:"_makeColorN_Pattern",value:function(t){return"TilingPattern"===t[0]?this._makeTilingPattern(t):this._makeShadingPattern(t)}},{key:"_makeTilingPattern",value:function(t){var e=t[1],r=t[2],i=t[3]||_util.IDENTITY_MATRIX,n=_slicedToArray(t[4],4),a=n[0],l=n[1],s=n[2],o=n[3],u=t[5],c=t[6],h=t[7],p="shading".concat(shadingCount++),f=_slicedToArray(_util.Util.applyTransform([a,l],i),2),d=f[0],S=f[1],y=_slicedToArray(_util.Util.applyTransform([s,o],i),2),v=y[0],b=y[1],m=_slicedToArray(_util.Util.singularValueDecompose2dScale(i),2),g=u*m[0],_=c*m[1],k=this.svgFactory.createElement("svg:pattern");k.setAttributeNS(null,"id",p),k.setAttributeNS(null,"patternUnits","userSpaceOnUse"),k.setAttributeNS(null,"width",g),k.setAttributeNS(null,"height",_),k.setAttributeNS(null,"x","".concat(d)),k.setAttributeNS(null,"y","".concat(S));var A=this.svg,x=this.transformMatrix,N=this.current.fillColor,T=this.current.strokeColor,C=this.svgFactory.create(v-d,b-S);if(this.svg=C,this.transformMatrix=i,2===h){var P,O=(P=_util.Util).makeHexColor.apply(P,_toConsumableArray(e));this.current.fillColor=O,this.current.strokeColor=O}return this.executeOpTree(this.convertOpList(r)),this.svg=A,this.transformMatrix=x,this.current.fillColor=N,this.current.strokeColor=T,k.appendChild(C.childNodes[0]),this.defs.appendChild(k),"url(#".concat(p,")")}},{key:"_makeShadingPattern",value:function(t){switch(t[0]){case"RadialAxial":var e,r="shading".concat(shadingCount++),i=t[3];switch(t[1]){case"axial":var n=t[4],a=t[5];(e=this.svgFactory.createElement("svg:linearGradient")).setAttributeNS(null,"id",r),e.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),e.setAttributeNS(null,"x1",n[0]),e.setAttributeNS(null,"y1",n[1]),e.setAttributeNS(null,"x2",a[0]),e.setAttributeNS(null,"y2",a[1]);break;case"radial":var l=t[4],s=t[5],o=t[6],u=t[7];(e=this.svgFactory.createElement("svg:radialGradient")).setAttributeNS(null,"id",r),e.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),e.setAttributeNS(null,"cx",s[0]),e.setAttributeNS(null,"cy",s[1]),e.setAttributeNS(null,"r",u),e.setAttributeNS(null,"fx",l[0]),e.setAttributeNS(null,"fy",l[1]),e.setAttributeNS(null,"fr",o);break;default:throw new Error("Unknown RadialAxial type: ".concat(t[1]))}var c,h=_createForOfIteratorHelper(i);try{for(h.s();!(c=h.n()).done;){var p=c.value,f=this.svgFactory.createElement("svg:stop");f.setAttributeNS(null,"offset",p[0]),f.setAttributeNS(null,"stop-color",p[1]),e.appendChild(f)}}catch(t){h.e(t)}finally{h.f()}return this.defs.appendChild(e),"url(#".concat(r,")");case"Mesh":return(0,_util.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error("Unknown IR type: ".concat(t[0]))}}},{key:"setDash",value:function(t,e){this.current.dashArray=t,this.current.dashPhase=e}},{key:"constructPath",value:function(t,e){var r,i=this.current,n=i.x,a=i.y,l=[],s=0,o=_createForOfIteratorHelper(t);try{for(o.s();!(r=o.n()).done;){switch(0|r.value){case _util.OPS.rectangle:n=e[s++],a=e[s++];var u=e[s++],c=e[s++],h=n+u,p=a+c;l.push("M",pf(n),pf(a),"L",pf(h),pf(a),"L",pf(h),pf(p),"L",pf(n),pf(p),"Z");break;case _util.OPS.moveTo:n=e[s++],a=e[s++],l.push("M",pf(n),pf(a));break;case _util.OPS.lineTo:n=e[s++],a=e[s++],l.push("L",pf(n),pf(a));break;case _util.OPS.curveTo:n=e[s+4],a=e[s+5],l.push("C",pf(e[s]),pf(e[s+1]),pf(e[s+2]),pf(e[s+3]),pf(n),pf(a)),s+=6;break;case _util.OPS.curveTo2:l.push("C",pf(n),pf(a),pf(e[s]),pf(e[s+1]),pf(e[s+2]),pf(e[s+3])),n=e[s+2],a=e[s+3],s+=4;break;case _util.OPS.curveTo3:n=e[s+2],a=e[s+3],l.push("C",pf(e[s]),pf(e[s+1]),pf(n),pf(a),pf(n),pf(a)),s+=4;break;case _util.OPS.closePath:l.push("Z")}}}catch(t){o.e(t)}finally{o.f()}l=l.join(" "),i.path&&0<t.length&&t[0]!==_util.OPS.rectangle&&t[0]!==_util.OPS.moveTo?l=i.path.getAttributeNS(null,"d")+l:(i.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().appendChild(i.path)),i.path.setAttributeNS(null,"d",l),i.path.setAttributeNS(null,"fill","none"),i.element=i.path,i.setCurrentPoint(n,a)}},{key:"endPath",value:function(){var t=this.current;if(t.path=null,this.pendingClip)if(t.element){var e="clippath".concat(clipCount++),r=this.svgFactory.createElement("svg:clipPath");r.setAttributeNS(null,"id",e),r.setAttributeNS(null,"transform",pm(this.transformMatrix));var i=t.element.cloneNode(!0);"evenodd"===this.pendingClip?i.setAttributeNS(null,"clip-rule","evenodd"):i.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,r.appendChild(i),this.defs.appendChild(r),t.activeClipUrl&&(t.clipGroup=null,this.extraStack.forEach(function(t){t.clipGroup=null}),r.setAttributeNS(null,"clip-path",t.activeClipUrl)),t.activeClipUrl="url(#".concat(e,")"),this.tgrp=null}else this.pendingClip=null}},{key:"clip",value:function(t){this.pendingClip=t}},{key:"closePath",value:function(){var t=this.current;if(t.path){var e="".concat(t.path.getAttributeNS(null,"d"),"Z");t.path.setAttributeNS(null,"d",e)}}},{key:"setLeading",value:function(t){this.current.leading=-t}},{key:"setTextRise",value:function(t){this.current.textRise=t}},{key:"setTextRenderingMode",value:function(t){this.current.textRenderingMode=t}},{key:"setHScale",value:function(t){this.current.textHScale=t/100}},{key:"setRenderingIntent",value:function(t){}},{key:"setFlatness",value:function(t){}},{key:"setGState",value:function(t){var e,r=_createForOfIteratorHelper(t);try{for(r.s();!(e=r.n()).done;){var i=_slicedToArray(e.value,2),n=i[0],a=i[1];switch(n){case"LW":this.setLineWidth(a);break;case"LC":this.setLineCap(a);break;case"LJ":this.setLineJoin(a);break;case"ML":this.setMiterLimit(a);break;case"D":this.setDash(a[0],a[1]);break;case"RI":this.setRenderingIntent(a);break;case"FL":this.setFlatness(a);break;case"Font":this.setFont(a);break;case"CA":this.setStrokeAlpha(a);break;case"ca":this.setFillAlpha(a);break;default:(0,_util.warn)("Unimplemented graphic state operator ".concat(n))}}}catch(t){r.e(t)}finally{r.f()}}},{key:"fill",value:function(){var t=this.current;t.element&&(t.element.setAttributeNS(null,"fill",t.fillColor),t.element.setAttributeNS(null,"fill-opacity",t.fillAlpha),this.endPath())}},{key:"stroke",value:function(){var t=this.current;t.element&&(this._setStrokeAttributes(t.element),t.element.setAttributeNS(null,"fill","none"),this.endPath())}},{key:"_setStrokeAttributes",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=this.current,i=r.dashArray;1!==e&&0<i.length&&(i=i.map(function(t){return e*t})),t.setAttributeNS(null,"stroke",r.strokeColor),t.setAttributeNS(null,"stroke-opacity",r.strokeAlpha),t.setAttributeNS(null,"stroke-miterlimit",pf(r.miterLimit)),t.setAttributeNS(null,"stroke-linecap",r.lineCap),t.setAttributeNS(null,"stroke-linejoin",r.lineJoin),t.setAttributeNS(null,"stroke-width",pf(e*r.lineWidth)+"px"),t.setAttributeNS(null,"stroke-dasharray",i.map(pf).join(" ")),t.setAttributeNS(null,"stroke-dashoffset",pf(e*r.dashPhase)+"px")}},{key:"eoFill",value:function(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}},{key:"fillStroke",value:function(){this.stroke(),this.fill()}},{key:"eoFillStroke",value:function(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}},{key:"closeStroke",value:function(){this.closePath(),this.stroke()}},{key:"closeFillStroke",value:function(){this.closePath(),this.fillStroke()}},{key:"closeEOFillStroke",value:function(){this.closePath(),this.eoFillStroke()}},{key:"paintSolidColorImageMask",value:function(){var t=this.svgFactory.createElement("svg:rect");t.setAttributeNS(null,"x","0"),t.setAttributeNS(null,"y","0"),t.setAttributeNS(null,"width","1px"),t.setAttributeNS(null,"height","1px"),t.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().appendChild(t)}},{key:"paintImageXObject",value:function(t){var e=t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t);e?this.paintInlineImageXObject(e):(0,_util.warn)("Dependent image with object ID ".concat(t," is not ready yet"))}},{key:"paintInlineImageXObject",value:function(t,e){var r=t.width,i=t.height,n=convertImgDataToPng(t,this.forceDataSchema,!!e),a=this.svgFactory.createElement("svg:rect");a.setAttributeNS(null,"x","0"),a.setAttributeNS(null,"y","0"),a.setAttributeNS(null,"width",pf(r)),a.setAttributeNS(null,"height",pf(i)),this.current.element=a,this.clip("nonzero");var l=this.svgFactory.createElement("svg:image");l.setAttributeNS(XLINK_NS,"xlink:href",n),l.setAttributeNS(null,"x","0"),l.setAttributeNS(null,"y",pf(-i)),l.setAttributeNS(null,"width",pf(r)+"px"),l.setAttributeNS(null,"height",pf(i)+"px"),l.setAttributeNS(null,"transform","scale(".concat(pf(1/r)," ").concat(pf(-1/i),")")),e?e.appendChild(l):this._ensureTransformGroup().appendChild(l)}},{key:"paintImageMaskXObject",value:function(t){var e=this.current,r=t.width,i=t.height,n=e.fillColor;e.maskId="mask".concat(maskCount++);var a=this.svgFactory.createElement("svg:mask");a.setAttributeNS(null,"id",e.maskId);var l=this.svgFactory.createElement("svg:rect");l.setAttributeNS(null,"x","0"),l.setAttributeNS(null,"y","0"),l.setAttributeNS(null,"width",pf(r)),l.setAttributeNS(null,"height",pf(i)),l.setAttributeNS(null,"fill",n),l.setAttributeNS(null,"mask","url(#".concat(e.maskId,")")),this.defs.appendChild(a),this._ensureTransformGroup().appendChild(l),this.paintInlineImageXObject(t,a)}},{key:"paintFormXObjectBegin",value:function(t,e){if(Array.isArray(t)&&6===t.length&&this.transform(t[0],t[1],t[2],t[3],t[4],t[5]),e){var r=e[2]-e[0],i=e[3]-e[1],n=this.svgFactory.createElement("svg:rect");n.setAttributeNS(null,"x",e[0]),n.setAttributeNS(null,"y",e[1]),n.setAttributeNS(null,"width",pf(r)),n.setAttributeNS(null,"height",pf(i)),this.current.element=n,this.clip("nonzero"),this.endPath()}}},{key:"paintFormXObjectEnd",value:function(){}},{key:"_initialize",value:function(t){var e=this.svgFactory.create(t.width,t.height),r=this.svgFactory.createElement("svg:defs");e.appendChild(r),this.defs=r;var i=this.svgFactory.createElement("svg:g");return i.setAttributeNS(null,"transform",pm(t.transform)),e.appendChild(i),this.svg=i,e}},{key:"_ensureClipGroup",value:function(){if(!this.current.clipGroup){var t=this.svgFactory.createElement("svg:g");t.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.appendChild(t),this.current.clipGroup=t}return this.current.clipGroup}},{key:"_ensureTransformGroup",value:function(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",pm(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().appendChild(this.tgrp):this.svg.appendChild(this.tgrp)),this.tgrp}}]),n}();