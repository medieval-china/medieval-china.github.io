"use strict";var _test_utils=require("./test_utils.js"),_api=require("../../display/api.js"),_is_node=require("../../shared/is_node.js"),_svg=require("../../display/svg.js"),XLINK_NS="http://www.w3.org/1999/xlink";function withZlib(e,t){if(e){if(!_is_node.isNodeJS)throw new Error("zlib test can only be run in Node.js");return t()}if(!_is_node.isNodeJS)return t();var i=require("zlib"),n=i.deflateSync;function o(){throw new Error("zlib.deflateSync is explicitly disabled for testing.")}function r(){i.deflateSync===o&&(i.deflateSync=n)}i.deflateSync=o;var s=t();return s.then(r,r),s}describe("SVGGraphics",function(){var i,o;beforeAll(function(t){(i=(0,_api.getDocument)((0,_test_utils.buildGetDocumentParams)("xobject-image.pdf"))).promise.then(function(e){e.getPage(1).then(function(e){o=e,t()})})}),afterAll(function(e){i.destroy().then(e)}),describe("paintImageXObject",function(){function t(){var n;return o.getOperatorList().then(function(e){return(n=new _svg.SVGGraphics(o.commonObjs,o.objs,!0)).loadDependencies(e)}).then(function(){var t,e={appendChild:function(e){t=e}};_is_node.isNodeJS&&(0,require("../../examples/node/domstubs.js").setStubs)(global);try{var i=n.objs.get("img_p0_1");n.paintInlineImageXObject(i,e)}finally{if(_is_node.isNodeJS)(0,require("../../examples/node/domstubs.js").unsetStubs)(global)}return t})}it('should fail require("zlib") unless in Node.js',function(){function e(){require("zlib")}_is_node.isNodeJS?(expect(e.toString()).toMatch(/\srequire\(["']zlib["']\)/),expect(e).not.toThrow()):expect(e).toThrow()}),it("should produce a reasonably small svg:image",function(e){_is_node.isNodeJS||pending("zlib.deflateSync is not supported in non-Node environments."),withZlib(!0,t).then(function(e){expect(e.nodeName).toBe("svg:image"),expect(e.getAttributeNS(null,"width")).toBe("200px"),expect(e.getAttributeNS(null,"height")).toBe("100px");var t=e.getAttributeNS(XLINK_NS,"href");expect(t).toMatch(/^data:image\/png;base64,/),expect(t.length).toBeLessThan(367)}).then(e,e.fail)}),it("should be able to produce a svg:image without zlib",function(e){withZlib(!1,t).then(function(e){expect(e.nodeName).toBe("svg:image"),expect(e.getAttributeNS(null,"width")).toBe("200px"),expect(e.getAttributeNS(null,"height")).toBe("100px");var t=e.getAttributeNS(XLINK_NS,"href");expect(t).toMatch(/^data:image\/png;base64,/),expect(t.length).toBe(80246)}).then(e,e.fail)})})});