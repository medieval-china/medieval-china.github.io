"use strict";var _util=require("../../shared/util.js"),_fetch_stream=require("../../display/fetch_stream.js");describe("fetch_stream",function(){var p=new URL("../pdfs/tracemonkey.pdf",window.location).href,g=1016315;it("read with streaming",function(e){var t,a,n=new _fetch_stream.PDFFetchStream({url:p,disableStream:!1,disableRange:!0}).getFullReader(),r=n.headersReady.then(function(){t=n.isStreamingSupported,a=n.isRangeSupported}),u=0;Promise.all([function t(){return n.read().then(function(e){if(!e.done)return u+=e.value.byteLength,t()})}(),r]).then(function(){expect(u).toEqual(g),expect(t).toEqual(!0),expect(a).toEqual(!1),e()}).catch(e.fail)}),it("read ranges with streaming",function(e){var t,a,n,r=32768,u=new _fetch_stream.PDFFetchStream({url:p,rangeChunkSize:r,disableStream:!1,disableRange:!1}),i=u.getFullReader(),l=i.headersReady.then(function(){t=i.isStreamingSupported,a=i.isRangeSupported,i.cancel(new _util.AbortException("Don't need fullReader.")),n=!0}),c=507,o=u.getRangeReader(g-c-r,g-c),d=u.getRangeReader(g-c,g),s={value:0},f={value:0},h=function t(a,n){return a.read().then(function(e){if(!e.done)return n.value+=e.value.byteLength,t(a,n)})};Promise.all([h(o,s),h(d,f),l]).then(function(){expect(t).toEqual(!0),expect(a).toEqual(!0),expect(n).toEqual(!0),expect(s.value).toEqual(r),expect(f.value).toEqual(c),e()}).catch(e.fail)})});