"use strict";var _primitives=require("../../core/primitives.js"),_writer=require("../../core/writer.js"),_util=require("../../shared/util.js"),_stream=require("../../core/stream.js");describe("Writer",function(){describe("Incremental update",function(){it("should update a file with new objects",function(e){var t=new Uint8Array,i=[{ref:_primitives.Ref.get(123,45),data:"abc\n"},{ref:_primitives.Ref.get(456,78),data:"defg\n"}],r={newRef:_primitives.Ref.get(789,0),startXRef:314,fileIds:["id",""],rootRef:null,infoRef:null,encrypt:null,filename:"foo.pdf",info:{}},n=(0,_writer.incrementalUpdate)({originalData:t,xrefInfo:r,newRefs:i});n=(0,_util.bytesToString)(n);expect(n).toEqual("\nabc\ndefg\n789 0 obj\n<< /Size 790 /Prev 314 /Type /XRef /Index [0 1 123 1 456 1 789 1] /ID [(id) (#Eg«ÍïþÜºvT2)] /W [1 1 2] /Length 16>> stream\n\0ÿÿ\0-\0N\n\0\0\nendstream\nendobj\nstartxref\n10\n%%EOF\n"),e()})}),describe("writeDict",function(){it("should write a Dict",function(e){var t=new _primitives.Dict(null);t.set("A",_primitives.Name.get("B")),t.set("B",_primitives.Ref.get(123,456)),t.set("C",789),t.set("D","hello world"),t.set("E","(hello\\world)"),t.set("F",[1.23001,4.50001,6]);var i=new _primitives.Dict(null);i.set("H",123.00001);var r="a stream",n=new _stream.StringStream(r);n.dict=new _primitives.Dict(null),n.dict.set("Length",r.length),i.set("I",n),t.set("G",i);var l=[];(0,_writer.writeDict)(t,l,null);expect(l.join("")).toEqual("<< /A /B /B 123 456 R /C 789 /D (hello world) /E (\\(hello\\\\world\\)) /F [1.23 4.5 6] /G << /H 123 /I << /Length 8>> stream\na stream\nendstream\n>>>>"),e()}),it("should write a Dict in escaping PDF names",function(e){var t=new _primitives.Dict(null);t.set("þA#",_primitives.Name.get("hello")),t.set("B",_primitives.Name.get("#hello")),t.set("C",_primitives.Name.get("heþlloÿ"));var i=[];(0,_writer.writeDict)(t,i,null);expect(i.join("")).toEqual("<< /#feA#23 /hello /B /#23hello /C /he#fello#ff>>"),e()})})});