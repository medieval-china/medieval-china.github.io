"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function _iterableToArrayLimit(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a,n,l,r,o=[],s=!0,f=!1;try{if(l=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;s=!1}else for(;!(s=(a=l.call(i)).done)&&(o.push(a.value),o.length!==t);s=!0);}catch(e){f=!0,n=e}finally{try{if(!s&&null!=i.return&&(r=i.return(),Object(r)!==r))return}finally{if(f)throw n}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var _display_utils=require("../../display/display_utils.js"),_util=require("../../shared/util.js"),_is_node=require("../../shared/is_node.js");describe("display_utils",function(){describe("DOMCanvasFactory",function(){var a;beforeAll(function(e){a=new _display_utils.DOMCanvasFactory,e()}),afterAll(function(){a=null}),it("`create` should throw an error if the dimensions are invalid",function(){expect(function(){return a.create(-1,1)}).toThrow(new Error("Invalid canvas size")),expect(function(){return a.create(1,-1)}).toThrow(new Error("Invalid canvas size"))}),it("`create` should return a canvas if the dimensions are valid",function(){_is_node.isNodeJS&&pending("Document is not supported in Node.js.");var e=a.create(20,40),t=e.canvas,i=e.context;expect(t instanceof HTMLCanvasElement).toBe(!0),expect(i instanceof CanvasRenderingContext2D).toBe(!0),expect(t.width).toBe(20),expect(t.height).toBe(40)}),it("`reset` should throw an error if no canvas is provided",function(){var e={canvas:null,context:null};expect(function(){return a.reset(e,20,40)}).toThrow(new Error("Canvas is not specified"))}),it("`reset` should throw an error if the dimensions are invalid",function(){var e={canvas:"foo",context:"bar"};expect(function(){return a.reset(e,-1,1)}).toThrow(new Error("Invalid canvas size")),expect(function(){return a.reset(e,1,-1)}).toThrow(new Error("Invalid canvas size"))}),it("`reset` should alter the canvas/context if the dimensions are valid",function(){_is_node.isNodeJS&&pending("Document is not supported in Node.js.");var e=a.create(20,40);a.reset(e,60,80);var t=e.canvas,i=e.context;expect(t instanceof HTMLCanvasElement).toBe(!0),expect(i instanceof CanvasRenderingContext2D).toBe(!0),expect(t.width).toBe(60),expect(t.height).toBe(80)}),it("`destroy` should throw an error if no canvas is provided",function(){expect(function(){return a.destroy({})}).toThrow(new Error("Canvas is not specified"))}),it("`destroy` should clear the canvas/context",function(){_is_node.isNodeJS&&pending("Document is not supported in Node.js.");var e=a.create(20,40);a.destroy(e);var t=e.canvas,i=e.context;expect(t).toBe(null),expect(i).toBe(null)})}),describe("DOMSVGFactory",function(){var t;beforeAll(function(e){t=new _display_utils.DOMSVGFactory,e()}),afterAll(function(){t=null}),it("`create` should throw an error if the dimensions are invalid",function(){expect(function(){return t.create(-1,0)}).toThrow(new Error("Invalid SVG dimensions")),expect(function(){return t.create(0,-1)}).toThrow(new Error("Invalid SVG dimensions"))}),it("`create` should return an SVG element if the dimensions are valid",function(){_is_node.isNodeJS&&pending("Document is not supported in Node.js.");var e=t.create(20,40);expect(e instanceof SVGSVGElement).toBe(!0),expect(e.getAttribute("version")).toBe("1.1"),expect(e.getAttribute("width")).toBe("20px"),expect(e.getAttribute("height")).toBe("40px"),expect(e.getAttribute("preserveAspectRatio")).toBe("none"),expect(e.getAttribute("viewBox")).toBe("0 0 20 40")}),it("`createElement` should throw an error if the type is not a string",function(){expect(function(){return t.createElement(!0)}).toThrow(new Error("Invalid SVG element type"))}),it("`createElement` should return an SVG element if the type is valid",function(){_is_node.isNodeJS&&pending("Document is not supported in Node.js.");var e=t.createElement("svg:rect");expect(e instanceof SVGRectElement).toBe(!0)})}),describe("getFilenameFromUrl",function(){it("should get the filename from an absolute URL",function(){expect((0,_display_utils.getFilenameFromUrl)("https://server.org/filename.pdf")).toEqual("filename.pdf")}),it("should get the filename from a relative URL",function(){expect((0,_display_utils.getFilenameFromUrl)("../../filename.pdf")).toEqual("filename.pdf")}),it("should get the filename from a URL with an anchor",function(){expect((0,_display_utils.getFilenameFromUrl)("https://server.org/filename.pdf#foo")).toEqual("filename.pdf")}),it("should get the filename from a URL with query parameters",function(){expect((0,_display_utils.getFilenameFromUrl)("https://server.org/filename.pdf?foo=bar")).toEqual("filename.pdf")})}),describe("getPdfFilenameFromUrl",function(){it("gets PDF filename",function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/file1.pdf")).toEqual("file1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/pdfs/file2.pdf")).toEqual("file2.pdf")}),it("gets fallback filename",function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/file1.txt")).toEqual("document.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/pdfs/file2.txt")).toEqual("document.pdf")}),it("gets custom fallback filename",function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/file1.txt","qwerty1.pdf")).toEqual("qwerty1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/pdfs/file2.txt","qwerty2.pdf")).toEqual("qwerty2.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/file3.txt","")).toEqual("")}),it("gets fallback filename when url is not a string",function(){expect((0,_display_utils.getPdfFilenameFromUrl)(null)).toEqual("document.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)(null,"file.pdf")).toEqual("file.pdf")}),it("gets PDF filename from URL containing leading/trailing whitespace",function(){expect((0,_display_utils.getPdfFilenameFromUrl)("   /pdfs/file1.pdf   ")).toEqual("file1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("   http://www.example.com/pdfs/file2.pdf   ")).toEqual("file2.pdf")}),it("gets PDF filename from query string",function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/pdfs.html?name=file1.pdf")).toEqual("file1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/pdfs/pdf.html?file2.pdf")).toEqual("file2.pdf")}),it("gets PDF filename from hash string",function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/pdfs.html#name=file1.pdf")).toEqual("file1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/pdfs/pdf.html#file2.pdf")).toEqual("file2.pdf")}),it("gets correct PDF filename when multiple ones are present",function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/file1.pdf?name=file.pdf")).toEqual("file1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/pdfs/file2.pdf#file.pdf")).toEqual("file2.pdf")}),it("gets PDF filename from URI-encoded data",function(){var e=encodeURIComponent("http://www.example.com/pdfs/file1.pdf");expect((0,_display_utils.getPdfFilenameFromUrl)(e)).toEqual("file1.pdf");var t=encodeURIComponent("http://www.example.com/pdfs/file.txt?file2.pdf");expect((0,_display_utils.getPdfFilenameFromUrl)(t)).toEqual("file2.pdf")}),it("gets PDF filename from data mistaken for URI-encoded",function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/%AA.pdf")).toEqual("%AA.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/%2F.pdf")).toEqual("%2F.pdf")}),it("gets PDF filename from (some) standard protocols",function(){expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/file1.pdf")).toEqual("file1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("https://www.example.com/file2.pdf")).toEqual("file2.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("file:///path/to/files/file3.pdf")).toEqual("file3.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("ftp://www.example.com/file4.pdf")).toEqual("file4.pdf")}),it('gets PDF filename from query string appended to "blob:" URL',function(){_is_node.isNodeJS&&pending("Blob in not supported in Node.js.");var e=new Uint8Array([1,2,3,4,5]),t=(0,_util.createObjectURL)(e,"application/pdf");expect(t.startsWith("blob:")).toEqual(!0),expect((0,_display_utils.getPdfFilenameFromUrl)(t+"?file.pdf")).toEqual("file.pdf")}),it('gets fallback filename from query string appended to "data:" URL',function(){var e=new Uint8Array([1,2,3,4,5]),t=(0,_util.createObjectURL)(e,"application/pdf",!0);expect(t.startsWith("data:")).toEqual(!0),expect((0,_display_utils.getPdfFilenameFromUrl)(t+"?file1.pdf")).toEqual("document.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("     "+t+"?file2.pdf")).toEqual("document.pdf")})}),describe("isValidFetchUrl",function(){it("handles invalid Fetch URLs",function(){expect((0,_display_utils.isValidFetchUrl)(null)).toEqual(!1),expect((0,_display_utils.isValidFetchUrl)(100)).toEqual(!1),expect((0,_display_utils.isValidFetchUrl)("foo")).toEqual(!1),expect((0,_display_utils.isValidFetchUrl)("/foo",100)).toEqual(!1)}),it("handles relative Fetch URLs",function(){expect((0,_display_utils.isValidFetchUrl)("/foo","file://www.example.com")).toEqual(!1),expect((0,_display_utils.isValidFetchUrl)("/foo","http://www.example.com")).toEqual(!0)}),it("handles unsupported Fetch protocols",function(){expect((0,_display_utils.isValidFetchUrl)("file://www.example.com")).toEqual(!1),expect((0,_display_utils.isValidFetchUrl)("ftp://www.example.com")).toEqual(!1)}),it("handles supported Fetch protocols",function(){expect((0,_display_utils.isValidFetchUrl)("http://www.example.com")).toEqual(!0),expect((0,_display_utils.isValidFetchUrl)("https://www.example.com")).toEqual(!0)})}),describe("PDFDateString",function(){describe("toDateObject",function(){it("converts PDF date strings to JavaScript `Date` objects",function(){for(var e={undefined:null,null:null,42:null,2019:null,D2019:null,"D:":null,"D:201":null,"D:2019":new Date(Date.UTC(2019,0,1,0,0,0)),"D:20190":new Date(Date.UTC(2019,0,1,0,0,0)),"D:201900":new Date(Date.UTC(2019,0,1,0,0,0)),"D:201913":new Date(Date.UTC(2019,0,1,0,0,0)),"D:201902":new Date(Date.UTC(2019,1,1,0,0,0)),"D:2019020":new Date(Date.UTC(2019,1,1,0,0,0)),"D:20190200":new Date(Date.UTC(2019,1,1,0,0,0)),"D:20190232":new Date(Date.UTC(2019,1,1,0,0,0)),"D:20190203":new Date(Date.UTC(2019,1,3,0,0,0)),"D:20190431":new Date(Date.UTC(2019,4,1,0,0,0)),"D:201902030":new Date(Date.UTC(2019,1,3,0,0,0)),"D:2019020300":new Date(Date.UTC(2019,1,3,0,0,0)),"D:2019020324":new Date(Date.UTC(2019,1,3,0,0,0)),"D:2019020304":new Date(Date.UTC(2019,1,3,4,0,0)),"D:20190203040":new Date(Date.UTC(2019,1,3,4,0,0)),"D:201902030400":new Date(Date.UTC(2019,1,3,4,0,0)),"D:201902030460":new Date(Date.UTC(2019,1,3,4,0,0)),"D:201902030405":new Date(Date.UTC(2019,1,3,4,5,0)),"D:2019020304050":new Date(Date.UTC(2019,1,3,4,5,0)),"D:20190203040500":new Date(Date.UTC(2019,1,3,4,5,0)),"D:20190203040560":new Date(Date.UTC(2019,1,3,4,5,0)),"D:20190203040506":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506F":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506Z":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506-":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506+":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506+'":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506+0":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506+01":new Date(Date.UTC(2019,1,3,3,5,6)),"D:20190203040506+00'":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506+24'":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506+01'":new Date(Date.UTC(2019,1,3,3,5,6)),"D:20190203040506+01'0":new Date(Date.UTC(2019,1,3,3,5,6)),"D:20190203040506+01'00":new Date(Date.UTC(2019,1,3,3,5,6)),"D:20190203040506+01'60":new Date(Date.UTC(2019,1,3,3,5,6)),"D:20190203040506+0102":new Date(Date.UTC(2019,1,3,3,3,6)),"D:20190203040506+01'02":new Date(Date.UTC(2019,1,3,3,3,6)),"D:20190203040506+01'02'":new Date(Date.UTC(2019,1,3,3,3,6)),"D:20190203040506+05'07":new Date(Date.UTC(2019,1,2,22,58,6))},t=0,i=Object.entries(e);t<i.length;t++){var a=_slicedToArray(i[t],2),n=a[0],l=a[1],r=_display_utils.PDFDateString.toDateObject(n);r?expect(r.getTime()).toEqual(l.getTime()):expect(r).toEqual(l)}})})})});