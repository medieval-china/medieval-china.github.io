"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FirefoxPrintService=FirefoxPrintService;var _pdf=require("../pdf"),_app=require("./app.js");function composePage(r,t,o,e,n,a){var c=document.createElement("canvas"),l=n/72;c.width=Math.floor(o.width*l),c.height=Math.floor(o.height*l);var i=document.createElement("div");i.appendChild(c),e.appendChild(i);var p=null;c.mozPrintCallback=function(e){var n=e.context;n.save(),n.fillStyle="rgb(255, 255, 255)",n.fillRect(0,0,c.width,c.height),n.restore();var i=null;r.getPage(t).then(function(t){p&&(p.cancel(),p=null);var e={canvasContext:n,transform:[l,0,0,l,0,0],viewport:t.getViewport({scale:1,rotation:o.rotation}),intent:"print",annotationStorage:r.annotationStorage,optionalContentConfigPromise:a};return p=i=t.render(e),i.promise}).then(function(){p===i&&(p=null),e.done()},function(t){t instanceof _pdf.RenderingCancelledException||console.error(t),p===i&&(p.cancel(),p=null),"abort"in e?e.abort():e.done()})}}function FirefoxPrintService(t,e,n,i){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;this.pdfDocument=t,this.pagesOverview=e,this.printContainer=n,this._printResolution=i||150,this._optionalContentConfigPromise=r||t.getOptionalContentConfig()}FirefoxPrintService.prototype={layout:function(){var t=this.pdfDocument,e=this.pagesOverview,n=this.printContainer,i=this._printResolution,r=this._optionalContentConfigPromise;document.querySelector("body").setAttribute("data-pdfjsprinting",!0);for(var o=0,a=e.length;o<a;++o)composePage(t,o+1,e[o],n,i,r)},destroy:function(){this.printContainer.textContent="",document.querySelector("body").removeAttribute("data-pdfjsprinting")}},_app.PDFPrintServiceFactory.instance={get supportsPrinting(){var t="mozPrintCallback"in document.createElement("canvas");return(0,_pdf.shadow)(this,"supportsPrinting",t)},createPrintService:function(t,e,n,i,r){return new FirefoxPrintService(t,e,n,i,r)}};