"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);var n=i.call(t,e||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.PDFFindBar=void 0;var _pdf_find_controller=require("./pdf_find_controller.js"),MATCHES_COUNT_LIMIT=1e3,PDFFindBar=function(){function s(t,e,i){var n=this;_classCallCheck(this,s),this.opened=!1,this.bar=t.bar,this.toggleButton=t.toggleButton,this.findField=t.findField,this.highlightAll=t.highlightAllCheckbox,this.caseSensitive=t.caseSensitiveCheckbox,this.entireWord=t.entireWordCheckbox,this.findMsg=t.findMsg,this.findResultsCount=t.findResultsCount,this.findPreviousButton=t.findPreviousButton,this.findNextButton=t.findNextButton,this.eventBus=e,this.l10n=i,this.toggleButton.addEventListener("click",function(){n.toggle()}),this.findField.addEventListener("input",function(){n.dispatchEvent("")}),this.bar.addEventListener("keydown",function(t){switch(t.keyCode){case 13:t.target===n.findField&&n.dispatchEvent("again",t.shiftKey);break;case 27:n.close()}}),this.findPreviousButton.addEventListener("click",function(){n.dispatchEvent("again",!0)}),this.findNextButton.addEventListener("click",function(){n.dispatchEvent("again",!1)}),this.highlightAll.addEventListener("click",function(){n.dispatchEvent("highlightallchange")}),this.caseSensitive.addEventListener("click",function(){n.dispatchEvent("casesensitivitychange")}),this.entireWord.addEventListener("click",function(){n.dispatchEvent("entirewordchange")}),this.eventBus._on("resize",this._adjustWidth.bind(this))}return _createClass(s,[{key:"reset",value:function(){this.updateUIState()}},{key:"dispatchEvent",value:function(t,e){this.eventBus.dispatch("find",{source:this,type:t,query:this.findField.value,phraseSearch:!0,caseSensitive:this.caseSensitive.checked,entireWord:this.entireWord.checked,highlightAll:this.highlightAll.checked,findPrevious:e})}},{key:"updateUIState",value:function(t,e,i){var n=this,s=Promise.resolve(""),o="";switch(t){case _pdf_find_controller.FindState.FOUND:break;case _pdf_find_controller.FindState.PENDING:o="pending";break;case _pdf_find_controller.FindState.NOT_FOUND:s=this.l10n.get("find_not_found"),o="notFound";break;case _pdf_find_controller.FindState.WRAPPED:s=this.l10n.get("find_reached_".concat(e?"top":"bottom"))}this.findField.setAttribute("data-status",o),s.then(function(t){n.findMsg.textContent=t,n._adjustWidth()}),this.updateResultsCount(i)}},{key:"updateResultsCount",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=t.current,n=void 0===i?0:i,s=t.total,o=void 0===s?0:s,r=MATCHES_COUNT_LIMIT,a=Promise.resolve("");if(0<o)if(r<o){a=this.l10n.get("find_match_count_limit",{limit:r})}else{a=this.l10n.get("find_match_count",{current:n,total:o})}a.then(function(t){e.findResultsCount.textContent=t,e.findResultsCount.classList.toggle("hidden",!o),e._adjustWidth()})}},{key:"open",value:function(){this.opened||(this.opened=!0,this.toggleButton.classList.add("toggled"),this.toggleButton.setAttribute("aria-expanded","true"),this.bar.classList.remove("hidden")),this.findField.select(),this.findField.focus(),this._adjustWidth()}},{key:"close",value:function(){this.opened&&(this.opened=!1,this.toggleButton.classList.remove("toggled"),this.toggleButton.setAttribute("aria-expanded","false"),this.bar.classList.add("hidden"),this.eventBus.dispatch("findbarclose",{source:this}))}},{key:"toggle",value:function(){this.opened?this.close():this.open()}},{key:"_adjustWidth",value:function(){if(this.opened){this.bar.classList.remove("wrapContainers");var t=this.bar.clientHeight;this.bar.firstElementChild.clientHeight<t&&this.bar.classList.add("wrapContainers")}}}]),s}();exports.PDFFindBar=PDFFindBar;