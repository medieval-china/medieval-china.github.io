"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _createForOfIteratorHelper(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);var r=i.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseViewer=void 0;var _pdf=require("../pdf"),_ui_utils=require("./ui_utils.js"),_pdf_rendering_queue=require("./pdf_rendering_queue.js"),_annotation_layer_builder=require("./annotation_layer_builder.js"),_l10n_utils=require("./l10n_utils.js"),_pdf_page_view=require("./pdf_page_view.js"),_pdf_link_service=require("./pdf_link_service.js"),_text_layer_builder=require("./text_layer_builder.js"),_xfa_layer_builder=require("./xfa_layer_builder.js"),DEFAULT_CACHE_SIZE=10;function PDFPageViewBuffer(a){var s=[];this.push=function(e){var t=s.indexOf(e);0<=t&&s.splice(t,1),s.push(e),s.length>a&&s.shift().destroy()},this.resize=function(e,t){if(a=e,t){for(var i=new Set,r=0,n=t.length;r<n;++r)i.add(t[r].id);(0,_ui_utils.moveToEndOfArray)(s,function(e){return i.has(e.id)})}for(;s.length>a;)s.shift().destroy()},this.has=function(e){return s.includes(e)}}function isSameScale(e,t){return t===e||Math.abs(t-e)<1e-15}var BaseViewer=function(){function a(e){var t,i,r=this;if(_classCallCheck(this,a),this.constructor===a)throw new Error("Cannot initialize BaseViewer.");var n="2.8.335";if(_pdf.version!==n)throw new Error('The API version "'.concat(_pdf.version,'" does not match the Viewer version "').concat(n,'".'));if(this._name=this.constructor.name,this.container=e.container,this.viewer=e.viewer||e.container.firstElementChild,"DIV"!==(null===(t=this.container)||void 0===t?void 0:t.tagName.toUpperCase())||"DIV"!==(null===(i=this.viewer)||void 0===i?void 0:i.tagName.toUpperCase()))throw new Error("Invalid `container` and/or `viewer` option.");if(this.container.offsetParent&&"absolute"!==getComputedStyle(this.container).position)throw new Error("The `container` must be absolutely positioned.");this.eventBus=e.eventBus,this.linkService=e.linkService||new _pdf_link_service.SimpleLinkService,this.downloadManager=e.downloadManager||null,this.findController=e.findController||null,this._scriptingManager=e.scriptingManager||null,this.removePageBorders=e.removePageBorders||!1,this.textLayerMode=Number.isInteger(e.textLayerMode)?e.textLayerMode:_ui_utils.TextLayerMode.ENABLE,this.imageResourcesPath=e.imageResourcesPath||"",this.renderInteractiveForms=!1!==e.renderInteractiveForms,this.enablePrintAutoRotate=e.enablePrintAutoRotate||!1,this.renderer=e.renderer||_ui_utils.RendererType.CANVAS,this.enableWebGL=e.enableWebGL||!1,this.useOnlyCssZoom=e.useOnlyCssZoom||!1,this.maxCanvasPixels=e.maxCanvasPixels,this.l10n=e.l10n||_l10n_utils.NullL10n,this.enableScripting=!0===e.enableScripting&&!!this._scriptingManager,this.defaultRenderingQueue=!e.renderingQueue,this.defaultRenderingQueue?(this.renderingQueue=new _pdf_rendering_queue.PDFRenderingQueue,this.renderingQueue.setViewer(this)):this.renderingQueue=e.renderingQueue,this.scroll=(0,_ui_utils.watchScroll)(this.container,this._scrollUpdate.bind(this)),this.presentationModeState=_ui_utils.PresentationModeState.UNKNOWN,this._onBeforeDraw=this._onAfterDraw=null,this._resetView(),this.removePageBorders&&this.viewer.classList.add("removePageBorders"),Promise.resolve().then(function(){r.eventBus.dispatch("baseviewerinit",{source:r})})}return _createClass(a,[{key:"pagesCount",get:function(){return this._pages.length}},{key:"getPageView",value:function(e){return this._pages[e]}},{key:"pageViewsReady",get:function(){return!!this._pagesCapability.settled&&this._pages.every(function(e){return null==e?void 0:e.pdfPage})}},{key:"currentPageNumber",get:function(){return this._currentPageNumber},set:function(e){if(!Number.isInteger(e))throw new Error("Invalid page number.");this.pdfDocument&&(this._setCurrentPageNumber(e,!0)||console.error("".concat(this._name,'.currentPageNumber: "').concat(e,'" is not a valid page.')))}},{key:"_setCurrentPageNumber",value:function(e){var t,i,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this._currentPageNumber===e)return r&&this._resetCurrentPageView(),!0;if(!(0<e&&e<=this.pagesCount))return!1;var n=this._currentPageNumber;return this._currentPageNumber=e,this.eventBus.dispatch("pagechanging",{source:this,pageNumber:e,pageLabel:null!==(t=null===(i=this._pageLabels)||void 0===i?void 0:i[e-1])&&void 0!==t?t:null,previous:n}),r&&this._resetCurrentPageView(),!0}},{key:"currentPageLabel",get:function(){var e,t;return null!==(e=null===(t=this._pageLabels)||void 0===t?void 0:t[this._currentPageNumber-1])&&void 0!==e?e:null},set:function(e){if(this.pdfDocument){var t=0|e;if(this._pageLabels){var i=this._pageLabels.indexOf(e);0<=i&&(t=i+1)}this._setCurrentPageNumber(t,!0)||console.error("".concat(this._name,'.currentPageLabel: "').concat(e,'" is not a valid page.'))}}},{key:"currentScale",get:function(){return this._currentScale!==_ui_utils.UNKNOWN_SCALE?this._currentScale:_ui_utils.DEFAULT_SCALE},set:function(e){if(isNaN(e))throw new Error("Invalid numeric scale.");this.pdfDocument&&this._setScale(e,!1)}},{key:"currentScaleValue",get:function(){return this._currentScaleValue},set:function(e){this.pdfDocument&&this._setScale(e,!1)}},{key:"pagesRotation",get:function(){return this._pagesRotation},set:function(e){if(!(0,_ui_utils.isValidRotation)(e))throw new Error("Invalid pages rotation angle.");if(this.pdfDocument&&((e%=360)<0&&(e+=360),this._pagesRotation!==e)){this._pagesRotation=e;for(var t=this._currentPageNumber,i=0,r=this._pages.length;i<r;i++){var n=this._pages[i];n.update(n.scale,e)}this._currentScaleValue&&this._setScale(this._currentScaleValue,!0),this.eventBus.dispatch("rotationchanging",{source:this,pagesRotation:e,pageNumber:t}),this.defaultRenderingQueue&&this.update()}}},{key:"firstPagePromise",get:function(){return this.pdfDocument?this._firstPageCapability.promise:null}},{key:"onePageRendered",get:function(){return this.pdfDocument?this._onePageRenderedCapability.promise:null}},{key:"pagesPromise",get:function(){return this.pdfDocument?this._pagesCapability.promise:null}},{key:"_viewerElement",get:function(){throw new Error("Not implemented: _viewerElement")}},{key:"_onePageRenderedOrForceFetch",value:function(){return this.container.offsetParent&&0!==this._getVisiblePages().views.length?this._onePageRenderedCapability.promise:Promise.resolve()}},{key:"setDocument",value:function(l){var u=this;if(this.pdfDocument&&(this.eventBus.dispatch("pagesdestroy",{source:this}),this._cancelRendering(),this._resetView(),this.findController&&this.findController.setDocument(null),this._scriptingManager&&this._scriptingManager.setDocument(null)),this.pdfDocument=l){var c=l.isPureXfa,h=l.numPages,e=l.getPage(1),d=l.getOptionalContentConfig();this._pagesCapability.promise.then(function(){u.eventBus.dispatch("pagesloaded",{source:u,pagesCount:h})}),this._onBeforeDraw=function(e){var t=u._pages[e.pageNumber-1];t&&u._buffer.push(t)},this.eventBus._on("pagerender",this._onBeforeDraw),this._onAfterDraw=function(e){e.cssTransform||u._onePageRenderedCapability.settled||(u._onePageRenderedCapability.resolve(),u.eventBus._off("pagerendered",u._onAfterDraw),u._onAfterDraw=null)},this.eventBus._on("pagerendered",this._onAfterDraw),e.then(function(e){u._firstPageCapability.resolve(e),u._optionalContentConfigPromise=d;for(var t=u.currentScale,i=e.getViewport({scale:t*_ui_utils.CSS_UNITS}),r=u.textLayerMode!==_ui_utils.TextLayerMode.DISABLE?u:null,n=c?u:null,a=1;a<=h;++a){var s=new _pdf_page_view.PDFPageView({container:u._viewerElement,eventBus:u.eventBus,id:a,scale:t,defaultViewport:i.clone(),optionalContentConfigPromise:d,renderingQueue:u.renderingQueue,textLayerFactory:r,textLayerMode:u.textLayerMode,annotationLayerFactory:u,xfaLayerFactory:n,imageResourcesPath:u.imageResourcesPath,renderInteractiveForms:u.renderInteractiveForms,renderer:u.renderer,enableWebGL:u.enableWebGL,useOnlyCssZoom:u.useOnlyCssZoom,maxCanvasPixels:u.maxCanvasPixels,l10n:u.l10n,enableScripting:u.enableScripting});u._pages.push(s)}var o=u._pages[0];o&&(o.setPdfPage(e),u.linkService.cachePageRef(1,e.ref)),u._spreadMode!==_ui_utils.SpreadMode.NONE&&u._updateSpreadMode(),u._onePageRenderedOrForceFetch().then(function(){if(u.findController&&u.findController.setDocument(l),u.enableScripting&&u._scriptingManager.setDocument(l),l.loadingParams.disableAutoFetch||7500<h)u._pagesCapability.resolve();else{var r=h-1;if(r<=0)u._pagesCapability.resolve();else for(var e=function(i){l.getPage(i).then(function(e){var t=u._pages[i-1];t.pdfPage||t.setPdfPage(e),u.linkService.cachePageRef(i,e.ref),0==--r&&u._pagesCapability.resolve()},function(e){console.error("Unable to get page ".concat(i," to initialize viewer"),e),0==--r&&u._pagesCapability.resolve()})},t=2;t<=h;++t)e(t)}}),u.eventBus.dispatch("pagesinit",{source:u}),u.defaultRenderingQueue&&u.update()}).catch(function(e){console.error("Unable to initialize viewer",e)})}}},{key:"setPageLabels",value:function(e){if(this.pdfDocument){e?Array.isArray(e)&&this.pdfDocument.numPages===e.length?this._pageLabels=e:(this._pageLabels=null,console.error("".concat(this._name,".setPageLabels: Invalid page labels."))):this._pageLabels=null;for(var t=0,i=this._pages.length;t<i;t++){var r,n;this._pages[t].setPageLabel(null!==(r=null===(n=this._pageLabels)||void 0===n?void 0:n[t])&&void 0!==r?r:null)}}}},{key:"_resetView",value:function(){this._pages=[],this._currentPageNumber=1,this._currentScale=_ui_utils.UNKNOWN_SCALE,this._currentScaleValue=null,this._pageLabels=null,this._buffer=new PDFPageViewBuffer(DEFAULT_CACHE_SIZE),this._location=null,this._pagesRotation=0,this._optionalContentConfigPromise=null,this._pagesRequests=new WeakMap,this._firstPageCapability=(0,_pdf.createPromiseCapability)(),this._onePageRenderedCapability=(0,_pdf.createPromiseCapability)(),this._pagesCapability=(0,_pdf.createPromiseCapability)(),this._scrollMode=_ui_utils.ScrollMode.VERTICAL,this._spreadMode=_ui_utils.SpreadMode.NONE,this._onBeforeDraw&&(this.eventBus._off("pagerender",this._onBeforeDraw),this._onBeforeDraw=null),this._onAfterDraw&&(this.eventBus._off("pagerendered",this._onAfterDraw),this._onAfterDraw=null),this.viewer.textContent="",this._updateScrollMode()}},{key:"_scrollUpdate",value:function(){0!==this.pagesCount&&this.update()}},{key:"_scrollIntoView",value:function(e){var t=e.pageDiv,i=e.pageSpot,r=void 0===i?null:i;e.pageNumber;(0,_ui_utils.scrollIntoView)(t,r)}},{key:"_setScaleUpdatePages",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(this._currentScaleValue=t.toString(),isSameScale(this._currentScale,e))r&&this.eventBus.dispatch("scalechanging",{source:this,scale:e,presetValue:t});else{for(var n=0,a=this._pages.length;n<a;n++)this._pages[n].update(e);if(this._currentScale=e,!i){var s,o=this._currentPageNumber;!this._location||this.isInPresentationMode||this.isChangingPresentationMode||(o=this._location.pageNumber,s=[null,{name:"XYZ"},this._location.left,this._location.top,null]),this.scrollPageIntoView({pageNumber:o,destArray:s,allowNegativeOffset:!0})}this.eventBus.dispatch("scalechanging",{source:this,scale:e,presetValue:r?t:void 0}),this.defaultRenderingQueue&&this.update()}}},{key:"_pageWidthScaleFactor",get:function(){return this._spreadMode===_ui_utils.SpreadMode.NONE||this._scrollMode===_ui_utils.ScrollMode.HORIZONTAL||this.isInPresentationMode?1:2}},{key:"_setScale",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=parseFloat(e);if(0<i)this._setScaleUpdatePages(i,e,t,!1);else{var r=this._pages[this._currentPageNumber-1];if(!r)return;var n=this.isInPresentationMode||this.removePageBorders,a=n?0:_ui_utils.SCROLLBAR_PADDING,s=n?0:_ui_utils.VERTICAL_PADDING;if(!n&&this._isScrollModeHorizontal){var o=[s,a];a=o[0],s=o[1]}var l=(this.container.clientWidth-a)/r.width*r.scale/this._pageWidthScaleFactor,u=(this.container.clientHeight-s)/r.height*r.scale;switch(e){case"page-actual":i=1;break;case"page-width":i=l;break;case"page-height":i=u;break;case"page-fit":i=Math.min(l,u);break;case"auto":var c=(0,_ui_utils.isPortraitOrientation)(r)?l:Math.min(u,l);i=Math.min(_ui_utils.MAX_AUTO_SCALE,c);break;default:return void console.error("".concat(this._name,'._setScale: "').concat(e,'" is an unknown zoom value.'))}this._setScaleUpdatePages(i,e,t,!0)}}},{key:"_resetCurrentPageView",value:function(){this.isInPresentationMode&&this._setScale(this._currentScaleValue,!0);var e=this._pages[this._currentPageNumber-1];this._scrollIntoView({pageDiv:e.div})}},{key:"pageLabelToPageNumber",value:function(e){if(!this._pageLabels)return null;var t=this._pageLabels.indexOf(e);return t<0?null:t+1}},{key:"scrollPageIntoView",value:function(e){var t=e.pageNumber,i=e.destArray,r=void 0===i?null:i,n=e.allowNegativeOffset,a=void 0!==n&&n,s=e.ignoreDestinationZoom,o=void 0!==s&&s;if(this.pdfDocument){var l=Number.isInteger(t)&&this._pages[t-1];if(l)if(!this.isInPresentationMode&&r){var u,c,h=0,d=0,_=0,g=0,p=l.rotation%180!=0,f=(p?l.height:l.width)/l.scale/_ui_utils.CSS_UNITS,v=(p?l.width:l.height)/l.scale/_ui_utils.CSS_UNITS,m=0;switch(r[1].name){case"XYZ":h=r[2],d=r[3],m=r[4],h=null!==h?h:0,d=null!==d?d:v;break;case"Fit":case"FitB":m="page-fit";break;case"FitH":case"FitBH":m="page-width",null===(d=r[2])&&this._location?(h=this._location.left,d=this._location.top):"number"!=typeof d&&(d=v);break;case"FitV":case"FitBV":h=r[2],_=f,g=v,m="page-height";break;case"FitR":h=r[2],d=r[3],_=r[4]-h,g=r[5]-d;var y=this.removePageBorders?0:_ui_utils.SCROLLBAR_PADDING,P=this.removePageBorders?0:_ui_utils.VERTICAL_PADDING;u=(this.container.clientWidth-y)/_/_ui_utils.CSS_UNITS,c=(this.container.clientHeight-P)/g/_ui_utils.CSS_UNITS,m=Math.min(Math.abs(u),Math.abs(c));break;default:return void console.error("".concat(this._name,".scrollPageIntoView: ")+'"'.concat(r[1].name,'" is not a valid destination type.'))}if(o||(m&&m!==this._currentScale?this.currentScaleValue=m:this._currentScale===_ui_utils.UNKNOWN_SCALE&&(this.currentScaleValue=_ui_utils.DEFAULT_SCALE_VALUE)),"page-fit"!==m||r[4]){var b=[l.viewport.convertToViewportPoint(h,d),l.viewport.convertToViewportPoint(h+_,d+g)],S=Math.min(b[0][0],b[1][0]),w=Math.min(b[0][1],b[1][1]);a||(S=Math.max(S,0),w=Math.max(w,0)),this._scrollIntoView({pageDiv:l.div,pageSpot:{left:S,top:w},pageNumber:t})}else this._scrollIntoView({pageDiv:l.div,pageNumber:t})}else this._setCurrentPageNumber(t,!0);else console.error("".concat(this._name,".scrollPageIntoView: ")+'"'.concat(t,'" is not a valid pageNumber parameter.'))}}},{key:"_updateLocation",value:function(e){var t=this._currentScale,i=this._currentScaleValue,r=parseFloat(i)===t?Math.round(1e4*t)/100:i,n=e.id,a="#page="+n;a+="&zoom="+r;var s=this._pages[n-1],o=this.container,l=s.getPagePoint(o.scrollLeft-e.x,o.scrollTop-e.y),u=Math.round(l[0]),c=Math.round(l[1]);a+=","+u+","+c,this._location={pageNumber:n,scale:r,top:c,left:u,rotation:this._pagesRotation,pdfOpenParams:a}}},{key:"_updateHelper",value:function(e){throw new Error("Not implemented: _updateHelper")}},{key:"update",value:function(){var e=this._getVisiblePages(),t=e.views,i=t.length;if(0!==i){var r=Math.max(DEFAULT_CACHE_SIZE,2*i+1);this._buffer.resize(r,t),this.renderingQueue.renderHighestPriority(e),this._updateHelper(t),this._updateLocation(e.first),this.eventBus.dispatch("updateviewarea",{source:this,location:this._location})}}},{key:"containsElement",value:function(e){return this.container.contains(e)}},{key:"focus",value:function(){this.container.focus()}},{key:"_isScrollModeHorizontal",get:function(){return!this.isInPresentationMode&&this._scrollMode===_ui_utils.ScrollMode.HORIZONTAL}},{key:"_isContainerRtl",get:function(){return"rtl"===getComputedStyle(this.container).direction}},{key:"isInPresentationMode",get:function(){return this.presentationModeState===_ui_utils.PresentationModeState.FULLSCREEN}},{key:"isChangingPresentationMode",get:function(){return this.presentationModeState===_ui_utils.PresentationModeState.CHANGING}},{key:"isHorizontalScrollbarEnabled",get:function(){return!this.isInPresentationMode&&this.container.scrollWidth>this.container.clientWidth}},{key:"isVerticalScrollbarEnabled",get:function(){return!this.isInPresentationMode&&this.container.scrollHeight>this.container.clientHeight}},{key:"_getCurrentVisiblePage",value:function(){if(!this.pagesCount)return{views:[]};var e=this._pages[this._currentPageNumber-1],t=e.div,i={id:e.id,x:t.offsetLeft+t.clientLeft,y:t.offsetTop+t.clientTop,view:e};return{first:i,last:i,views:[i]}}},{key:"_getVisiblePages",value:function(){return(0,_ui_utils.getVisibleElements)({scrollEl:this.container,views:this._pages,sortByVisibility:!0,horizontal:this._isScrollModeHorizontal,rtl:this._isScrollModeHorizontal&&this._isContainerRtl})}},{key:"isPageVisible",value:function(t){return!!this.pdfDocument&&(Number.isInteger(t)&&0<t&&t<=this.pagesCount?this._getVisiblePages().views.some(function(e){return e.id===t}):(console.error("".concat(this._name,'.isPageVisible: "').concat(t,'" is not a valid page.')),!1))}},{key:"isPageCached",value:function(e){if(!this.pdfDocument||!this._buffer)return!1;if(!(Number.isInteger(e)&&0<e&&e<=this.pagesCount))return console.error("".concat(this._name,'.isPageCached: "').concat(e,'" is not a valid page.')),!1;var t=this._pages[e-1];return!!t&&this._buffer.has(t)}},{key:"cleanup",value:function(){for(var e=0,t=this._pages.length;e<t;e++)this._pages[e]&&this._pages[e].renderingState!==_pdf_rendering_queue.RenderingStates.FINISHED&&this._pages[e].reset()}},{key:"_cancelRendering",value:function(){for(var e=0,t=this._pages.length;e<t;e++)this._pages[e]&&this._pages[e].cancelRendering()}},{key:"_ensurePdfPageLoaded",value:function(t){var i=this;if(t.pdfPage)return Promise.resolve(t.pdfPage);if(this._pagesRequests.has(t))return this._pagesRequests.get(t);var e=this.pdfDocument.getPage(t.id).then(function(e){return t.pdfPage||t.setPdfPage(e),i._pagesRequests.delete(t),e}).catch(function(e){console.error("Unable to get page for page view",e),i._pagesRequests.delete(t)});return this._pagesRequests.set(t,e),e}},{key:"forceRendering",value:function(e){var t=this,i=e||this._getVisiblePages(),r=this._isScrollModeHorizontal?this.scroll.right:this.scroll.down,n=this.renderingQueue.getHighestPriority(i,this._pages,r);return!!n&&(this._ensurePdfPageLoaded(n).then(function(){t.renderingQueue.renderView(n)}),!0)}},{key:"createTextLayerBuilder",value:function(e,t,i){var r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],n=4<arguments.length?arguments[4]:void 0;return new _text_layer_builder.TextLayerBuilder({textLayerDiv:e,eventBus:n,pageIndex:t,viewport:i,findController:this.isInPresentationMode?null:this.findController,enhanceTextSelection:!this.isInPresentationMode&&r})}},{key:"createAnnotationLayerBuilder",value:function(e,t){var i,r,n,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",o=4<arguments.length&&void 0!==arguments[4]&&arguments[4],l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:_l10n_utils.NullL10n,u=6<arguments.length&&void 0!==arguments[6]&&arguments[6],c=7<arguments.length&&void 0!==arguments[7]?arguments[7]:null,h=8<arguments.length&&void 0!==arguments[8]?arguments[8]:null;return new _annotation_layer_builder.AnnotationLayerBuilder({pageDiv:e,pdfPage:t,annotationStorage:a||(null===(i=this.pdfDocument)||void 0===i?void 0:i.annotationStorage),imageResourcesPath:s,renderInteractiveForms:o,linkService:this.linkService,downloadManager:this.downloadManager,l10n:l,enableScripting:u,hasJSActionsPromise:c||(null===(r=this.pdfDocument)||void 0===r?void 0:r.hasJSActions()),mouseState:h||(null===(n=this._scriptingManager)||void 0===n?void 0:n.mouseState)})}},{key:"createXfaLayerBuilder",value:function(e,t){return new _xfa_layer_builder.XfaLayerBuilder({pageDiv:e,pdfPage:t})}},{key:"hasEqualPageSizes",get:function(){for(var e=this._pages[0],t=1,i=this._pages.length;t<i;++t){var r=this._pages[t];if(r.width!==e.width||r.height!==e.height)return!1}return!0}},{key:"getPagesOverview",value:function(){var i=this;return this._pages.map(function(e){var t=e.pdfPage.getViewport({scale:1});return!i.enablePrintAutoRotate||(0,_ui_utils.isPortraitOrientation)(t)?{width:t.width,height:t.height,rotation:t.rotation}:{width:t.height,height:t.width,rotation:(t.rotation-90)%360}})}},{key:"optionalContentConfigPromise",get:function(){return this.pdfDocument?this._optionalContentConfigPromise?this._optionalContentConfigPromise:this.pdfDocument.getOptionalContentConfig():Promise.resolve(null)},set:function(e){if(!(e instanceof Promise))throw new Error("Invalid optionalContentConfigPromise: ".concat(e));if(this.pdfDocument&&this._optionalContentConfigPromise){this._optionalContentConfigPromise=e;var t,i=_createForOfIteratorHelper(this._pages);try{for(i.s();!(t=i.n()).done;){var r=t.value;r.update(r.scale,r.rotation,e)}}catch(e){i.e(e)}finally{i.f()}this.update(),this.eventBus.dispatch("optionalcontentconfigchanged",{source:this,promise:e})}}},{key:"scrollMode",get:function(){return this._scrollMode},set:function(e){if(this._scrollMode!==e){if(!(0,_ui_utils.isValidScrollMode)(e))throw new Error("Invalid scroll mode: ".concat(e));this._scrollMode=e,this.eventBus.dispatch("scrollmodechanged",{source:this,mode:e}),this._updateScrollMode(this._currentPageNumber)}}},{key:"_updateScrollMode",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=this._scrollMode,i=this.viewer;i.classList.toggle("scrollHorizontal",t===_ui_utils.ScrollMode.HORIZONTAL),i.classList.toggle("scrollWrapped",t===_ui_utils.ScrollMode.WRAPPED),this.pdfDocument&&e&&(this._currentScaleValue&&isNaN(this._currentScaleValue)&&this._setScale(this._currentScaleValue,!0),this._setCurrentPageNumber(e,!0),this.update())}},{key:"spreadMode",get:function(){return this._spreadMode},set:function(e){if(this._spreadMode!==e){if(!(0,_ui_utils.isValidSpreadMode)(e))throw new Error("Invalid spread mode: ".concat(e));this._spreadMode=e,this.eventBus.dispatch("spreadmodechanged",{source:this,mode:e}),this._updateSpreadMode(this._currentPageNumber)}}},{key:"_updateSpreadMode",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(this.pdfDocument){var t=this.viewer,i=this._pages;if(t.textContent="",this._spreadMode===_ui_utils.SpreadMode.NONE)for(var r=0,n=i.length;r<n;++r)t.appendChild(i[r].div);else for(var a=this._spreadMode-1,s=null,o=0,l=i.length;o<l;++o)null===s?((s=document.createElement("div")).className="spread",t.appendChild(s)):o%2===a&&(s=s.cloneNode(!1),t.appendChild(s)),s.appendChild(i[o].div);e&&(this._currentScaleValue&&isNaN(this._currentScaleValue)&&this._setScale(this._currentScaleValue,!0),this._setCurrentPageNumber(e,!0),this.update())}}},{key:"_getPageAdvance",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this.isInPresentationMode)return 1;switch(this._scrollMode){case _ui_utils.ScrollMode.WRAPPED:var i,r=this._getVisiblePages().views,n=new Map,a=_createForOfIteratorHelper(r);try{for(a.s();!(i=a.n()).done;){var s=i.value,o=s.id,l=s.y,u=s.percent,c=s.widthPercent;if(!(0===u||c<100)){var h=n.get(l);h||n.set(l,h||(h=[])),h.push(o)}}}catch(e){a.e(e)}finally{a.f()}var d,_=_createForOfIteratorHelper(n.values());try{for(_.s();!(d=_.n()).done;){var g=d.value,p=g.indexOf(e);if(-1!==p){var f=g.length;if(1===f)break;if(t)for(var v=p-1;0<=v;v--){var m=g[v],y=g[v+1]-1;if(m<y)return e-y}else for(var P=p+1,b=f;P<b;P++){var S=g[P],w=g[P-1]+1;if(w<S)return w-e}if(t){var C=g[0];if(C<e)return e-C+1}else{var M=g[f-1];if(e<M)return M-e+1}break}}}catch(e){_.e(e)}finally{_.f()}break;case _ui_utils.ScrollMode.HORIZONTAL:break;case _ui_utils.ScrollMode.VERTICAL:if(this._spreadMode===_ui_utils.SpreadMode.NONE)break;var N=this._spreadMode-1;if(t&&e%2!==N)break;if(!t&&e%2===N)break;var k,L=t?e-1:e+1,I=_createForOfIteratorHelper(this._getVisiblePages().views);try{for(I.s();!(k=I.n()).done;){var V=k.value,A=V.id,D=V.percent,R=V.widthPercent;if(A===L){if(0<D&&100===R)return 2;break}}}catch(e){I.e(e)}finally{I.f()}}return 1}},{key:"nextPage",value:function(){var e=this._currentPageNumber,t=this.pagesCount;if(t<=e)return!1;var i=this._getPageAdvance(e,!1)||1;return this.currentPageNumber=Math.min(e+i,t),!0}},{key:"previousPage",value:function(){var e=this._currentPageNumber;if(e<=1)return!1;var t=this._getPageAdvance(e,!0)||1;return this.currentPageNumber=Math.max(e-t,1),!0}}]),a}();exports.BaseViewer=BaseViewer;