"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,i,t){return i&&_defineProperties(e.prototype,i),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var i=_toPrimitive(e,"string");return"symbol"===_typeof(i)?i:String(i)}function _toPrimitive(e,i){if("object"!==_typeof(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===i?String:Number)(e);var r=t.call(e,i||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderingStates=exports.PDFRenderingQueue=void 0;var _pdf=require("../pdf"),CLEANUP_TIMEOUT=3e4,RenderingStates={INITIAL:0,RUNNING:1,PAUSED:2,FINISHED:3};exports.RenderingStates=RenderingStates;var PDFRenderingQueue=function(){function e(){_classCallCheck(this,e),this.pdfViewer=null,this.pdfThumbnailViewer=null,this.onIdle=null,this.highestPriorityPage=null,this.idleTimeout=null,this.printing=!1,this.isThumbnailViewEnabled=!1}return _createClass(e,[{key:"setViewer",value:function(e){this.pdfViewer=e}},{key:"setThumbnailViewer",value:function(e){this.pdfThumbnailViewer=e}},{key:"isHighestPriority",value:function(e){return this.highestPriorityPage===e.renderingId}},{key:"renderHighestPriority",value:function(e){this.idleTimeout&&(clearTimeout(this.idleTimeout),this.idleTimeout=null),this.pdfViewer.forceRendering(e)||this.pdfThumbnailViewer&&this.isThumbnailViewEnabled&&this.pdfThumbnailViewer.forceRendering()||this.printing||this.onIdle&&(this.idleTimeout=setTimeout(this.onIdle.bind(this),CLEANUP_TIMEOUT))}},{key:"getHighestPriority",value:function(e,i,t){var r=e.views,n=r.length;if(0===n)return null;for(var o=0;o<n;++o){var s=r[o].view;if(!this.isViewFinished(s))return s}if(t){var u=e.last.id;if(i[u]&&!this.isViewFinished(i[u]))return i[u]}else{var a=e.first.id-2;if(i[a]&&!this.isViewFinished(i[a]))return i[a]}return null}},{key:"isViewFinished",value:function(e){return e.renderingState===RenderingStates.FINISHED}},{key:"renderView",value:function(e){var i=this;switch(e.renderingState){case RenderingStates.FINISHED:return!1;case RenderingStates.PAUSED:this.highestPriorityPage=e.renderingId,e.resume();break;case RenderingStates.RUNNING:this.highestPriorityPage=e.renderingId;break;case RenderingStates.INITIAL:this.highestPriorityPage=e.renderingId,e.draw().finally(function(){i.renderHighestPriority()}).catch(function(e){e instanceof _pdf.RenderingCancelledException||console.error('renderView: "'.concat(e,'"'))})}return!0}}]),e}();exports.PDFRenderingQueue=PDFRenderingQueue;