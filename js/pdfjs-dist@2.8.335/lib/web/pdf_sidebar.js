"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,i,e){return i&&_defineProperties(t.prototype,i),e&&_defineProperties(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"===_typeof(i)?i:String(i)}function _toPrimitive(t,i){if("object"!==_typeof(t)||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0===e)return("string"===i?String:Number)(t);var n=e.call(t,i||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.PDFSidebar=void 0;var _ui_utils=require("./ui_utils.js"),_pdf_rendering_queue=require("./pdf_rendering_queue.js"),UI_NOTIFICATION_CLASS="pdfSidebarNotification",PDFSidebar=function(){function o(t){var i=t.elements,e=t.pdfViewer,n=t.pdfThumbnailViewer,s=t.eventBus,u=t.l10n;_classCallCheck(this,o),this.isOpen=!1,this.active=_ui_utils.SidebarView.THUMBS,this.isInitialViewSet=!1,this.onToggled=null,this.pdfViewer=e,this.pdfThumbnailViewer=n,this.outerContainer=i.outerContainer,this.viewerContainer=i.viewerContainer,this.toggleButton=i.toggleButton,this.thumbnailButton=i.thumbnailButton,this.outlineButton=i.outlineButton,this.attachmentsButton=i.attachmentsButton,this.layersButton=i.layersButton,this.thumbnailView=i.thumbnailView,this.outlineView=i.outlineView,this.attachmentsView=i.attachmentsView,this.layersView=i.layersView,this._outlineOptionsContainer=i.outlineOptionsContainer,this._currentOutlineItemButton=i.currentOutlineItemButton,this.eventBus=s,this.l10n=u,this._addEventListeners()}return _createClass(o,[{key:"reset",value:function(){this.isInitialViewSet=!1,this._hideUINotification(!0),this.switchView(_ui_utils.SidebarView.THUMBS),this.outlineButton.disabled=!1,this.attachmentsButton.disabled=!1,this.layersButton.disabled=!1,this._currentOutlineItemButton.disabled=!0}},{key:"visibleView",get:function(){return this.isOpen?this.active:_ui_utils.SidebarView.NONE}},{key:"isThumbnailViewVisible",get:function(){return this.isOpen&&this.active===_ui_utils.SidebarView.THUMBS}},{key:"isOutlineViewVisible",get:function(){return this.isOpen&&this.active===_ui_utils.SidebarView.OUTLINE}},{key:"isAttachmentsViewVisible",get:function(){return this.isOpen&&this.active===_ui_utils.SidebarView.ATTACHMENTS}},{key:"isLayersViewVisible",get:function(){return this.isOpen&&this.active===_ui_utils.SidebarView.LAYERS}},{key:"setInitialView",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:_ui_utils.SidebarView.NONE;this.isInitialViewSet||(this.isInitialViewSet=!0,t!==_ui_utils.SidebarView.NONE&&t!==_ui_utils.SidebarView.UNKNOWN&&this._switchView(t,!0)||this._dispatchEvent())}},{key:"switchView",value:function(t){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this._switchView(t,i)}},{key:"_switchView",value:function(t){var i=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=t!==this.active,n=!1;switch(t){case _ui_utils.SidebarView.NONE:return!!this.isOpen&&(this.close(),!0);case _ui_utils.SidebarView.THUMBS:this.isOpen&&e&&(n=!0);break;case _ui_utils.SidebarView.OUTLINE:if(this.outlineButton.disabled)return!1;break;case _ui_utils.SidebarView.ATTACHMENTS:if(this.attachmentsButton.disabled)return!1;break;case _ui_utils.SidebarView.LAYERS:if(this.layersButton.disabled)return!1;break;default:return console.error('PDFSidebar._switchView: "'.concat(t,'" is not a valid view.')),!1}return this.active=t,this.thumbnailButton.classList.toggle("toggled",t===_ui_utils.SidebarView.THUMBS),this.outlineButton.classList.toggle("toggled",t===_ui_utils.SidebarView.OUTLINE),this.attachmentsButton.classList.toggle("toggled",t===_ui_utils.SidebarView.ATTACHMENTS),this.layersButton.classList.toggle("toggled",t===_ui_utils.SidebarView.LAYERS),this.thumbnailView.classList.toggle("hidden",t!==_ui_utils.SidebarView.THUMBS),this.outlineView.classList.toggle("hidden",t!==_ui_utils.SidebarView.OUTLINE),this.attachmentsView.classList.toggle("hidden",t!==_ui_utils.SidebarView.ATTACHMENTS),this.layersView.classList.toggle("hidden",t!==_ui_utils.SidebarView.LAYERS),this._outlineOptionsContainer.classList.toggle("hidden",t!==_ui_utils.SidebarView.OUTLINE),i&&!this.isOpen?(this.open(),!0):(n&&(this._updateThumbnailViewer(),this._forceRendering()),e&&this._dispatchEvent(),e)}},{key:"open",value:function(){this.isOpen||(this.isOpen=!0,this.toggleButton.classList.add("toggled"),this.toggleButton.setAttribute("aria-expanded","true"),this.outerContainer.classList.add("sidebarMoving","sidebarOpen"),this.active===_ui_utils.SidebarView.THUMBS&&this._updateThumbnailViewer(),this._forceRendering(),this._dispatchEvent(),this._hideUINotification())}},{key:"close",value:function(){this.isOpen&&(this.isOpen=!1,this.toggleButton.classList.remove("toggled"),this.toggleButton.setAttribute("aria-expanded","false"),this.outerContainer.classList.add("sidebarMoving"),this.outerContainer.classList.remove("sidebarOpen"),this._forceRendering(),this._dispatchEvent())}},{key:"toggle",value:function(){this.isOpen?this.close():this.open()}},{key:"_dispatchEvent",value:function(){this.eventBus.dispatch("sidebarviewchanged",{source:this,view:this.visibleView})}},{key:"_forceRendering",value:function(){this.onToggled?this.onToggled():(this.pdfViewer.forceRendering(),this.pdfThumbnailViewer.forceRendering())}},{key:"_updateThumbnailViewer",value:function(){for(var t=this.pdfViewer,i=this.pdfThumbnailViewer,e=t.pagesCount,n=0;n<e;n++){var s=t.getPageView(n);if((null==s?void 0:s.renderingState)===_pdf_rendering_queue.RenderingStates.FINISHED)i.getThumbnail(n).setImage(s)}i.scrollThumbnailIntoView(t.currentPageNumber)}},{key:"_showUINotification",value:function(){var i=this;this.l10n.get("toggle_sidebar_notification2.title").then(function(t){i.toggleButton.title=t}),this.isOpen||this.toggleButton.classList.add(UI_NOTIFICATION_CLASS)}},{key:"_hideUINotification",value:function(){var i=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];(this.isOpen||t)&&this.toggleButton.classList.remove(UI_NOTIFICATION_CLASS),t&&this.l10n.get("toggle_sidebar.title").then(function(t){i.toggleButton.title=t})}},{key:"_addEventListeners",value:function(){var n=this;this.viewerContainer.addEventListener("transitionend",function(t){t.target===n.viewerContainer&&n.outerContainer.classList.remove("sidebarMoving")}),this.toggleButton.addEventListener("click",function(){n.toggle()}),this.thumbnailButton.addEventListener("click",function(){n.switchView(_ui_utils.SidebarView.THUMBS)}),this.outlineButton.addEventListener("click",function(){n.switchView(_ui_utils.SidebarView.OUTLINE)}),this.outlineButton.addEventListener("dblclick",function(){n.eventBus.dispatch("toggleoutlinetree",{source:n})}),this.attachmentsButton.addEventListener("click",function(){n.switchView(_ui_utils.SidebarView.ATTACHMENTS)}),this.layersButton.addEventListener("click",function(){n.switchView(_ui_utils.SidebarView.LAYERS)}),this.layersButton.addEventListener("dblclick",function(){n.eventBus.dispatch("resetlayers",{source:n})}),this._currentOutlineItemButton.addEventListener("click",function(){n.eventBus.dispatch("currentoutlineitem",{source:n})});var i=function(t,i,e){i.disabled=!t,t?n._showUINotification():n.active===e&&n.switchView(_ui_utils.SidebarView.THUMBS)};this.eventBus._on("outlineloaded",function(t){i(t.outlineCount,n.outlineButton,_ui_utils.SidebarView.OUTLINE),t.enableCurrentOutlineItemButton&&n.pdfViewer.pagesPromise.then(function(){n._currentOutlineItemButton.disabled=!n.isInitialViewSet})}),this.eventBus._on("attachmentsloaded",function(t){i(t.attachmentsCount,n.attachmentsButton,_ui_utils.SidebarView.ATTACHMENTS)}),this.eventBus._on("layersloaded",function(t){i(t.layersCount,n.layersButton,_ui_utils.SidebarView.LAYERS)}),this.eventBus._on("presentationmodechanged",function(t){t.state===_ui_utils.PresentationModeState.NORMAL&&n.isThumbnailViewVisible&&n._updateThumbnailViewer()})}}]),o}();exports.PDFSidebar=PDFSidebar;