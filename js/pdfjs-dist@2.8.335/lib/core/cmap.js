"use strict";function _regeneratorRuntime(){_regeneratorRuntime=function(){return o};var o={},e=Object.prototype,p=e.hasOwnProperty,f=Object.defineProperty||function(e,r,t){e[r]=t.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",t=r.asyncIterator||"@@asyncIterator",n=r.toStringTag||"@@toStringTag";function i(e,r,t){return Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}),e[r]}try{i({},"")}catch(e){i=function(e,r,t){return e[r]=t}}function u(e,r,t,n){var i,o,u,c,a=r&&r.prototype instanceof h?r:h,s=Object.create(a.prototype),p=new w(n||[]);return f(s,"_invoke",{value:(i=e,o=t,u=p,c="suspendedStart",function(e,r){if("executing"===c)throw new Error("Generator is already running");if("completed"===c){if("throw"===e)throw r;return k()}for(u.method=e,u.arg=r;;){var t=u.delegate;if(t){var n=_(t,u);if(n){if(n===d)continue;return n}}if("next"===u.method)u.sent=u._sent=u.arg;else if("throw"===u.method){if("suspendedStart"===c)throw c="completed",u.arg;u.dispatchException(u.arg)}else"return"===u.method&&u.abrupt("return",u.arg);c="executing";var a=l(i,o,u);if("normal"===a.type){if(c=u.done?"completed":"suspendedYield",a.arg===d)continue;return{value:a.arg,done:u.done}}"throw"===a.type&&(c="completed",u.method="throw",u.arg=a.arg)}})}),s}function l(e,r,t){try{return{type:"normal",arg:e.call(r,t)}}catch(e){return{type:"throw",arg:e}}}o.wrap=u;var d={};function h(){}function c(){}function s(){}var m={};i(m,a,function(){return this});var v=Object.getPrototypeOf,b=v&&v(v(H([])));b&&b!==e&&p.call(b,a)&&(m=b);var y=s.prototype=h.prototype=Object.create(m);function g(e){["next","throw","return"].forEach(function(r){i(e,r,function(e){return this._invoke(r,e)})})}function C(c,s){var r;f(this,"_invoke",{value:function(t,n){function e(){return new s(function(e,r){!function r(e,t,n,a){var i=l(c[e],c,t);if("throw"!==i.type){var o=i.arg,u=o.value;return u&&"object"==_typeof(u)&&p.call(u,"__await")?s.resolve(u.__await).then(function(e){r("next",e,n,a)},function(e){r("throw",e,n,a)}):s.resolve(u).then(function(e){o.value=e,n(o)},function(e){return r("throw",e,n,a)})}a(i.arg)}(t,n,e,r)})}return r=r?r.then(e,e):e()}})}function _(e,r){var t=r.method,n=e.iterator[t];if(void 0===n)return r.delegate=null,"throw"===t&&e.iterator.return&&(r.method="return",r.arg=void 0,_(e,r),"throw"===r.method)||"return"!==t&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+t+"' method")),d;var a=l(n,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,d;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,d):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,d)}function S(e){var r={tryLoc:e[0]};1 in e&&(r.catchLoc=e[1]),2 in e&&(r.finallyLoc=e[2],r.afterLoc=e[3]),this.tryEntries.push(r)}function U(e){var r=e.completion||{};r.type="normal",delete r.arg,e.completion=r}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function H(r){if(r){var e=r[a];if(e)return e.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var t=-1,n=function e(){for(;++t<r.length;)if(p.call(r,t))return e.value=r[t],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:k}}function k(){return{value:void 0,done:!0}}return f(y,"constructor",{value:c.prototype=s,configurable:!0}),f(s,"constructor",{value:c,configurable:!0}),c.displayName=i(s,n,"GeneratorFunction"),o.isGeneratorFunction=function(e){var r="function"==typeof e&&e.constructor;return!!r&&(r===c||"GeneratorFunction"===(r.displayName||r.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,i(e,n,"GeneratorFunction")),e.prototype=Object.create(y),e},o.awrap=function(e){return{__await:e}},g(C.prototype),i(C.prototype,t,function(){return this}),o.AsyncIterator=C,o.async=function(e,r,t,n,a){void 0===a&&(a=Promise);var i=new C(u(e,r,t,n),a);return o.isGeneratorFunction(r)?i:i.next().then(function(e){return e.done?e.value:i.next()})},g(y),i(y,n,"Generator"),i(y,a,function(){return this}),i(y,"toString",function(){return"[object Generator]"}),o.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},o.values=H,w.prototype={constructor:w,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(U),!e)for(var r in this)"t"===r.charAt(0)&&p.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function e(e,r){return i.type="throw",i.arg=t,n.next=e,r&&(n.method="next",n.arg=void 0),!!r}for(var r=this.tryEntries.length-1;0<=r;--r){var a=this.tryEntries[r],i=a.completion;if("root"===a.tryLoc)return e("end");if(a.tryLoc<=this.prev){var o=p.call(a,"catchLoc"),u=p.call(a,"finallyLoc");if(o&&u){if(this.prev<a.catchLoc)return e(a.catchLoc,!0);if(this.prev<a.finallyLoc)return e(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return e(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return e(a.finallyLoc)}}}},abrupt:function(e,r){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.tryLoc<=this.prev&&p.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=r&&r<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=r,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(i)},complete:function(e,r){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&r&&(this.next=r),d},finish:function(e){for(var r=this.tryEntries.length-1;0<=r;--r){var t=this.tryEntries[r];if(t.finallyLoc===e)return this.complete(t.completion,t.afterLoc),U(t),d}},catch:function(e){for(var r=this.tryEntries.length-1;0<=r;--r){var t=this.tryEntries[r];if(t.tryLoc===e){var n=t.completion;if("throw"===n.type){var a=n.arg;U(t)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,t){return this.delegate={iterator:H(e),resultName:r,nextLoc:t},"next"===this.method&&(this.arg=void 0),d}},o}function asyncGeneratorStep(e,r,t,n,a,i,o){try{var u=e[i](o),c=u.value}catch(e){return void t(e)}u.done?r(c):Promise.resolve(c).then(n,a)}function _asyncToGenerator(u){return function(){var e=this,o=arguments;return new Promise(function(r,t){var n=u.apply(e,o);function a(e){asyncGeneratorStep(n,r,t,a,i,"next",e)}function i(e){asyncGeneratorStep(n,r,t,a,i,"throw",e)}a(void 0)})}}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&_setPrototypeOf(e,r)}function _setPrototypeOf(e,r){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e})(e,r)}function _createSuper(n){var a=_isNativeReflectConstruct();return function(){var e,r=_getPrototypeOf(n);if(a){var t=_getPrototypeOf(this).constructor;e=Reflect.construct(r,arguments,t)}else e=r.apply(this,arguments);return _possibleConstructorReturn(this,e)}}function _possibleConstructorReturn(e,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var r=_toPrimitive(e,"string");return"symbol"===_typeof(r)?r:String(r)}function _toPrimitive(e,r){if("object"!==_typeof(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===r?String:Number)(e);var n=t.call(e,r||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.IdentityCMap=exports.CMapFactory=exports.CMap=void 0;var _util=require("../shared/util.js"),_primitives=require("./primitives.js"),_parser=require("./parser.js"),_core_utils=require("./core_utils.js"),_stream=require("./stream.js"),BUILT_IN_CMAPS=["Adobe-GB1-UCS2","Adobe-CNS1-UCS2","Adobe-Japan1-UCS2","Adobe-Korea1-UCS2","78-EUC-H","78-EUC-V","78-H","78-RKSJ-H","78-RKSJ-V","78-V","78ms-RKSJ-H","78ms-RKSJ-V","83pv-RKSJ-H","90ms-RKSJ-H","90ms-RKSJ-V","90msp-RKSJ-H","90msp-RKSJ-V","90pv-RKSJ-H","90pv-RKSJ-V","Add-H","Add-RKSJ-H","Add-RKSJ-V","Add-V","Adobe-CNS1-0","Adobe-CNS1-1","Adobe-CNS1-2","Adobe-CNS1-3","Adobe-CNS1-4","Adobe-CNS1-5","Adobe-CNS1-6","Adobe-GB1-0","Adobe-GB1-1","Adobe-GB1-2","Adobe-GB1-3","Adobe-GB1-4","Adobe-GB1-5","Adobe-Japan1-0","Adobe-Japan1-1","Adobe-Japan1-2","Adobe-Japan1-3","Adobe-Japan1-4","Adobe-Japan1-5","Adobe-Japan1-6","Adobe-Korea1-0","Adobe-Korea1-1","Adobe-Korea1-2","B5-H","B5-V","B5pc-H","B5pc-V","CNS-EUC-H","CNS-EUC-V","CNS1-H","CNS1-V","CNS2-H","CNS2-V","ETHK-B5-H","ETHK-B5-V","ETen-B5-H","ETen-B5-V","ETenms-B5-H","ETenms-B5-V","EUC-H","EUC-V","Ext-H","Ext-RKSJ-H","Ext-RKSJ-V","Ext-V","GB-EUC-H","GB-EUC-V","GB-H","GB-V","GBK-EUC-H","GBK-EUC-V","GBK2K-H","GBK2K-V","GBKp-EUC-H","GBKp-EUC-V","GBT-EUC-H","GBT-EUC-V","GBT-H","GBT-V","GBTpc-EUC-H","GBTpc-EUC-V","GBpc-EUC-H","GBpc-EUC-V","H","HKdla-B5-H","HKdla-B5-V","HKdlb-B5-H","HKdlb-B5-V","HKgccs-B5-H","HKgccs-B5-V","HKm314-B5-H","HKm314-B5-V","HKm471-B5-H","HKm471-B5-V","HKscs-B5-H","HKscs-B5-V","Hankaku","Hiragana","KSC-EUC-H","KSC-EUC-V","KSC-H","KSC-Johab-H","KSC-Johab-V","KSC-V","KSCms-UHC-H","KSCms-UHC-HW-H","KSCms-UHC-HW-V","KSCms-UHC-V","KSCpc-EUC-H","KSCpc-EUC-V","Katakana","NWP-H","NWP-V","RKSJ-H","RKSJ-V","Roman","UniCNS-UCS2-H","UniCNS-UCS2-V","UniCNS-UTF16-H","UniCNS-UTF16-V","UniCNS-UTF32-H","UniCNS-UTF32-V","UniCNS-UTF8-H","UniCNS-UTF8-V","UniGB-UCS2-H","UniGB-UCS2-V","UniGB-UTF16-H","UniGB-UTF16-V","UniGB-UTF32-H","UniGB-UTF32-V","UniGB-UTF8-H","UniGB-UTF8-V","UniJIS-UCS2-H","UniJIS-UCS2-HW-H","UniJIS-UCS2-HW-V","UniJIS-UCS2-V","UniJIS-UTF16-H","UniJIS-UTF16-V","UniJIS-UTF32-H","UniJIS-UTF32-V","UniJIS-UTF8-H","UniJIS-UTF8-V","UniJIS2004-UTF16-H","UniJIS2004-UTF16-V","UniJIS2004-UTF32-H","UniJIS2004-UTF32-V","UniJIS2004-UTF8-H","UniJIS2004-UTF8-V","UniJISPro-UCS2-HW-V","UniJISPro-UCS2-V","UniJISPro-UTF8-V","UniJISX0213-UTF32-H","UniJISX0213-UTF32-V","UniJISX02132004-UTF32-H","UniJISX02132004-UTF32-V","UniKS-UCS2-H","UniKS-UCS2-V","UniKS-UTF16-H","UniKS-UTF16-V","UniKS-UTF32-H","UniKS-UTF32-V","UniKS-UTF8-H","UniKS-UTF8-V","V","WP-Symbol"],MAX_MAP_RANGE=Math.pow(2,24)-1,CMap=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];_classCallCheck(this,r),this.codespaceRanges=[[],[],[],[]],this.numCodespaceRanges=0,this._map=[],this.name="",this.vertical=!1,this.useCMap=null,this.builtInCMap=e}return _createClass(r,[{key:"addCodespaceRange",value:function(e,r,t){this.codespaceRanges[e-1].push(r,t),this.numCodespaceRanges++}},{key:"mapCidRange",value:function(e,r,t){if(MAX_MAP_RANGE<r-e)throw new Error("mapCidRange - ignoring data above MAX_MAP_RANGE.");for(;e<=r;)this._map[e++]=t++}},{key:"mapBfRange",value:function(e,r,t){if(MAX_MAP_RANGE<r-e)throw new Error("mapBfRange - ignoring data above MAX_MAP_RANGE.");for(var n=t.length-1;e<=r;)t=(this._map[e++]=t).substring(0,n)+String.fromCharCode(t.charCodeAt(n)+1)}},{key:"mapBfRangeToArray",value:function(e,r,t){if(MAX_MAP_RANGE<r-e)throw new Error("mapBfRangeToArray - ignoring data above MAX_MAP_RANGE.");for(var n=t.length,a=0;e<=r&&a<n;)this._map[e]=t[a++],++e}},{key:"mapOne",value:function(e,r){this._map[e]=r}},{key:"lookup",value:function(e){return this._map[e]}},{key:"contains",value:function(e){return void 0!==this._map[e]}},{key:"forEach",value:function(e){var r=this._map,t=r.length;if(t<=65536)for(var n=0;n<t;n++)void 0!==r[n]&&e(n,r[n]);else for(var a in r)e(a,r[a])}},{key:"charCodeOf",value:function(e){var r=this._map;if(r.length<=65536)return r.indexOf(e);for(var t in r)if(r[t]===e)return 0|t;return-1}},{key:"getMap",value:function(){return this._map}},{key:"readCharCode",value:function(e,r,t){for(var n=0,a=this.codespaceRanges,i=0,o=a.length;i<o;i++){n=(n<<8|e.charCodeAt(r+i))>>>0;for(var u=a[i],c=0,s=u.length;c<s;){var p=u[c++],f=u[c++];if(p<=n&&n<=f)return t.charcode=n,void(t.length=i+1)}}t.charcode=0,t.length=1}},{key:"getCharCodeLength",value:function(e){for(var r=this.codespaceRanges,t=0,n=r.length;t<n;t++)for(var a=r[t],i=0,o=a.length;i<o;){var u=a[i++],c=a[i++];if(u<=e&&e<=c)return t+1}return 1}},{key:"length",get:function(){return this._map.length}},{key:"isIdentityCMap",get:function(){if("Identity-H"!==this.name&&"Identity-V"!==this.name)return!1;if(65536!==this._map.length)return!1;for(var e=0;e<65536;e++)if(this._map[e]!==e)return!1;return!0}}]),r}();exports.CMap=CMap;var IdentityCMap=function(e){_inherits(a,CMap);var n=_createSuper(a);function a(e,r){var t;return _classCallCheck(this,a),(t=n.call(this)).vertical=e,t.addCodespaceRange(r,0,65535),t}return _createClass(a,[{key:"mapCidRange",value:function(e,r,t){(0,_util.unreachable)("should not call mapCidRange")}},{key:"mapBfRange",value:function(e,r,t){(0,_util.unreachable)("should not call mapBfRange")}},{key:"mapBfRangeToArray",value:function(e,r,t){(0,_util.unreachable)("should not call mapBfRangeToArray")}},{key:"mapOne",value:function(e,r){(0,_util.unreachable)("should not call mapCidOne")}},{key:"lookup",value:function(e){return Number.isInteger(e)&&e<=65535?e:void 0}},{key:"contains",value:function(e){return Number.isInteger(e)&&e<=65535}},{key:"forEach",value:function(e){for(var r=0;r<=65535;r++)e(r,r)}},{key:"charCodeOf",value:function(e){return Number.isInteger(e)&&e<=65535?e:-1}},{key:"getMap",value:function(){for(var e=new Array(65536),r=0;r<=65535;r++)e[r]=r;return e}},{key:"length",get:function(){return 65536}},{key:"isIdentityCMap",get:function(){(0,_util.unreachable)("should not access .isIdentityCMap")}}]),a}();exports.IdentityCMap=IdentityCMap;var BinaryCMapReader=function(){function C(e,r){for(var t=0,n=0;n<=r;n++)t=t<<8|e[n];return t>>>0}function _(e,r){return 1===r?String.fromCharCode(e[0],e[1]):3===r?String.fromCharCode(e[0],e[1],e[2],e[3]):String.fromCharCode.apply(null,e.subarray(0,r+1))}function S(e,r,t){for(var n=0,a=t;0<=a;a--)n+=e[a]+r[a],e[a]=255&n,n>>=8}function U(e,r){for(var t=1,n=r;0<=n&&0<t;n--)t+=e[n],e[n]=255&t,t>>=8}var w=function(){function r(e){_classCallCheck(this,r),this.buffer=e,this.pos=0,this.end=e.length,this.tmpBuf=new Uint8Array(19)}return _createClass(r,[{key:"readByte",value:function(){return this.pos>=this.end?-1:this.buffer[this.pos++]}},{key:"readNumber",value:function(){var e,r=0;do{var t=this.readByte();if(t<0)throw new _util.FormatError("unexpected EOF in bcmap");e=!(128&t),r=r<<7|127&t}while(!e);return r}},{key:"readSigned",value:function(){var e=this.readNumber();return 1&e?~(e>>>1):e>>>1}},{key:"readHex",value:function(e,r){e.set(this.buffer.subarray(this.pos,this.pos+r+1)),this.pos+=r+1}},{key:"readHexNumber",value:function(e,r){var t,n=this.tmpBuf,a=0;do{var i=this.readByte();if(i<0)throw new _util.FormatError("unexpected EOF in bcmap");t=!(128&i),n[a++]=127&i}while(!t);for(var o=r,u=0,c=0;0<=o;){for(;c<8&&0<n.length;)u=n[--a]<<c|u,c+=7;e[o]=255&u,o--,u>>=8,c-=8}}},{key:"readHexSigned",value:function(e,r){this.readHexNumber(e,r);for(var t=1&e[r]?255:0,n=0,a=0;a<=r;a++)n=(1&n)<<8|e[a],e[a]=n>>1^t}},{key:"readString",value:function(){for(var e=this.readNumber(),r="",t=0;t<e;t++)r+=String.fromCharCode(this.readNumber());return r}}]),r}();return function(){function e(){_classCallCheck(this,e)}var n;return _createClass(e,[{key:"process",value:(n=_asyncToGenerator(_regeneratorRuntime().mark(function e(r,t,n){var a,i,o,u,c,s,p,f,l,d,h,m,v,b,y,g;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=new w(r),i=a.readByte(),t.vertical=!!(1&i),o=null,u=new Uint8Array(16),c=new Uint8Array(16),s=new Uint8Array(16),p=new Uint8Array(16),f=new Uint8Array(16);case 9:if(!(0<=(d=a.readByte()))){e.next=68;break}if(7!==(h=d>>5)){e.next=20;break}e.t0=31&d,e.next=0===e.t0?15:1===e.t0?17:19;break;case 15:return a.readString(),e.abrupt("break",19);case 17:return o=a.readString(),e.abrupt("break",19);case 19:return e.abrupt("continue",9);case 20:if(m=!!(16&d),16<(v=15&d)+1)throw new Error("BinaryCMapReader.process: Invalid dataSize.");e.next=24;break;case 24:b=1,y=a.readNumber(),e.t1=h,e.next=0===e.t1?29:1===e.t1?35:2===e.t1?41:3===e.t1?46:4===e.t1?53:5===e.t1?58:65;break;case 29:for(a.readHex(u,v),a.readHexNumber(c,v),S(c,u,v),t.addCodespaceRange(v+1,C(u,v),C(c,v)),g=1;g<y;g++)U(c,v),a.readHexNumber(u,v),S(u,c,v),a.readHexNumber(c,v),S(c,u,v),t.addCodespaceRange(v+1,C(u,v),C(c,v));return e.abrupt("break",66);case 35:for(a.readHex(u,v),a.readHexNumber(c,v),S(c,u,v),a.readNumber(),g=1;g<y;g++)U(c,v),a.readHexNumber(u,v),S(u,c,v),a.readHexNumber(c,v),S(c,u,v),a.readNumber();return e.abrupt("break",66);case 41:for(a.readHex(s,v),l=a.readNumber(),t.mapOne(C(s,v),l),g=1;g<y;g++)U(s,v),m||(a.readHexNumber(f,v),S(s,f,v)),l=a.readSigned()+(l+1),t.mapOne(C(s,v),l);return e.abrupt("break",66);case 46:for(a.readHex(u,v),a.readHexNumber(c,v),S(c,u,v),l=a.readNumber(),t.mapCidRange(C(u,v),C(c,v),l),g=1;g<y;g++)U(c,v),m?u.set(c):(a.readHexNumber(u,v),S(u,c,v)),a.readHexNumber(c,v),S(c,u,v),l=a.readNumber(),t.mapCidRange(C(u,v),C(c,v),l);return e.abrupt("break",66);case 53:for(a.readHex(s,b),a.readHex(p,v),t.mapOne(C(s,b),_(p,v)),g=1;g<y;g++)U(s,b),m||(a.readHexNumber(f,b),S(s,f,b)),U(p,v),a.readHexSigned(f,v),S(p,f,v),t.mapOne(C(s,b),_(p,v));return e.abrupt("break",66);case 58:for(a.readHex(u,b),a.readHexNumber(c,b),S(c,u,b),a.readHex(p,v),t.mapBfRange(C(u,b),C(c,b),_(p,v)),g=1;g<y;g++)U(c,b),m?u.set(c):(a.readHexNumber(u,b),S(u,c,b)),a.readHexNumber(c,b),S(c,u,b),a.readHex(p,v),t.mapBfRange(C(u,b),C(c,b),_(p,v));return e.abrupt("break",66);case 65:throw new Error("BinaryCMapReader.process - unknown type: ".concat(h));case 66:e.next=9;break;case 68:if(o)return e.abrupt("return",n(o));e.next=70;break;case 70:return e.abrupt("return",t);case 71:case"end":return e.stop()}},e)})),function(e,r,t){return n.apply(this,arguments)})}]),e}()}(),CMapFactory=function(){function u(e){for(var r=0,t=0;t<e.length;t++)r=r<<8|e.charCodeAt(t);return r>>>0}function c(e){if(!(0,_util.isString)(e))throw new _util.FormatError("Malformed CMap: expected string.")}function o(e){if(!Number.isInteger(e))throw new _util.FormatError("Malformed CMap: expected int.")}function l(e,r){for(;;){var t=r.getObj();if((0,_primitives.isEOF)(t))break;if((0,_primitives.isCmd)(t,"endbfchar"))return;c(t);var n=u(t);c(t=r.getObj());var a=t;e.mapOne(n,a)}}function d(e,r){for(;;){var t=r.getObj();if((0,_primitives.isEOF)(t))break;if((0,_primitives.isCmd)(t,"endbfrange"))return;c(t);var n=u(t);c(t=r.getObj());var a=u(t);if(t=r.getObj(),Number.isInteger(t)||(0,_util.isString)(t)){var i=Number.isInteger(t)?String.fromCharCode(t):t;e.mapBfRange(n,a,i)}else{if(!(0,_primitives.isCmd)(t,"["))break;t=r.getObj();for(var o=[];!(0,_primitives.isCmd)(t,"]")&&!(0,_primitives.isEOF)(t);)o.push(t),t=r.getObj();e.mapBfRangeToArray(n,a,o)}}throw new _util.FormatError("Invalid bf range.")}function h(e,r){for(;;){var t=r.getObj();if((0,_primitives.isEOF)(t))break;if((0,_primitives.isCmd)(t,"endcidchar"))return;c(t);var n=u(t);o(t=r.getObj());var a=t;e.mapOne(n,a)}}function m(e,r){for(;;){var t=r.getObj();if((0,_primitives.isEOF)(t))break;if((0,_primitives.isCmd)(t,"endcidrange"))return;c(t);var n=u(t);c(t=r.getObj());var a=u(t);o(t=r.getObj());var i=t;e.mapCidRange(n,a,i)}}function v(e,r){for(;;){var t=r.getObj();if((0,_primitives.isEOF)(t))break;if((0,_primitives.isCmd)(t,"endcodespacerange"))return;if(!(0,_util.isString)(t))break;var n=u(t);if(t=r.getObj(),!(0,_util.isString)(t))break;var a=u(t);e.addCodespaceRange(t.length,n,a)}throw new _util.FormatError("Invalid codespace range.")}function s(e,r,t,n){return a.apply(this,arguments)}function a(){return(a=_asyncToGenerator(_regeneratorRuntime().mark(function e(i,o,u,c){var s,p,f;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=1,f=o.getObj(),(0,_primitives.isEOF)(f))return e.abrupt("break",39);e.next=7;break;case 7:if(!(0,_primitives.isName)(f)){e.next=12;break}"WMode"===f.name?(n=i,void 0,a=o.getObj(),Number.isInteger(a)&&(n.vertical=!!a)):"CMapName"===f.name&&(r=i,void 0,t=o.getObj(),(0,_primitives.isName)(t)&&(0,_util.isString)(t.name)&&(r.name=t.name)),s=f,e.next=29;break;case 12:if(!(0,_primitives.isCmd)(f)){e.next=29;break}e.t0=f.cmd,e.next="endcmap"===e.t0?16:"usecmap"===e.t0?17:"begincodespacerange"===e.t0?19:"beginbfchar"===e.t0?21:"begincidchar"===e.t0?23:"beginbfrange"===e.t0?25:"begincidrange"===e.t0?27:29;break;case 16:return e.abrupt("break",39);case 17:return(0,_primitives.isName)(s)&&(p=s.name),e.abrupt("break",29);case 19:return v(i,o),e.abrupt("break",29);case 21:return l(i,o),e.abrupt("break",29);case 23:return h(i,o),e.abrupt("break",29);case 25:return d(i,o),e.abrupt("break",29);case 27:return m(i,o),e.abrupt("break",29);case 29:e.next=37;break;case 31:if(e.prev=31,e.t1=e.catch(1),e.t1 instanceof _core_utils.MissingDataException)throw e.t1;e.next=35;break;case 35:return(0,_util.warn)("Invalid cMap data: "+e.t1),e.abrupt("continue",0);case 37:e.next=0;break;case 39:if(!c&&p&&(c=p),c)return e.abrupt("return",b(i,u,c));e.next=42;break;case 42:return e.abrupt("return",i);case 43:case"end":return e.stop()}var r,t,n,a},e,null,[[1,31]])}))).apply(this,arguments)}function b(e,r,t){return n.apply(this,arguments)}function n(){return(n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,r,n){var a,i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(n,r);case 2:if(t.useCMap=e.sent,0===t.numCodespaceRanges){for(a=t.useCMap.codespaceRanges,i=0;i<a.length;i++)t.codespaceRanges[i]=a[i].slice();t.numCodespaceRanges=t.useCMap.numCodespaceRanges}return t.useCMap.forEach(function(e,r){t.contains(e)||t.mapOne(e,t.useCMap.lookup(e))}),e.abrupt("return",t);case 6:case"end":return e.stop()}},e)}))).apply(this,arguments)}function p(e,r){return t.apply(this,arguments)}function t(){return(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(r,t){var n,a,i,o,u;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("Identity-H"===r)return e.abrupt("return",new IdentityCMap(!1,2));e.next=4;break;case 4:if("Identity-V"===r)return e.abrupt("return",new IdentityCMap(!0,2));e.next=6;break;case 6:if(BUILT_IN_CMAPS.includes(r)){e.next=8;break}throw new Error("Unknown CMap name: "+r);case 8:if(t){e.next=10;break}throw new Error("Built-in CMap parameters are not provided.");case 10:return e.next=12,t(r);case 12:if(n=e.sent,a=n.cMapData,i=n.compressionType,o=new CMap(!0),i===_util.CMapCompressionType.BINARY)return e.abrupt("return",(new BinaryCMapReader).process(a,o,function(e){return b(o,t,e)}));e.next=18;break;case 18:if(i===_util.CMapCompressionType.NONE)return u=new _parser.Lexer(new _stream.Stream(a)),e.abrupt("return",s(o,u,t,null));e.next=21;break;case 21:throw new Error("TODO: Only BINARY/NONE CMap compression is currently supported.");case 22:case"end":return e.stop()}},e)}))).apply(this,arguments)}return{create:function(i){return _asyncToGenerator(_regeneratorRuntime().mark(function e(){var r,t,n,a;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.encoding,t=i.fetchBuiltInCMap,n=i.useCMap,(0,_primitives.isName)(r))return e.abrupt("return",p(r.name,t));e.next=7;break;case 7:if((0,_primitives.isStream)(r))return e.next=10,s(new CMap,new _parser.Lexer(r),t,n);e.next=14;break;case 10:if((a=e.sent).isIdentityCMap)return e.abrupt("return",p(a.name,t));e.next=13;break;case 13:return e.abrupt("return",a);case 14:throw new Error("Encoding required.");case 15:case"end":return e.stop()}},e)}))()}}}();exports.CMapFactory=CMapFactory;