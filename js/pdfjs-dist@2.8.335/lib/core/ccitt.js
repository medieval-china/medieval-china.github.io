"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CCITTFaxDecoder=void 0;var _util=require("../shared/util.js"),CCITTFaxDecoder=function(){var a=-1,o=[[-1,-1],[-1,-1],[7,8],[7,7],[6,6],[6,6],[6,5],[6,5],[4,0],[4,0],[4,0],[4,0],[4,0],[4,0],[4,0],[4,0],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[3,3],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]],e=[[-1,-1],[12,-2],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[11,1792],[11,1792],[12,1984],[12,2048],[12,2112],[12,2176],[12,2240],[12,2304],[11,1856],[11,1856],[11,1920],[11,1920],[12,2368],[12,2432],[12,2496],[12,2560]],h=[[-1,-1],[-1,-1],[-1,-1],[-1,-1],[8,29],[8,29],[8,30],[8,30],[8,45],[8,45],[8,46],[8,46],[7,22],[7,22],[7,22],[7,22],[7,23],[7,23],[7,23],[7,23],[8,47],[8,47],[8,48],[8,48],[6,13],[6,13],[6,13],[6,13],[6,13],[6,13],[6,13],[6,13],[7,20],[7,20],[7,20],[7,20],[8,33],[8,33],[8,34],[8,34],[8,35],[8,35],[8,36],[8,36],[8,37],[8,37],[8,38],[8,38],[7,19],[7,19],[7,19],[7,19],[8,31],[8,31],[8,32],[8,32],[6,1],[6,1],[6,1],[6,1],[6,1],[6,1],[6,1],[6,1],[6,12],[6,12],[6,12],[6,12],[6,12],[6,12],[6,12],[6,12],[8,53],[8,53],[8,54],[8,54],[7,26],[7,26],[7,26],[7,26],[8,39],[8,39],[8,40],[8,40],[8,41],[8,41],[8,42],[8,42],[8,43],[8,43],[8,44],[8,44],[7,21],[7,21],[7,21],[7,21],[7,28],[7,28],[7,28],[7,28],[8,61],[8,61],[8,62],[8,62],[8,63],[8,63],[8,0],[8,0],[8,320],[8,320],[8,384],[8,384],[5,10],[5,10],[5,10],[5,10],[5,10],[5,10],[5,10],[5,10],[5,10],[5,10],[5,10],[5,10],[5,10],[5,10],[5,10],[5,10],[5,11],[5,11],[5,11],[5,11],[5,11],[5,11],[5,11],[5,11],[5,11],[5,11],[5,11],[5,11],[5,11],[5,11],[5,11],[5,11],[7,27],[7,27],[7,27],[7,27],[8,59],[8,59],[8,60],[8,60],[9,1472],[9,1536],[9,1600],[9,1728],[7,18],[7,18],[7,18],[7,18],[7,24],[7,24],[7,24],[7,24],[8,49],[8,49],[8,50],[8,50],[8,51],[8,51],[8,52],[8,52],[7,25],[7,25],[7,25],[7,25],[8,55],[8,55],[8,56],[8,56],[8,57],[8,57],[8,58],[8,58],[6,192],[6,192],[6,192],[6,192],[6,192],[6,192],[6,192],[6,192],[6,1664],[6,1664],[6,1664],[6,1664],[6,1664],[6,1664],[6,1664],[6,1664],[8,448],[8,448],[8,512],[8,512],[9,704],[9,768],[8,640],[8,640],[8,576],[8,576],[9,832],[9,896],[9,960],[9,1024],[9,1088],[9,1152],[9,1216],[9,1280],[9,1344],[9,1408],[7,256],[7,256],[7,256],[7,256],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,2],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[5,128],[5,128],[5,128],[5,128],[5,128],[5,128],[5,128],[5,128],[5,128],[5,128],[5,128],[5,128],[5,128],[5,128],[5,128],[5,128],[5,8],[5,8],[5,8],[5,8],[5,8],[5,8],[5,8],[5,8],[5,8],[5,8],[5,8],[5,8],[5,8],[5,8],[5,8],[5,8],[5,9],[5,9],[5,9],[5,9],[5,9],[5,9],[5,9],[5,9],[5,9],[5,9],[5,9],[5,9],[5,9],[5,9],[5,9],[5,9],[6,16],[6,16],[6,16],[6,16],[6,16],[6,16],[6,16],[6,16],[6,17],[6,17],[6,17],[6,17],[6,17],[6,17],[6,17],[6,17],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,4],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[4,5],[6,14],[6,14],[6,14],[6,14],[6,14],[6,14],[6,14],[6,14],[6,15],[6,15],[6,15],[6,15],[6,15],[6,15],[6,15],[6,15],[5,64],[5,64],[5,64],[5,64],[5,64],[5,64],[5,64],[5,64],[5,64],[5,64],[5,64],[5,64],[5,64],[5,64],[5,64],[5,64],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,6],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7],[4,7]],n=[[-1,-1],[-1,-1],[12,-2],[12,-2],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[-1,-1],[11,1792],[11,1792],[11,1792],[11,1792],[12,1984],[12,1984],[12,2048],[12,2048],[12,2112],[12,2112],[12,2176],[12,2176],[12,2240],[12,2240],[12,2304],[12,2304],[11,1856],[11,1856],[11,1856],[11,1856],[11,1920],[11,1920],[11,1920],[11,1920],[12,2368],[12,2368],[12,2432],[12,2432],[12,2496],[12,2496],[12,2560],[12,2560],[10,18],[10,18],[10,18],[10,18],[10,18],[10,18],[10,18],[10,18],[12,52],[12,52],[13,640],[13,704],[13,768],[13,832],[12,55],[12,55],[12,56],[12,56],[13,1280],[13,1344],[13,1408],[13,1472],[12,59],[12,59],[12,60],[12,60],[13,1536],[13,1600],[11,24],[11,24],[11,24],[11,24],[11,25],[11,25],[11,25],[11,25],[13,1664],[13,1728],[12,320],[12,320],[12,384],[12,384],[12,448],[12,448],[13,512],[13,576],[12,53],[12,53],[12,54],[12,54],[13,896],[13,960],[13,1024],[13,1088],[13,1152],[13,1216],[10,64],[10,64],[10,64],[10,64],[10,64],[10,64],[10,64],[10,64]],r=[[8,13],[8,13],[8,13],[8,13],[8,13],[8,13],[8,13],[8,13],[8,13],[8,13],[8,13],[8,13],[8,13],[8,13],[8,13],[8,13],[11,23],[11,23],[12,50],[12,51],[12,44],[12,45],[12,46],[12,47],[12,57],[12,58],[12,61],[12,256],[10,16],[10,16],[10,16],[10,16],[10,17],[10,17],[10,17],[10,17],[12,48],[12,49],[12,62],[12,63],[12,30],[12,31],[12,32],[12,33],[12,40],[12,41],[11,22],[11,22],[8,14],[8,14],[8,14],[8,14],[8,14],[8,14],[8,14],[8,14],[8,14],[8,14],[8,14],[8,14],[8,14],[8,14],[8,14],[8,14],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,10],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[7,11],[9,15],[9,15],[9,15],[9,15],[9,15],[9,15],[9,15],[9,15],[12,128],[12,192],[12,26],[12,27],[12,28],[12,29],[11,19],[11,19],[11,20],[11,20],[12,34],[12,35],[12,36],[12,37],[12,38],[12,39],[11,21],[11,21],[12,42],[12,43],[10,0],[10,0],[10,0],[10,0],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12],[7,12]],d=[[-1,-1],[-1,-1],[-1,-1],[-1,-1],[6,9],[6,8],[5,7],[5,7],[4,6],[4,6],[4,6],[4,6],[4,5],[4,5],[4,5],[4,5],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,1],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[3,4],[2,3],[2,3],[2,3],[2,3],[2,3],[2,3],[2,3],[2,3],[2,3],[2,3],[2,3],[2,3],[2,3],[2,3],[2,3],[2,3],[2,2],[2,2],[2,2],[2,2],[2,2],[2,2],[2,2],[2,2],[2,2],[2,2],[2,2],[2,2],[2,2],[2,2],[2,2],[2,2]];function i(i){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!i||"function"!=typeof i.next)throw new Error('CCITTFaxDecoder - invalid "source" parameter.');this.source=i,this.eof=!1,this.encoding=t.K||0,this.eoline=t.EndOfLine||!1,this.byteAlign=t.EncodedByteAlign||!1,this.columns=t.Columns||1728,this.rows=t.Rows||0;var s,o=t.EndOfBlock;for(null==o&&(o=!0),this.eoblock=o,this.black=t.BlackIs1||!1,this.codingLine=new Uint32Array(this.columns+1),this.refLine=new Uint32Array(this.columns+2),this.codingLine[0]=this.columns,this.codingPos=0,this.row=0,this.nextLine2D=this.encoding<0,this.inputBits=0,this.inputBuf=0,this.outputBits=0,this.rowsDone=!1;0===(s=this._lookBits(12));)this._eatBits(1);1===s&&this._eatBits(12),0<this.encoding&&(this.nextLine2D=!this._lookBits(1),this._eatBits(1))}return i.prototype={readNextChar:function(){if(this.eof)return-1;var i,t,s,o,e,h=this.refLine,n=this.codingLine,r=this.columns;if(0===this.outputBits){if(this.rowsDone&&(this.eof=!0),this.eof)return-1;var d,c,f;if(this.err=!1,this.nextLine2D){for(o=0;n[o]<r;++o)h[o]=n[o];for(h[o++]=r,h[o]=r,n[0]=0,t=i=this.codingPos=0;n[this.codingPos]<r;)switch(d=this._getTwoDimCode()){case 0:this._addPixels(h[i+1],t),h[i+1]<r&&(i+=2);break;case 1:if(d=c=0,t){for(;d+=f=this._getBlackCode(),64<=f;);for(;c+=f=this._getWhiteCode(),64<=f;);}else{for(;d+=f=this._getWhiteCode(),64<=f;);for(;c+=f=this._getBlackCode(),64<=f;);}for(this._addPixels(n[this.codingPos]+d,t),n[this.codingPos]<r&&this._addPixels(n[this.codingPos]+c,1^t);h[i]<=n[this.codingPos]&&h[i]<r;)i+=2;break;case 7:if(this._addPixels(h[i]+3,t),t^=1,n[this.codingPos]<r)for(++i;h[i]<=n[this.codingPos]&&h[i]<r;)i+=2;break;case 5:if(this._addPixels(h[i]+2,t),t^=1,n[this.codingPos]<r)for(++i;h[i]<=n[this.codingPos]&&h[i]<r;)i+=2;break;case 3:if(this._addPixels(h[i]+1,t),t^=1,n[this.codingPos]<r)for(++i;h[i]<=n[this.codingPos]&&h[i]<r;)i+=2;break;case 2:if(this._addPixels(h[i],t),t^=1,n[this.codingPos]<r)for(++i;h[i]<=n[this.codingPos]&&h[i]<r;)i+=2;break;case 8:if(this._addPixelsNeg(h[i]-3,t),t^=1,n[this.codingPos]<r)for(0<i?--i:++i;h[i]<=n[this.codingPos]&&h[i]<r;)i+=2;break;case 6:if(this._addPixelsNeg(h[i]-2,t),t^=1,n[this.codingPos]<r)for(0<i?--i:++i;h[i]<=n[this.codingPos]&&h[i]<r;)i+=2;break;case 4:if(this._addPixelsNeg(h[i]-1,t),t^=1,n[this.codingPos]<r)for(0<i?--i:++i;h[i]<=n[this.codingPos]&&h[i]<r;)i+=2;break;case a:this._addPixels(r,0),this.eof=!0;break;default:(0,_util.info)("bad 2d code"),this._addPixels(r,0),this.err=!0}}else for(n[0]=0,t=this.codingPos=0;n[this.codingPos]<r;){if(d=0,t)for(;d+=f=this._getBlackCode(),64<=f;);else for(;d+=f=this._getWhiteCode(),64<=f;);this._addPixels(n[this.codingPos]+d,t),t^=1}var u=!1;if(this.byteAlign&&(this.inputBits&=-8),this.eoblock||this.row!==this.rows-1){if(d=this._lookBits(12),this.eoline)for(;d!==a&&1!==d;)this._eatBits(1),d=this._lookBits(12);else for(;0===d;)this._eatBits(1),d=this._lookBits(12);1===d?(this._eatBits(12),u=!0):d===a&&(this.eof=!0)}else this.rowsDone=!0;if(!this.eof&&0<this.encoding&&!this.rowsDone&&(this.nextLine2D=!this._lookBits(1),this._eatBits(1)),this.eoblock&&u&&this.byteAlign){if(1===(d=this._lookBits(12))){if(this._eatBits(12),0<this.encoding&&(this._lookBits(1),this._eatBits(1)),0<=this.encoding)for(o=0;o<4;++o)1!==(d=this._lookBits(12))&&(0,_util.info)("bad rtc code: "+d),this._eatBits(12),0<this.encoding&&(this._lookBits(1),this._eatBits(1));this.eof=!0}}else if(this.err&&this.eoline){for(;;){if((d=this._lookBits(13))===a)return this.eof=!0,-1;if(d>>1==1)break;this._eatBits(1)}this._eatBits(12),0<this.encoding&&(this._eatBits(1),this.nextLine2D=!(1&d))}0<n[0]?this.outputBits=n[this.codingPos=0]:this.outputBits=n[this.codingPos=1],this.row++}if(8<=this.outputBits)e=1&this.codingPos?0:255,this.outputBits-=8,0===this.outputBits&&n[this.codingPos]<r&&(this.codingPos++,this.outputBits=n[this.codingPos]-n[this.codingPos-1]);else for(s=8,e=0;this.outputBits>s?(e<<=s,1&this.codingPos||(e|=255>>8-s),this.outputBits-=s,s=0):(e<<=this.outputBits,1&this.codingPos||(e|=255>>8-this.outputBits),s-=this.outputBits,this.outputBits=0,n[this.codingPos]<r?(this.codingPos++,this.outputBits=n[this.codingPos]-n[this.codingPos-1]):0<s&&(e<<=s,s=0)),s;);return this.black&&(e^=255),e},_addPixels:function(i,t){var s=this.codingLine,o=this.codingPos;i>s[o]&&(i>this.columns&&((0,_util.info)("row is wrong length"),this.err=!0,i=this.columns),1&o^t&&++o,s[o]=i),this.codingPos=o},_addPixelsNeg:function(i,t){var s=this.codingLine,o=this.codingPos;if(i>s[o])i>this.columns&&((0,_util.info)("row is wrong length"),this.err=!0,i=this.columns),1&o^t&&++o,s[o]=i;else if(i<s[o]){for(i<0&&((0,_util.info)("invalid code"),this.err=!0,i=0);0<o&&i<s[o-1];)--o;s[o]=i}this.codingPos=o},_findTableCode:function(i,t,s,o){for(var e=o||0,h=i;h<=t;++h){var n=this._lookBits(h);if(n===a)return[!0,1,!1];if(h<t&&(n<<=t-h),!e||e<=n){var r=s[n-e];if(r[0]===h)return this._eatBits(h),[!0,r[1],!0]}}return[!1,0,!1]},_getTwoDimCode:function(){var i,t=0;if(this.eoblock){if(t=this._lookBits(7),(i=o[t])&&0<i[0])return this._eatBits(i[0]),i[1]}else{var s=this._findTableCode(1,7,o);if(s[0]&&s[2])return s[1]}return(0,_util.info)("Bad two dim code"),a},_getWhiteCode:function(){var i,t=0;if(this.eoblock){if((t=this._lookBits(12))===a)return 1;if(0<(i=t>>5==0?e[t]:h[t>>3])[0])return this._eatBits(i[0]),i[1]}else{var s=this._findTableCode(1,9,h);if(s[0])return s[1];if((s=this._findTableCode(11,12,e))[0])return s[1]}return(0,_util.info)("bad white code"),this._eatBits(1),1},_getBlackCode:function(){var i,t;if(this.eoblock){if((i=this._lookBits(13))===a)return 1;if(0<(t=i>>7==0?n[i]:i>>9==0&&i>>7!=0?r[(i>>1)-64]:d[i>>7])[0])return this._eatBits(t[0]),t[1]}else{var s=this._findTableCode(2,6,d);if(s[0])return s[1];if((s=this._findTableCode(7,12,r,64))[0])return s[1];if((s=this._findTableCode(10,13,n))[0])return s[1]}return(0,_util.info)("bad black code"),this._eatBits(1),1},_lookBits:function(i){for(var t;this.inputBits<i;){if(-1===(t=this.source.next()))return 0===this.inputBits?a:this.inputBuf<<i-this.inputBits&65535>>16-i;this.inputBuf=this.inputBuf<<8|t,this.inputBits+=8}return this.inputBuf>>this.inputBits-i&65535>>16-i},_eatBits:function(i){(this.inputBits-=i)<0&&(this.inputBits=0)}},i}();exports.CCITTFaxDecoder=CCITTFaxDecoder;