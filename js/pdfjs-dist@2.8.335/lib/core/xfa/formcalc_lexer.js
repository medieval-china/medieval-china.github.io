"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,s,o,a=[],l=!0,u=!1;try{if(s=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=s.call(r)).done)&&(a.push(n.value),a.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);var n=r.call(e,t||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.TOKEN=exports.Token=exports.Lexer=void 0;var KEYWORDS=new Set(["and","break","continue","do","downto","else","elseif","end","endfor","endfunc","endif","endwhile","eq","exit","for","foreach","func","ge","gt","if","in","infinity","le","lt","nan","ne","not","null","or","return","step","then","this","throw","upto","var","while"]),TOKEN={and:0,divide:1,dot:2,dotDot:3,dotHash:4,dotStar:5,eq:6,ge:7,gt:8,le:9,leftBracket:10,leftParen:11,lt:12,minus:13,ne:14,not:15,null:16,number:17,or:18,plus:19,rightBracket:20,rightParen:21,string:22,this:23,times:24,identifier:25,break:26,continue:27,do:28,for:29,foreach:30,func:31,if:32,var:33,while:34,assign:35,comma:36,downto:37,else:38,elseif:39,end:40,endif:41,endfor:42,endfunc:43,endwhile:44,eof:45,exit:46,in:47,infinity:48,nan:49,return:50,step:51,then:52,throw:53,upto:54};exports.TOKEN=TOKEN;var hexPattern=/^[uU]([0-9a-fA-F]{4,8})/,numberPattern=/^[0-9]*(?:\.[0-9]*)?(?:[Ee][+-]?[0-9]+)?/,dotNumberPattern=/^[0-9]*(?:[Ee][+-]?[0-9]+)?/,eolPattern=/[\r\n]+/,identifierPattern=new RegExp("^[\\p{L}_$!][\\p{L}\\p{N}_$]*","u"),Token=_createClass(function e(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,e),this.id=t,this.value=r});exports.Token=Token;var Singletons=function(){for(var e=Object.create(null),t=new Set(["identifier","string","number","nan","infinity"]),r=0,n=Object.entries(TOKEN);r<n.length;r++){var i=_slicedToArray(n[r],2),s=i[0],o=i[1];t.has(s)||(e[s]=new Token(o))}return e.nan=new Token(TOKEN.number,NaN),e.infinity=new Token(TOKEN.number,1/0),e}(),Lexer=function(){function t(e){_classCallCheck(this,t),this.data=e,this.pos=0,this.len=e.length,this.strBuf=[]}return _createClass(t,[{key:"skipUntilEOL",value:function(){var e=this.data.slice(this.pos).match(eolPattern);e?this.pos+=e.index+e[0].length:this.pos=this.len}},{key:"getIdentifier",value:function(){this.pos--;var e=this.data.slice(this.pos).match(identifierPattern);if(!e)throw new Error("Invalid token in FormCalc expression at position ".concat(this.pos,"."));var t=this.data.slice(this.pos,this.pos+e[0].length);this.pos+=e[0].length;var r=t.toLowerCase();return KEYWORDS.has(r)?Singletons[r]:new Token(TOKEN.identifier,t)}},{key:"getString",value:function(){for(var e=this.strBuf,t=this.data,r=this.pos;this.pos<this.len;){var n=t.charCodeAt(this.pos++);if(34!==n){if(92===n){var i=t.substring(this.pos,this.pos+10).match(hexPattern);if(!i)continue;e.push(t.slice(r,this.pos-1));var s=i[1];r=4===s.length?(e.push(String.fromCharCode(parseInt(s,16))),this.pos+=5):8!==s.length?(e.push(String.fromCharCode(parseInt(s.slice(0,4),16))),this.pos+=5):(e.push(String.fromCharCode(parseInt(s,16))),this.pos+=9)}}else{if(34!==t.charCodeAt(this.pos))break;e.push(t.slice(r,this.pos++)),r=this.pos}}var o=t.slice(r,this.pos-1);if(0===e.length)return new Token(TOKEN.string,o);e.push(o);var a=e.join("");return e.length=0,new Token(TOKEN.string,a)}},{key:"getNumber",value:function(e){var t=this.data.substring(this.pos).match(numberPattern);if(!t)return e-48;var r=parseFloat(this.data.substring(this.pos-1,this.pos+t[0].length));return this.pos+=t[0].length,new Token(TOKEN.number,r)}},{key:"getCompOperator",value:function(e,t){return 61===this.data.charCodeAt(this.pos)?(this.pos++,e):t}},{key:"getLower",value:function(){var e=this.data.charCodeAt(this.pos);return 61===e?(this.pos++,Singletons.le):62===e?(this.pos++,Singletons.ne):Singletons.lt}},{key:"getSlash",value:function(){return 47!==this.data.charCodeAt(this.pos)||(this.skipUntilEOL(),!1)}},{key:"getDot",value:function(){var e=this.data.charCodeAt(this.pos);if(46===e)return this.pos++,Singletons.dotDot;if(42===e)return this.pos++,Singletons.dotStar;if(35===e)return this.pos++,Singletons.dotHash;if(48<=e&&e<=57){this.pos++;var t=this.data.substring(this.pos).match(dotNumberPattern);if(!t)return new Token(TOKEN.number,(e-48)/10);var r=this.pos+t[0].length,n=parseFloat(this.data.substring(this.pos-2,r));return this.pos=r,new Token(TOKEN.number,n)}return Singletons.dot}},{key:"next",value:function(){for(;this.pos<this.len;){var e=this.data.charCodeAt(this.pos++);switch(e){case 9:case 10:case 11:case 12:case 13:case 32:break;case 34:return this.getString();case 38:return Singletons.and;case 40:return Singletons.leftParen;case 41:return Singletons.rightParen;case 42:return Singletons.times;case 43:return Singletons.plus;case 44:return Singletons.comma;case 45:return Singletons.minus;case 46:return this.getDot();case 47:if(this.getSlash())return Singletons.divide;break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.getNumber(e);case 59:this.skipUntilEOL();break;case 60:return this.getLower();case 61:return this.getCompOperator(Singletons.eq,Singletons.assign);case 62:return this.getCompOperator(Singletons.ge,Singletons.gt);case 91:return Singletons.leftBracket;case 93:return Singletons.rightBracket;case 124:return Singletons.or;default:return this.getIdentifier()}}return Singletons.eof}}]),t}();exports.Lexer=Lexer;