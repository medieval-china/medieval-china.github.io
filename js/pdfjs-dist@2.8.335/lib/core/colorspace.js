"use strict";function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(n){var o=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(n);if(o){var r=_getPrototypeOf(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _possibleConstructorReturn(t,e){if(e&&("object"===_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return i};var i={},t=Object.prototype,s=t.hasOwnProperty,f=Object.defineProperty||function(t,e,r){t[e]=r.value},e="function"==typeof Symbol?Symbol:{},o=e.iterator||"@@iterator",r=e.asyncIterator||"@@asyncIterator",n=e.toStringTag||"@@toStringTag";function a(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{a({},"")}catch(t){a=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var a,i,c,u,o=e&&e.prototype instanceof v?e:v,l=Object.create(o.prototype),s=new S(n||[]);return f(l,"_invoke",{value:(a=t,i=r,c=s,u="suspendedStart",function(t,e){if("executing"===u)throw new Error("Generator is already running");if("completed"===u){if("throw"===t)throw e;return B()}for(c.method=t,c.arg=e;;){var r=c.delegate;if(r){var n=w(r,c);if(n){if(n===p)continue;return n}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if("suspendedStart"===u)throw u="completed",c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);u="executing";var o=h(a,i,c);if("normal"===o.type){if(u=c.done?"completed":"suspendedYield",o.arg===p)continue;return{value:o.arg,done:c.done}}"throw"===o.type&&(u="completed",c.method="throw",c.arg=o.arg)}})}),l}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}i.wrap=c;var p={};function v(){}function u(){}function l(){}var y={};a(y,o,function(){return this});var g=Object.getPrototypeOf,m=g&&g(g(R([])));m&&m!==t&&s.call(m,o)&&(y=m);var d=l.prototype=v.prototype=Object.create(y);function b(t){["next","throw","return"].forEach(function(e){a(t,e,function(t){return this._invoke(e,t)})})}function _(u,l){var e;f(this,"_invoke",{value:function(r,n){function t(){return new l(function(t,e){!function e(t,r,n,o){var a=h(u[t],u,r);if("throw"!==a.type){var i=a.arg,c=i.value;return c&&"object"==_typeof(c)&&s.call(c,"__await")?l.resolve(c.__await).then(function(t){e("next",t,n,o)},function(t){e("throw",t,n,o)}):l.resolve(c).then(function(t){i.value=t,n(i)},function(t){return e("throw",t,n,o)})}o(a.arg)}(r,n,t,e)})}return e=e?e.then(t,t):t()}})}function w(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var o=h(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,p;var a=o.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function R(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(s.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:B}}function B(){return{value:void 0,done:!0}}return f(d,"constructor",{value:u.prototype=l,configurable:!0}),f(l,"constructor",{value:u,configurable:!0}),u.displayName=a(l,n,"GeneratorFunction"),i.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===u||"GeneratorFunction"===(e.displayName||e.name))},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,a(t,n,"GeneratorFunction")),t.prototype=Object.create(d),t},i.awrap=function(t){return{__await:t}},b(_.prototype),a(_.prototype,r,function(){return this}),i.AsyncIterator=_,i.async=function(t,e,r,n,o){void 0===o&&(o=Promise);var a=new _(c(t,e,r,n),o);return i.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},b(d),a(d,n,"Generator"),a(d,o,function(){return this}),a(d,"toString",function(){return"[object Generator]"}),i.keys=function(t){var r=Object(t),n=[];for(var e in r)n.push(e);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in r)return t.value=e,t.done=!1,t}return t.done=!0,t}},i.values=R,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&s.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function t(t,e){return a.type="throw",a.arg=r,n.next=t,e&&(n.method="next",n.arg=void 0),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],a=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var i=s.call(o,"catchLoc"),c=s.call(o,"finallyLoc");if(i&&c){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),k(r),p}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;k(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:R(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},i}function asyncGeneratorStep(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function _asyncToGenerator(c){return function(){var t=this,i=arguments;return new Promise(function(e,r){var n=c.apply(t,i);function o(t){asyncGeneratorStep(n,e,r,o,a,"next",t)}function a(t){asyncGeneratorStep(n,e,r,o,a,"throw",t)}o(void 0)})}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);var n=r.call(t,e||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ColorSpace=void 0;var _util=require("../shared/util.js"),_primitives=require("./primitives.js"),_core_utils=require("./core_utils.js");function resizeRgbImage(t,e,r,n,o,a,i){i=1!==i?0:i;for(var c,u=r/o,l=n/a,s=0,f=new Uint16Array(o),h=3*r,p=0;p<o;p++)f[p]=3*Math.floor(p*u);for(var v=0;v<a;v++)for(var y=Math.floor(v*l)*h,g=0;g<o;g++)c=y+f[g],e[s++]=t[c++],e[s++]=t[c++],e[s++]=t[c++],s+=i}var ColorSpace=function(){function r(t,e){_classCallCheck(this,r),this.constructor===r&&(0,_util.unreachable)("Cannot initialize ColorSpace."),this.name=t,this.numComps=e}var e;return _createClass(r,[{key:"getRgb",value:function(t,e){var r=new Uint8ClampedArray(3);return this.getRgbItem(t,e,r,0),r}},{key:"getRgbItem",value:function(t,e,r,n){(0,_util.unreachable)("Should not call ColorSpace.getRgbItem")}},{key:"getRgbBuffer",value:function(t,e,r,n,o,a,i){(0,_util.unreachable)("Should not call ColorSpace.getRgbBuffer")}},{key:"getOutputLength",value:function(t,e){(0,_util.unreachable)("Should not call ColorSpace.getOutputLength")}},{key:"isPassthrough",value:function(t){return!1}},{key:"isDefaultDecode",value:function(t,e){return r.isDefaultDecode(t,this.numComps)}},{key:"fillRgb",value:function(t,e,r,n,o,a,i,c,u){var l=e*r,s=null,f=1<<i,h=r!==o||e!==n;if(this.isPassthrough(i))s=c;else if(1===this.numComps&&f<l&&"DeviceGray"!==this.name&&"DeviceRGB"!==this.name){for(var p=i<=8?new Uint8Array(f):new Uint16Array(f),v=0;v<f;v++)p[v]=v;var y=new Uint8ClampedArray(3*f);if(this.getRgbBuffer(p,0,f,y,0,i,0),h){s=new Uint8Array(3*l);for(var g=0,m=0;m<l;++m){var d=3*c[m];s[g++]=y[d],s[g++]=y[d+1],s[g++]=y[d+2]}}else for(var b=0,_=0;_<l;++_){var w=3*c[_];t[b++]=y[w],t[b++]=y[w+1],t[b++]=y[w+2],b+=u}}else h?(s=new Uint8ClampedArray(3*l),this.getRgbBuffer(c,0,l,s,0,i,0)):this.getRgbBuffer(c,0,n*a,t,0,i,u);if(s)if(h)resizeRgbImage(s,t,e,r,n,o,u);else for(var C=0,k=0,S=0,R=n*a;S<R;S++)t[C++]=s[k++],t[C++]=s[k++],t[C++]=s[k++],C+=u}},{key:"usesZeroToOneRange",get:function(){return(0,_util.shadow)(this,"usesZeroToOneRange",!0)}}],[{key:"_cache",value:function(t,e,r,n){if(!r)throw new Error('ColorSpace._cache - expected "localColorSpaceCache" argument.');if(!n)throw new Error('ColorSpace._cache - expected "parsedColorSpace" argument.');var o,a;t instanceof _primitives.Ref&&(a=t,t=e.fetch(t)),t instanceof _primitives.Name&&(o=t.name),(o||a)&&r.set(o,a,n)}},{key:"getCached",value:function(t,e,r){if(!r)throw new Error('ColorSpace.getCached - expected "localColorSpaceCache" argument.');if(t instanceof _primitives.Ref){var n=r.getByRef(t);if(n)return n;try{t=e.fetch(t)}catch(t){if(t instanceof _core_utils.MissingDataException)throw t}}if(t instanceof _primitives.Name){var o=r.getByName(t.name);if(o)return o}return null}},{key:"parseAsync",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function t(e){var r,n,o,a,i,c,u;return _regeneratorRuntime().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.cs,n=e.xref,o=e.resources,a=void 0===o?null:o,i=e.pdfFunctionFactory,c=e.localColorSpaceCache,u=this._parse(r,n,a,i),this._cache(r,n,c,u),t.abrupt("return",u);case 4:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"parse",value:function(t){var e=t.cs,r=t.xref,n=t.resources,o=void 0===n?null:n,a=t.pdfFunctionFactory,i=t.localColorSpaceCache,c=this.getCached(e,r,i);if(c)return c;var u=this._parse(e,r,o,a);return this._cache(e,r,i,u),u}},{key:"_parse",value:function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=3<arguments.length?arguments[3]:void 0;if(t=e.fetchIfRef(t),(0,_primitives.isName)(t))switch(t.name){case"DeviceGray":case"G":return this.singletons.gray;case"DeviceRGB":case"RGB":return this.singletons.rgb;case"DeviceCMYK":case"CMYK":return this.singletons.cmyk;case"Pattern":return new PatternCS(null);default:if((0,_primitives.isDict)(r)){var o=r.get("ColorSpace");if((0,_primitives.isDict)(o)){var a=o.get(t.name);if(a){if((0,_primitives.isName)(a))return this._parse(a,e,r,n);t=a;break}}}throw new _util.FormatError("Unrecognized ColorSpace: ".concat(t.name))}if(Array.isArray(t)){var i,c,u,l,s,f,h=e.fetchIfRef(t[0]).name;switch(h){case"DeviceGray":case"G":return this.singletons.gray;case"DeviceRGB":case"RGB":return this.singletons.rgb;case"DeviceCMYK":case"CMYK":return this.singletons.cmyk;case"CalGray":return l=(i=e.fetchIfRef(t[1])).getArray("WhitePoint"),s=i.getArray("BlackPoint"),f=i.get("Gamma"),new CalGrayCS(l,s,f);case"CalRGB":l=(i=e.fetchIfRef(t[1])).getArray("WhitePoint"),s=i.getArray("BlackPoint"),f=i.getArray("Gamma");var p=i.getArray("Matrix");return new CalRGBCS(l,s,f,p);case"ICCBased":var v=e.fetchIfRef(t[1]).dict;c=v.get("N");var y=v.get("Alternate");if(y){var g=this._parse(y,e,r,n);if(g.numComps===c)return g;(0,_util.warn)("ICCBased color space: Ignoring incorrect /Alternate entry.")}if(1===c)return this.singletons.gray;if(3===c)return this.singletons.rgb;if(4===c)return this.singletons.cmyk;break;case"Pattern":return(u=t[1]||null)&&(u=this._parse(u,e,r,n)),new PatternCS(u);case"Indexed":case"I":u=this._parse(t[1],e,r,n);var m=e.fetchIfRef(t[2])+1,d=e.fetchIfRef(t[3]);return new IndexedCS(u,m,d);case"Separation":case"DeviceN":var b=e.fetchIfRef(t[1]);c=Array.isArray(b)?b.length:1,u=this._parse(t[2],e,r,n);var _=n.create(t[3]);return new AlternateCS(c,u,_);case"Lab":l=(i=e.fetchIfRef(t[1])).getArray("WhitePoint"),s=i.getArray("BlackPoint");var w=i.getArray("Range");return new LabCS(l,s,w);default:throw new _util.FormatError("Unimplemented ColorSpace object: ".concat(h))}}throw new _util.FormatError("Unrecognized ColorSpace object: ".concat(t))}},{key:"isDefaultDecode",value:function(t,e){if(!Array.isArray(t))return!0;if(2*e!==t.length)return(0,_util.warn)("The decode map is not the correct length"),!0;for(var r=0,n=t.length;r<n;r+=2)if(0!==t[r]||1!==t[r+1])return!1;return!0}},{key:"singletons",get:function(){return(0,_util.shadow)(this,"singletons",{get gray(){return(0,_util.shadow)(this,"gray",new DeviceGrayCS)},get rgb(){return(0,_util.shadow)(this,"rgb",new DeviceRgbCS)},get cmyk(){return(0,_util.shadow)(this,"cmyk",new DeviceCmykCS)}})}}]),r}();exports.ColorSpace=ColorSpace;var AlternateCS=function(t){_inherits(a,ColorSpace);var o=_createSuper(a);function a(t,e,r){var n;return _classCallCheck(this,a),(n=o.call(this,"Alternate",t)).base=e,n.tintFn=r,n.tmpBuf=new Float32Array(e.numComps),n}return _createClass(a,[{key:"getRgbItem",value:function(t,e,r,n){var o=this.tmpBuf;this.tintFn(t,e,o,0),this.base.getRgbItem(o,0,r,n)}},{key:"getRgbBuffer",value:function(t,e,r,n,o,a,i){var c,u,l=this.tintFn,s=this.base,f=1/((1<<a)-1),h=s.numComps,p=s.usesZeroToOneRange,v=(s.isPassthrough(8)||!p)&&0===i,y=v?o:0,g=v?n:new Uint8ClampedArray(h*r),m=this.numComps,d=new Float32Array(m),b=new Float32Array(h);for(c=0;c<r;c++){for(u=0;u<m;u++)d[u]=t[e++]*f;if(l(d,0,b,0),p)for(u=0;u<h;u++)g[y++]=255*b[u];else s.getRgbItem(b,0,g,y),y+=h}v||s.getRgbBuffer(g,0,r,n,o,8,i)}},{key:"getOutputLength",value:function(t,e){return this.base.getOutputLength(t*this.base.numComps/this.numComps,e)}}]),a}(),PatternCS=function(t){_inherits(n,ColorSpace);var r=_createSuper(n);function n(t){var e;return _classCallCheck(this,n),(e=r.call(this,"Pattern",null)).base=t,e}return _createClass(n,[{key:"isDefaultDecode",value:function(t,e){(0,_util.unreachable)("Should not call PatternCS.isDefaultDecode")}}]),n}(),IndexedCS=function(t){_inherits(u,ColorSpace);var c=_createSuper(u);function u(t,e,r){var n;_classCallCheck(this,u),(n=c.call(this,"Indexed",1)).base=t,n.highVal=e;var o=t.numComps*e;if(n.lookup=new Uint8Array(o),(0,_primitives.isStream)(r)){var a=r.getBytes(o);n.lookup.set(a)}else{if("string"!=typeof r)throw new _util.FormatError("IndexedCS - unrecognized lookup table: ".concat(r));for(var i=0;i<o;++i)n.lookup[i]=255&r.charCodeAt(i)}return n}return _createClass(u,[{key:"getRgbItem",value:function(t,e,r,n){var o=this.base.numComps,a=t[e]*o;this.base.getRgbBuffer(this.lookup,a,1,r,n,8,0)}},{key:"getRgbBuffer",value:function(t,e,r,n,o,a,i){for(var c=this.base,u=c.numComps,l=c.getOutputLength(u,i),s=this.lookup,f=0;f<r;++f){var h=t[e++]*u;c.getRgbBuffer(s,h,1,n,o,8,i),o+=l}}},{key:"getOutputLength",value:function(t,e){return this.base.getOutputLength(t*this.base.numComps,e)}},{key:"isDefaultDecode",value:function(t,e){return!Array.isArray(t)||(2!==t.length?((0,_util.warn)("Decode map length is not correct"),!0):!Number.isInteger(e)||e<1?((0,_util.warn)("Bits per component is not correct"),!0):0===t[0]&&t[1]===(1<<e)-1)}}]),u}(),DeviceGrayCS=function(t){_inherits(r,ColorSpace);var e=_createSuper(r);function r(){return _classCallCheck(this,r),e.call(this,"DeviceGray",1)}return _createClass(r,[{key:"getRgbItem",value:function(t,e,r,n){var o=255*t[e];r[n]=r[n+1]=r[n+2]=o}},{key:"getRgbBuffer",value:function(t,e,r,n,o,a,i){for(var c=255/((1<<a)-1),u=e,l=o,s=0;s<r;++s){var f=c*t[u++];n[l++]=f,n[l++]=f,n[l++]=f,l+=i}}},{key:"getOutputLength",value:function(t,e){return t*(3+e)}}]),r}(),DeviceRgbCS=function(t){_inherits(r,ColorSpace);var e=_createSuper(r);function r(){return _classCallCheck(this,r),e.call(this,"DeviceRGB",3)}return _createClass(r,[{key:"getRgbItem",value:function(t,e,r,n){r[n]=255*t[e],r[n+1]=255*t[e+1],r[n+2]=255*t[e+2]}},{key:"getRgbBuffer",value:function(t,e,r,n,o,a,i){if(8!==a||0!==i)for(var c=255/((1<<a)-1),u=e,l=o,s=0;s<r;++s)n[l++]=c*t[u++],n[l++]=c*t[u++],n[l++]=c*t[u++],l+=i;else n.set(t.subarray(e,e+3*r),o)}},{key:"getOutputLength",value:function(t,e){return t*(3+e)/3|0}},{key:"isPassthrough",value:function(t){return 8===t}}]),r}(),DeviceCmykCS=function(){function l(t,e,r,n,o){var a=t[e]*r,i=t[e+1]*r,c=t[e+2]*r,u=t[e+3]*r;n[o]=255+a*(-4.387332384609988*a+54.48615194189176*i+18.82290502165302*c+212.25662451639585*u-285.2331026137004)+i*(1.7149763477362134*i-5.6096736904047315*c+-17.873870861415444*u-5.497006427196366)+c*(-2.5217340131683033*c-21.248923337353073*u+17.5119270841813)+u*(-21.86122147463605*u-189.48180835922747),n[o+1]=255+a*(8.841041422036149*a+60.118027045597366*i+6.871425592049007*c+31.159100130055922*u-79.2970844816548)+i*(-15.310361306967817*i+17.575251261109482*c+131.35250912493976*u-190.9453302588951)+c*(4.444339102852739*c+9.8632861493405*u-24.86741582555878)+u*(-20.737325471181034*u-187.80453709719578),n[o+2]=255+a*(.8842522430003296*a+8.078677503112928*i+30.89978309703729*c-.23883238689178934*u-14.183576799673286)+i*(10.49593273432072*i+63.02378494754052*c+50.606957656360734*u-112.23884253719248)+c*(.03296041114873217*c+115.60384449646641*u-193.58209356861505)+u*(-22.33816807309886*u-180.12613974708367)}return function(t){_inherits(r,ColorSpace);var e=_createSuper(r);function r(){return _classCallCheck(this,r),e.call(this,"DeviceCMYK",4)}return _createClass(r,[{key:"getRgbItem",value:function(t,e,r,n){l(t,e,1,r,n)}},{key:"getRgbBuffer",value:function(t,e,r,n,o,a,i){for(var c=1/((1<<a)-1),u=0;u<r;u++)l(t,e,c,n,o),e+=4,o+=3+i}},{key:"getOutputLength",value:function(t,e){return t/4*(3+e)|0}}]),r}()}(),CalGrayCS=function(){function l(t,e,r,n,o,a){var i=e[r]*a,c=Math.pow(i,t.G),u=t.YW*c,l=Math.max(295.8*Math.pow(u,.3333333333333333)-40.8,0);n[o]=l,n[o+1]=l,n[o+2]=l}return function(t){_inherits(a,ColorSpace);var o=_createSuper(a);function a(t,e,r){var n;if(_classCallCheck(this,a),n=o.call(this,"CalGray",1),!t)throw new _util.FormatError("WhitePoint missing - required for color space CalGray");if(e=e||[0,0,0],r=r||1,n.XW=t[0],n.YW=t[1],n.ZW=t[2],n.XB=e[0],n.YB=e[1],n.ZB=e[2],n.G=r,n.XW<0||n.ZW<0||1!==n.YW)throw new _util.FormatError("Invalid WhitePoint components for ".concat(n.name)+", no fallback available");return(n.XB<0||n.YB<0||n.ZB<0)&&((0,_util.info)("Invalid BlackPoint for ".concat(n.name,", falling back to default.")),n.XB=n.YB=n.ZB=0),0===n.XB&&0===n.YB&&0===n.ZB||(0,_util.warn)("".concat(n.name,", BlackPoint: XB: ").concat(n.XB,", YB: ").concat(n.YB,", ")+"ZB: ".concat(n.ZB,", only default values are supported.")),n.G<1&&((0,_util.info)("Invalid Gamma: ".concat(n.G," for ").concat(n.name,", ")+"falling back to default."),n.G=1),n}return _createClass(a,[{key:"getRgbItem",value:function(t,e,r,n){l(this,t,e,r,n,1)}},{key:"getRgbBuffer",value:function(t,e,r,n,o,a,i){for(var c=1/((1<<a)-1),u=0;u<r;++u)l(this,t,e,n,o,c),e+=1,o+=3+i}},{key:"getOutputLength",value:function(t,e){return t*(3+e)}}]),a}()}(),CalRGBCS=function(){var _=new Float32Array([.8951,.2664,-.1614,-.7502,1.7135,.0367,.0389,-.0685,1.0296]),w=new Float32Array([.9869929,-.1470543,.1599627,.4323053,.5183603,.0492912,-.0085287,.0400428,.9684867]),C=new Float32Array([3.2404542,-1.5371385,-.4985314,-.969266,1.8760108,.041556,.0556434,-.2040259,1.0572252]),k=new Float32Array([1,1,1]),S=new Float32Array(3),R=new Float32Array(3),B=new Float32Array(3),e=Math.pow(24/116,3)/8;function P(t,e,r){r[0]=t[0]*e[0]+t[1]*e[1]+t[2]*e[2],r[1]=t[3]*e[0]+t[4]*e[1]+t[5]*e[2],r[2]=t[6]*e[0]+t[7]*e[1]+t[8]*e[2]}function G(t){return t<=.0031308?x(0,1,12.92*t):.99554525<=t?1:x(0,1,1.055*Math.pow(t,1/2.4)-.055)}function x(t,e,r){return Math.max(t,Math.min(e,r))}function A(t){return t<0?-A(-t):8<t?Math.pow((t+16)/116,3):t*e}function l(t,e,r,n,o,a){var i=x(0,1,e[r]*a),c=x(0,1,e[r+1]*a),u=x(0,1,e[r+2]*a),l=1===i?1:Math.pow(i,t.GR),s=1===c?1:Math.pow(c,t.GG),f=1===u?1:Math.pow(u,t.GB),h=t.MXA*l+t.MXB*s+t.MXC*f,p=t.MYA*l+t.MYB*s+t.MYC*f,v=t.MZA*l+t.MZB*s+t.MZC*f,y=R;y[0]=h,y[1]=p,y[2]=v;var g=B;!function(t,e,r){if(1===t[0]&&1===t[2])return r[0]=e[0],r[1]=e[1],r[2]=e[2];var n=r;P(_,e,n);var o,a,i,c=S;o=t,a=n,(i=c)[0]=1*a[0]/o[0],i[1]=1*a[1]/o[1],i[2]=1*a[2]/o[2],P(w,c,r)}(t.whitePoint,y,g);var m=R;!function(t,e,r){if(0===t[0]&&0===t[1]&&0===t[2])return r[0]=e[0],r[1]=e[1],r[2]=e[2];var n=A(0),o=(1-n)/(1-A(t[0])),a=1-o,i=(1-n)/(1-A(t[1])),c=1-i,u=(1-n)/(1-A(t[2])),l=1-u;r[0]=e[0]*o+a,r[1]=e[1]*i+c,r[2]=e[2]*u+l}(t.blackPoint,g,m);var d=B;!function(t,e,r){var n=r;P(_,e,n);var o,a,i,c=S;o=t,a=n,(i=c)[0]=.95047*a[0]/o[0],i[1]=1*a[1]/o[1],i[2]=1.08883*a[2]/o[2],P(w,c,r)}(k,m,d);var b=R;P(C,d,b),n[o]=255*G(b[0]),n[o+1]=255*G(b[1]),n[o+2]=255*G(b[2])}return function(t){_inherits(h,ColorSpace);var f=_createSuper(h);function h(t,e,r,n){var o;if(_classCallCheck(this,h),o=f.call(this,"CalRGB",3),!t)throw new _util.FormatError("WhitePoint missing - required for color space CalRGB");e=e||new Float32Array(3),r=r||new Float32Array([1,1,1]),n=n||new Float32Array([1,0,0,0,1,0,0,0,1]);var a=t[0],i=t[1],c=t[2];o.whitePoint=t;var u=e[0],l=e[1],s=e[2];if(o.blackPoint=e,o.GR=r[0],o.GG=r[1],o.GB=r[2],o.MXA=n[0],o.MYA=n[1],o.MZA=n[2],o.MXB=n[3],o.MYB=n[4],o.MZB=n[5],o.MXC=n[6],o.MYC=n[7],o.MZC=n[8],a<0||c<0||1!==i)throw new _util.FormatError("Invalid WhitePoint components for ".concat(o.name)+", no fallback available");return(u<0||l<0||s<0)&&((0,_util.info)("Invalid BlackPoint for ".concat(o.name," [").concat(u,", ").concat(l,", ").concat(s,"], ")+"falling back to default."),o.blackPoint=new Float32Array(3)),(o.GR<0||o.GG<0||o.GB<0)&&((0,_util.info)("Invalid Gamma [".concat(o.GR,", ").concat(o.GG,", ").concat(o.GB,"] for ")+"".concat(o.name,", falling back to default.")),o.GR=o.GG=o.GB=1),o}return _createClass(h,[{key:"getRgbItem",value:function(t,e,r,n){l(this,t,e,r,n,1)}},{key:"getRgbBuffer",value:function(t,e,r,n,o,a,i){for(var c=1/((1<<a)-1),u=0;u<r;++u)l(this,t,e,n,o,c),e+=3,o+=3+i}},{key:"getOutputLength",value:function(t,e){return t*(3+e)/3|0}}]),h}()}(),LabCS=function(){function d(t){return 6/29<=t?Math.pow(t,3):108/841*(t-4/29)}function b(t,e,r,n){return r+t*(n-r)/e}function l(t,e,r,n,o,a){var i=e[r],c=e[r+1],u=e[r+2];!1!==n&&(i=b(i,n,0,100),c=b(c,n,t.amin,t.amax),u=b(u,n,t.bmin,t.bmax)),c>t.amax?c=t.amax:c<t.amin&&(c=t.amin),u>t.bmax?u=t.bmax:u<t.bmin&&(u=t.bmin);var l,s,f,h=(i+16)/116,p=h+c/500,v=h-u/200,y=t.XW*d(p),g=t.YW*d(h),m=t.ZW*d(v);f=t.ZW<1?(l=3.1339*y+-1.617*g+-.4906*m,s=-.9785*y+1.916*g+.0333*m,.072*y+-.229*g+1.4057*m):(l=3.2406*y+-1.5372*g+-.4986*m,s=-.9689*y+1.8758*g+.0415*m,.0557*y+-.204*g+1.057*m),o[a]=255*Math.sqrt(l),o[a+1]=255*Math.sqrt(s),o[a+2]=255*Math.sqrt(f)}return function(t){_inherits(a,ColorSpace);var o=_createSuper(a);function a(t,e,r){var n;if(_classCallCheck(this,a),n=o.call(this,"Lab",3),!t)throw new _util.FormatError("WhitePoint missing - required for color space Lab");if(e=e||[0,0,0],r=r||[-100,100,-100,100],n.XW=t[0],n.YW=t[1],n.ZW=t[2],n.amin=r[0],n.amax=r[1],n.bmin=r[2],n.bmax=r[3],n.XB=e[0],n.YB=e[1],n.ZB=e[2],n.XW<0||n.ZW<0||1!==n.YW)throw new _util.FormatError("Invalid WhitePoint components, no fallback available");return(n.XB<0||n.YB<0||n.ZB<0)&&((0,_util.info)("Invalid BlackPoint, falling back to default"),n.XB=n.YB=n.ZB=0),(n.amin>n.amax||n.bmin>n.bmax)&&((0,_util.info)("Invalid Range, falling back to defaults"),n.amin=-100,n.amax=100,n.bmin=-100,n.bmax=100),n}return _createClass(a,[{key:"getRgbItem",value:function(t,e,r,n){l(this,t,e,!1,r,n)}},{key:"getRgbBuffer",value:function(t,e,r,n,o,a,i){for(var c=(1<<a)-1,u=0;u<r;u++)l(this,t,e,c,n,o),e+=3,o+=3+i}},{key:"getOutputLength",value:function(t,e){return t*(3+e)/3|0}},{key:"isDefaultDecode",value:function(t,e){return!0}},{key:"usesZeroToOneRange",get:function(){return(0,_util.shadow)(this,"usesZeroToOneRange",!1)}}]),a}()}();