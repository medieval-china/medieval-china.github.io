"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bidi=bidi;var _util=require("../shared/util.js"),baseTypes=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","ON","ON","ET","ET","ET","ON","ON","ON","ON","ON","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","ON","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","ON","ON","ON","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","ON","ET","ET","ET","ET","ON","ON","ON","ON","L","ON","ON","BN","ON","ON","ET","ET","EN","EN","ON","L","ON","ON","ON","EN","L","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","L","L","L","L","L","L","L","L"],arabicTypes=["AN","AN","AN","AN","AN","AN","ON","ON","AL","ET","ET","AL","CS","AL","ON","ON","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","ON","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","ON","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL"];function isOdd(L){return 0!=(1&L)}function isEven(L){return 0==(1&L)}function findUnequal(L,N,A){for(var e=N,r=L.length;e<r;++e)if(L[e]!==A)return e;return e}function setValues(L,N,A,e){for(var r=N;r<A;++r)L[r]=e}function reverseValues(L,N,A){for(var e=N,r=A-1;e<r;++e,--r){var t=L[e];L[e]=L[r],L[r]=t}}function createBidiText(L,N){var A="ltr";return 2<arguments.length&&void 0!==arguments[2]&&arguments[2]?A="ttb":N||(A="rtl"),{str:L,dir:A}}var chars=[],types=[];function bidi(L,N,A){var e=!0,r=L.length;if(0===r||A)return createBidiText(L,e,A);chars.length=r,types.length=r;var t,s,S=0;for(t=0;t<r;++t){chars[t]=L.charAt(t);var B=L.charCodeAt(t),E="L";B<=255?E=baseTypes[B]:1424<=B&&B<=1524?E="R":1536<=B&&B<=1791?(E=arabicTypes[255&B])||(0,_util.warn)("Bidi: invalid Unicode character "+B.toString(16)):1792<=B&&B<=2220&&(E="AL"),"R"!==E&&"AL"!==E&&"AN"!==E||S++,types[t]=E}if(0===S)return createBidiText(L,e=!0);-1===N&&(N=S/r<.3?(e=!0,0):(e=!1,1));var O=[];for(t=0;t<r;++t)O[t]=N;var M,a=isOdd(N)?"R":"L",i=a,p=i,n=i;for(t=0;t<r;++t)"NSM"===types[t]?types[t]=n:n=types[t];for(n=i,t=0;t<r;++t)"EN"===(M=types[t])?types[t]="AL"===n?"AN":"EN":"R"!==M&&"L"!==M&&"AL"!==M||(n=M);for(t=0;t<r;++t)"AL"===(M=types[t])&&(types[t]="R");for(t=1;t<r-1;++t)"ES"===types[t]&&"EN"===types[t-1]&&"EN"===types[t+1]&&(types[t]="EN"),"CS"!==types[t]||"EN"!==types[t-1]&&"AN"!==types[t-1]||types[t+1]!==types[t-1]||(types[t]=types[t-1]);for(t=0;t<r;++t)if("EN"===types[t]){var y;for(y=t-1;0<=y&&"ET"===types[y];--y)types[y]="EN";for(y=t+1;y<r&&"ET"===types[y];++y)types[y]="EN"}for(t=0;t<r;++t)"WS"!==(M=types[t])&&"ES"!==M&&"ET"!==M&&"CS"!==M||(types[t]="ON");for(n=i,t=0;t<r;++t)"EN"===(M=types[t])?types[t]="L"===n?"L":"EN":"R"!==M&&"L"!==M||(n=M);for(t=0;t<r;++t)if("ON"===types[t]){var o=findUnequal(types,t+1,"ON"),f=i;0<t&&(f=types[t-1]);var c=p;o+1<r&&(c=types[o+1]),"L"!==f&&(f="R"),"L"!==c&&(c="R"),f===c&&setValues(types,t,o,f),t=o-1}for(t=0;t<r;++t)"ON"===types[t]&&(types[t]=a);for(t=0;t<r;++t)M=types[t],isEven(O[t])?"R"===M?O[t]+=1:"AN"!==M&&"EN"!==M||(O[t]+=2):"L"!==M&&"AN"!==M&&"EN"!==M||(O[t]+=1);var u,v=-1,d=99;for(t=0,s=O.length;t<s;++t)v<(u=O[t])&&(v=u),u<d&&isOdd(u)&&(d=u);for(u=v;d<=u;--u){var l=-1;for(t=0,s=O.length;t<s;++t)O[t]<u?0<=l&&(reverseValues(chars,l,t),l=-1):l<0&&(l=t);0<=l&&reverseValues(chars,l,O.length)}for(t=0,s=chars.length;t<s;++t){var T=chars[t];"<"!==T&&">"!==T||(chars[t]="")}return createBidiText(chars.join(""),e)}