"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _createForOfIteratorHelper(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);var n=r.call(t,e||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(n){var o=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(n);if(o){var r=_getPrototypeOf(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _possibleConstructorReturn(t,e){if(e&&("object"===_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.collectActions=collectActions,exports.encodeToXmlString=encodeToXmlString,exports.escapePDFName=escapePDFName,exports.getArrayLookupTableFactory=getArrayLookupTableFactory,exports.getInheritableProperty=getInheritableProperty,exports.getLookupTableFactory=getLookupTableFactory,exports.isWhiteSpace=isWhiteSpace,exports.log2=log2,exports.parseXFAPath=parseXFAPath,exports.readInt8=readInt8,exports.readUint16=readUint16,exports.readUint32=readUint32,exports.toRomanNumerals=toRomanNumerals,exports.XRefParseException=exports.XRefEntryException=exports.MissingDataException=void 0;var _util=require("../shared/util.js"),_primitives=require("./primitives.js");function getLookupTableFactory(t){var e;return function(){return t&&(e=Object.create(null),t(e),t=null),e}}function getArrayLookupTableFactory(n){var o;return function(){if(n){var t=n();n=null,o=Object.create(null);for(var e=0,r=t.length;e<r;e+=2)o[t[e]]=t[e+1];t=null}return o}}var MissingDataException=function(t){_inherits(o,_util.BaseException);var n=_createSuper(o);function o(t,e){var r;return _classCallCheck(this,o),(r=n.call(this,"Missing data [".concat(t,", ").concat(e,")"))).begin=t,r.end=e,r}return _createClass(o)}();exports.MissingDataException=MissingDataException;var XRefEntryException=function(t){_inherits(r,_util.BaseException);var e=_createSuper(r);function r(){return _classCallCheck(this,r),e.apply(this,arguments)}return _createClass(r)}();exports.XRefEntryException=XRefEntryException;var XRefParseException=function(t){_inherits(r,_util.BaseException);var e=_createSuper(r);function r(){return _classCallCheck(this,r),e.apply(this,arguments)}return _createClass(r)}();function getInheritableProperty(t){for(var e,r=t.dict,n=t.key,o=t.getArray,i=void 0!==o&&o,a=t.stopWhenFound,c=void 0===a||a,u=new _primitives.RefSet;r instanceof _primitives.Dict&&(!r.objId||!u.has(r.objId));){r.objId&&u.put(r.objId);var s=i?r.getArray(n):r.get(n);if(void 0!==s){if(c)return s;e||(e=[]),e.push(s)}r=r.get("Parent")}return e}exports.XRefParseException=XRefParseException;var ROMAN_NUMBER_MAP=["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM","","X","XX","XXX","XL","L","LX","LXX","LXXX","XC","","I","II","III","IV","V","VI","VII","VIII","IX"];function toRomanNumerals(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];(0,_util.assert)(Number.isInteger(t)&&0<t,"The number should be a positive integer.");for(var r,n=[];1e3<=t;)t-=1e3,n.push("M");r=t/100|0,t%=100,n.push(ROMAN_NUMBER_MAP[r]),r=t/10|0,t%=10,n.push(ROMAN_NUMBER_MAP[10+r]),n.push(ROMAN_NUMBER_MAP[20+t]);var o=n.join("");return e?o.toLowerCase():o}function log2(t){return t<=0?0:Math.ceil(Math.log2(t))}function readInt8(t,e){return t[e]<<24>>24}function readUint16(t,e){return t[e]<<8|t[e+1]}function readUint32(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}function isWhiteSpace(t){return 32===t||9===t||13===t||10===t}function parseXFAPath(t){var r=/(.+)\[([0-9]+)\]$/;return t.split(".").map(function(t){var e=t.match(r);return e?{name:e[1],pos:parseInt(e[2],10)}:{name:t,pos:0}})}function escapePDFName(t){for(var e=[],r=0,n=0,o=t.length;n<o;n++){var i=t.charCodeAt(n);(i<33||126<i||35===i||40===i||41===i||60===i||62===i||91===i||93===i||123===i||125===i||47===i||37===i)&&(r<n&&e.push(t.substring(r,n)),e.push("#".concat(i.toString(16))),r=n+1)}return 0===e.length?t:(r<t.length&&e.push(t.substring(r,t.length)),e.join(""))}function _collectJS(t,e,r,n){if(t){var o=null;if((0,_primitives.isRef)(t)){if(n.has(t))return;o=t,n.put(o),t=e.fetch(t)}if(Array.isArray(t)){var i,a=_createForOfIteratorHelper(t);try{for(a.s();!(i=a.n()).done;){_collectJS(i.value,e,r,n)}}catch(t){a.e(t)}finally{a.f()}}else if(t instanceof _primitives.Dict){if((0,_primitives.isName)(t.get("S"),"JavaScript")&&t.has("JS")){var c,u=t.get("JS");c=(0,_primitives.isStream)(u)?(0,_util.bytesToString)(u.getBytes()):u,(c=(0,_util.stringToPDFString)(c))&&r.push(c)}_collectJS(t.getRaw("Next"),e,r,n)}o&&n.remove(o)}}function collectActions(t,e,r){var n=Object.create(null),o=getInheritableProperty({dict:e,key:"AA",stopWhenFound:!1});if(o)for(var i=o.length-1;0<=i;i--){var a=o[i];if(a instanceof _primitives.Dict){var c,u=_createForOfIteratorHelper(a.getKeys());try{for(u.s();!(c=u.n()).done;){var s=c.value,l=r[s];if(l){var p=a.getRaw(s),f=new _primitives.RefSet,y=[];_collectJS(p,t,y,f),0<y.length&&(n[l]=y)}}}catch(t){u.e(t)}finally{u.f()}}}if(e.has("A")){var h=[];_collectJS(e.get("A"),t,h,new _primitives.RefSet),0<h.length&&(n.Action=h)}return 0<(0,_util.objectSize)(n)?n:null}var XMLEntities={60:"&lt;",62:"&gt;",38:"&amp;",34:"&quot;",39:"&apos;"};function encodeToXmlString(t){for(var e=[],r=0,n=0,o=t.length;n<o;n++){var i=t.codePointAt(n);if(32<=i&&i<=126){var a=XMLEntities[i];a&&(r<n&&e.push(t.substring(r,n)),e.push(a),r=n+1)}else r<n&&e.push(t.substring(r,n)),e.push("&#x".concat(i.toString(16).toUpperCase(),";")),55295<i&&(i<57344||65533<i)&&n++,r=n+1}return 0===e.length?t:(r<t.length&&e.push(t.substring(r,t.length)),e.join(""))}