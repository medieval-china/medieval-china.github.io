"use strict";function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&_setPrototypeOf(e,r)}function _setPrototypeOf(e,r){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e})(e,r)}function _createSuper(n){var o=_isNativeReflectConstruct();return function(){var e,r=_getPrototypeOf(n);if(o){var t=_getPrototypeOf(this).constructor;e=Reflect.construct(r,arguments,t)}else e=r.apply(this,arguments);return _possibleConstructorReturn(this,e)}}function _possibleConstructorReturn(e,r){if(r&&("object"===_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _createForOfIteratorHelper(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _iterableToArrayLimit(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,o,i,a,s=[],u=!0,l=!1;try{if(i=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;u=!1}else for(;!(u=(n=i.call(t)).done)&&(s.push(n.value),s.length!==r);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var r=_toPrimitive(e,"string");return"symbol"===_typeof(r)?r:String(r)}function _toPrimitive(e,r){if("object"!==_typeof(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0===t)return("string"===r?String:Number)(e);var n=t.call(e,r||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.XMLParserErrorCode=exports.XMLParserBase=exports.SimpleXMLParser=exports.SimpleDOMNode=void 0;var _core_utils=require("./core_utils.js"),XMLParserErrorCode={NoError:0,EndOfDocument:-1,UnterminatedCdat:-2,UnterminatedXmlDeclaration:-3,UnterminatedDoctypeDeclaration:-4,UnterminatedComment:-5,MalformedElement:-6,OutOfMemory:-7,UnterminatedAttributeValue:-8,UnterminatedElement:-9,ElementNeverBegun:-10};function isWhitespace(e,r){var t=e[r];return" "===t||"\n"===t||"\r"===t||"\t"===t}function isWhitespaceString(e){for(var r=0,t=e.length;r<t;r++)if(!isWhitespace(e,r))return!1;return!0}exports.XMLParserErrorCode=XMLParserErrorCode;var XMLParserBase=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"_resolveEntities",value:function(e){var t=this;return e.replace(/&([^;]+);/g,function(e,r){if("#x"===r.substring(0,2))return String.fromCodePoint(parseInt(r.substring(2),16));if("#"===r.substring(0,1))return String.fromCodePoint(parseInt(r.substring(1),10));switch(r){case"lt":return"<";case"gt":return">";case"amp":return"&";case"quot":return'"';case"apos":return"'"}return t.onResolveEntity(r)})}},{key:"_parseContent",value:function(e,r){var t=[],n=r;function o(){for(;n<e.length&&isWhitespace(e,n);)++n}for(;n<e.length&&!isWhitespace(e,n)&&">"!==e[n]&&"/"!==e[n];)++n;var i=e.substring(r,n);for(o();n<e.length&&">"!==e[n]&&"/"!==e[n]&&"?"!==e[n];){o();for(var a,s="";n<e.length&&!isWhitespace(e,n)&&"="!==e[n];)s+=e[n],++n;if(o(),"="!==e[n])return null;++n,o();var u=e[n];if('"'!==u&&"'"!==u)return null;var l=e.indexOf(u,++n);if(l<0)return null;a=e.substring(n,l),t.push({name:s,value:this._resolveEntities(a)}),n=l+1,o()}return{name:i,attributes:t,parsed:n-r}}},{key:"_parseProcessingInstruction",value:function(e,r){var t=r;for(;t<e.length&&!isWhitespace(e,t)&&">"!==e[t]&&"/"!==e[t];)++t;var n=e.substring(r,t);!function(){for(;t<e.length&&isWhitespace(e,t);)++t}();for(var o=t;t<e.length&&("?"!==e[t]||">"!==e[t+1]);)++t;return{name:n,value:e.substring(o,t),parsed:t-r}}},{key:"parseXml",value:function(e){for(var r=0;r<e.length;){var t=r;if("<"===e[r]){var n=void 0;switch(e[++t]){case"/":if(++t,(n=e.indexOf(">",t))<0)return void this.onError(XMLParserErrorCode.UnterminatedElement);this.onEndElement(e.substring(t,n)),t=n+1;break;case"?":++t;var o=this._parseProcessingInstruction(e,t);if("?>"!==e.substring(t+o.parsed,t+o.parsed+2))return void this.onError(XMLParserErrorCode.UnterminatedXmlDeclaration);this.onPi(o.name,o.value),t+=o.parsed+2;break;case"!":if("--"===e.substring(t+1,t+3)){if((n=e.indexOf("--\x3e",t+3))<0)return void this.onError(XMLParserErrorCode.UnterminatedComment);this.onComment(e.substring(t+3,n)),t=n+3}else if("[CDATA["===e.substring(t+1,t+8)){if((n=e.indexOf("]]>",t+8))<0)return void this.onError(XMLParserErrorCode.UnterminatedCdat);this.onCdata(e.substring(t+8,n)),t=n+3}else{if("DOCTYPE"!==e.substring(t+1,t+8))return void this.onError(XMLParserErrorCode.MalformedElement);var i=e.indexOf("[",t+8),a=!1;if((n=e.indexOf(">",t+8))<0)return void this.onError(XMLParserErrorCode.UnterminatedDoctypeDeclaration);if(0<i&&i<n){if((n=e.indexOf("]>",t+8))<0)return void this.onError(XMLParserErrorCode.UnterminatedDoctypeDeclaration);a=!0}var s=e.substring(t+8,n+(a?1:0));this.onDoctype(s),t=n+(a?2:1)}break;default:var u=this._parseContent(e,t);if(null===u)return void this.onError(XMLParserErrorCode.MalformedElement);var l=!1;if("/>"===e.substring(t+u.parsed,t+u.parsed+2))l=!0;else if(">"!==e.substring(t+u.parsed,t+u.parsed+1))return void this.onError(XMLParserErrorCode.UnterminatedElement);this.onBeginElement(u.name,u.attributes,l),t+=u.parsed+(l?2:1)}}else{for(;t<e.length&&"<"!==e[t];)t++;var c=e.substring(r,t);this.onText(this._resolveEntities(c))}r=t}}},{key:"onResolveEntity",value:function(e){return"&".concat(e,";")}},{key:"onPi",value:function(e,r){}},{key:"onComment",value:function(e){}},{key:"onCdata",value:function(e){}},{key:"onDoctype",value:function(e){}},{key:"onText",value:function(e){}},{key:"onBeginElement",value:function(e,r,t){}},{key:"onEndElement",value:function(e){}},{key:"onError",value:function(e){}}]),e}();exports.XMLParserBase=XMLParserBase;var SimpleDOMNode=function(){function t(e,r){_classCallCheck(this,t),this.nodeName=e,this.nodeValue=r,Object.defineProperty(this,"parentNode",{value:null,writable:!0})}return _createClass(t,[{key:"firstChild",get:function(){return this.childNodes&&this.childNodes[0]}},{key:"nextSibling",get:function(){var e=this.parentNode.childNodes;if(e){var r=e.indexOf(this);if(-1!==r)return e[r+1]}}},{key:"textContent",get:function(){return this.childNodes?this.childNodes.map(function(e){return e.textContent}).join(""):this.nodeValue||""}},{key:"hasChildNodes",value:function(){return this.childNodes&&0<this.childNodes.length}},{key:"searchNode",value:function(e,r){if(r>=e.length)return this;for(var t=e[r],n=[],o=this;;){if(t.name===o.nodeName){if(0!==t.pos){if(0===n.length)return null;var i,a=0,s=_createForOfIteratorHelper(_slicedToArray(n.pop(),1)[0].childNodes);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(t.name===u.nodeName){if(a===t.pos)return u.searchNode(e,r+1);a++}}}catch(e){s.e(e)}finally{s.f()}return o.searchNode(e,r+1)}var l=o.searchNode(e,r+1);if(null!==l)return l}if(o.childNodes&&0!==o.childNodes.length)n.push([o,0]),o=o.childNodes[0];else{if(0===n.length)return null;for(;0!==n.length;){var c=_slicedToArray(n.pop(),2),f=c[0],d=c[1]+1;if(d<f.childNodes.length){n.push([f,d]),o=f.childNodes[d];break}}if(0===n.length)return null}}}},{key:"dump",value:function(e){if("#text"!==this.nodeName){if(e.push("<".concat(this.nodeName)),this.attributes){var r,t=_createForOfIteratorHelper(this.attributes);try{for(t.s();!(r=t.n()).done;){var n=r.value;e.push(" ".concat(n.name,'="').concat((0,_core_utils.encodeToXmlString)(n.value),'"'))}}catch(e){t.e(e)}finally{t.f()}}if(this.hasChildNodes()){e.push(">");var o,i=_createForOfIteratorHelper(this.childNodes);try{for(i.s();!(o=i.n()).done;){o.value.dump(e)}}catch(e){i.e(e)}finally{i.f()}e.push("</".concat(this.nodeName,">"))}else this.nodeValue?e.push(">".concat((0,_core_utils.encodeToXmlString)(this.nodeValue),"</").concat(this.nodeName,">")):e.push("/>")}else e.push((0,_core_utils.encodeToXmlString)(this.nodeValue))}}]),t}();exports.SimpleDOMNode=SimpleDOMNode;var SimpleXMLParser=function(e){_inherits(s,XMLParserBase);var a=_createSuper(s);function s(e){var r,t=e.hasAttributes,n=void 0!==t&&t,o=e.lowerCaseName,i=void 0!==o&&o;return _classCallCheck(this,s),(r=a.call(this))._currentFragment=null,r._stack=null,r._errorCode=XMLParserErrorCode.NoError,r._hasAttributes=n,r._lowerCaseName=i,r}return _createClass(s,[{key:"parseFromString",value:function(e){if(this._currentFragment=[],this._stack=[],this._errorCode=XMLParserErrorCode.NoError,this.parseXml(e),this._errorCode===XMLParserErrorCode.NoError){var r=_slicedToArray(this._currentFragment,1)[0];if(r)return{documentElement:r}}}},{key:"onText",value:function(e){if(!isWhitespaceString(e)){var r=new SimpleDOMNode("#text",e);this._currentFragment.push(r)}}},{key:"onCdata",value:function(e){var r=new SimpleDOMNode("#text",e);this._currentFragment.push(r)}},{key:"onBeginElement",value:function(e,r,t){this._lowerCaseName&&(e=e.toLowerCase());var n=new SimpleDOMNode(e);n.childNodes=[],this._hasAttributes&&(n.attributes=r),this._currentFragment.push(n),t||(this._stack.push(this._currentFragment),this._currentFragment=n.childNodes)}},{key:"onEndElement",value:function(e){this._currentFragment=this._stack.pop()||[];var r=this._currentFragment[this._currentFragment.length-1];if(r)for(var t=0,n=r.childNodes.length;t<n;t++)r.childNodes[t].parentNode=r}},{key:"onError",value:function(e){this._errorCode=e}}]),s}();exports.SimpleXMLParser=SimpleXMLParser;