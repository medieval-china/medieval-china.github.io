!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Snow=e()}(this,function(){"use strict";function e(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function i(r){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?e(Object(i),!0).forEach(function(t){var e,n;e=r,t=i[n=t],n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(i,t))})}return r}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function t(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function o(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){if(t){if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(n="Object"===n&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(t,e):void 0}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function l(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=s(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,e=function(){};return{s:e,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){o=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function f(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(e<t)throw new Error("min is ".concat(t,", max is ").concat(e,", max should bigger than min!"));return n?Math.floor(t+Math.random()*(e-t)):t+Math.random()*(e-t)}function h(t){return t[f(0,t.length,!0)]}var u=function(){function n(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;a(this,n),this.image=e,this.config=t,this.load()}return t(n,[{key:"center",value:function(){return{x:this.x+this.radius/2,y:this.y+this.radius/2}}},{key:"load",value:function(){this.x=f(0,window.innerWidth),this.y=f(-window.innerHeight,0),this.alpha=f.apply(void 0,o(this.config.alpha)),this.radius=f.apply(void 0,o(this.config.radius)),this.color=h(this.config.color),this.angle=0,this.flip=0,this.va=Math.PI/f.apply(void 0,o(this.config.va)),this.va=.5<=Math.random()?this.va:-this.va,this.vx=f.apply(void 0,o(this.config.vx)),this.vy=f.apply(void 0,o(this.config.vy)),this.config.vf&&(this.vf=f(0,this.config.vf))}},{key:"update",value:function(t){this.x+=this.vx,this.y+=this.vy,this.angle+=this.va,this.flip+=this.vf,(1<this.flip||this.flip<0)&&(this.vf=-this.vf),this.y>=t+this.radius&&this.load()}}]),n}();return function(){function r(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};a(this,r);var n=e.num;this.num=n||window.innerWidth/3,delete e.num,this.config=i({color:["white"],vx:[-3,3],vy:[2,5],va:[45,180],vf:0,radius:[5,15],alpha:[.1,.9],image:[]},e),this.init(t)}return t(r,[{key:"init",value:function(t){var e=this;this.container=document.querySelector(t),this.canvas=document.createElement("canvas"),this.canvas.width=this.container.offsetWidth,this.canvas.height=this.container.offsetHeight,this.ctx=this.canvas.getContext("2d"),this.container.appendChild(this.canvas),this.snowflakes=new Set,this.config.image.length?this.loadImage(this.config.image).then(function(t){e.createSnowflakes(t),requestAnimationFrame(e.drawPicture())}).catch(function(t){return console.error(t)}):(this.createSnowflakes(),requestAnimationFrame(this.drawCircle()))}},{key:"loadImage",value:function(t){return Promise.all(t.map(function(t){return n=t,new Promise(function(t){var e=new Image;e.src=n,e.onload=function(){return t(e)},e.onerror=function(t){return console.error("图片加载失败：".concat(t.path[0].src))}});var n}))}},{key:"createSnowflakes",value:function(t){if(t)for(var e=0;e<this.num;e++){var n=h(t),n=new u(this.config,n);this.snowflakes.add(n)}else for(var r=0;r<this.num;r++){var i=new u(this.config);this.snowflakes.add(i)}}},{key:"transform",value:function(t){t.update(this.canvas.height);var e=t.center(),n=e.x,e=e.y;this.ctx.translate(n,e),this.ctx.rotate(t.angle),t.vf&&this.ctx.scale(1,t.flip),this.ctx.translate(-n,-e)}},{key:"drawCircle",value:function(){var i=this;return function t(){i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height);var e,n=l(i.snowflakes);try{for(n.s();!(e=n.n()).done;){var r=e.value;i.ctx.save(),i.transform(r),i.ctx.beginPath(),i.ctx.arc(r.x,r.y,r.radius,0,2*Math.PI),i.ctx.closePath(),i.ctx.globalAlpha=r.alpha,i.ctx.fillStyle=r.color,i.ctx.fill(),i.ctx.restore()}}catch(t){n.e(t)}finally{n.f()}requestAnimationFrame(t)}}},{key:"drawPicture",value:function(){var i=this;return function t(){i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height);var e,n=l(i.snowflakes);try{for(n.s();!(e=n.n()).done;){var r=e.value;i.ctx.save(),i.transform(r),i.ctx.globalAlpha=r.alpha,i.ctx.drawImage(r.image,r.x,r.y,r.radius,r.radius),i.ctx.restore()}}catch(t){n.e(t)}finally{n.f()}requestAnimationFrame(t)}}}]),r}()});
