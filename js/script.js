"use strict";function _createForOfIteratorHelper(e,a){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||a&&e&&"number"==typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,r=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return r=e.done,e},e:function(e){c=!0,i=e},f:function(){try{r||null==t.return||t.return()}finally{if(c)throw i}}}}function _unsupportedIterableToArray(e,a){if(e){if("string"==typeof e)return _arrayLikeToArray(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,a):void 0}}function _arrayLikeToArray(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}!function($){var fabTimer=null,SESSION_KEY="ON_SESSION",fn={showMenu:function(){$(".menu").fadeIn(300),$("body").addClass("lock-screen"),fn.hideFab(),ZHAOO.utils.bindKeyup(27,function(){fn.hideMenu(),$(".navbar").removeClass("hide")})},hideMenu:function(){$(".menu").fadeOut(300),$("body").removeClass("lock-screen")},showSearch:function(){$(".search").fadeIn(300),$(".search input").focus(),$("body").addClass("lock-screen"),fn.hideFab(),$(".preview-overlay").fadeOut(300),ZHAOO.utils.bindKeyup(27,function(){fn.hideSearch(),$(".navbar").removeClass("hide")})},hideSearch:function(){$(".search").fadeOut(300),$(".preview-overlay").fadeIn(300),$("body").removeClass("lock-screen")},activeFab:function(){$(".fab-up").addClass("fab-up-active"),$(".fab-plus").addClass("fab-plus-active"),$(".fab-comment").addClass("fab-comment-active"),$(".fab-daovoice").addClass("fab-daovoice-active"),$(".fab-tencent-chao").addClass("fab-tencent-chao-active"),$(".fab-like").addClass("fab-like-active"),$(".fab-plus").animate({opacity:1},250)},freezeFab:function(){$(".fab-up").removeClass("fab-up-active"),$(".fab-plus").removeClass("fab-plus-active"),$(".fab-comment").removeClass("fab-comment-active"),$(".fab-daovoice").removeClass("fab-daovoice-active"),$(".fab-tencent-chao").removeClass("fab-tencent-chao-active"),$(".fab-like").removeClass("fab-like-active"),clearTimeout(fabTimer),fabTimer=setTimeout(function(){$(".fab-plus:not(.fab-plus-active)").animate({opacity:.68},1500)},2e3)},showFab:function(){$(".fab").removeClass("fab-hide").addClass("fab-show")},hideFab:function(){$(".fab").addClass("fab-hide").removeClass("fab-show")},scroolFab:function(){$(window).height()<$(window).scrollTop()?fn.showFab():(fn.freezeFab(),fn.hideFab())},scroolToTop:function(){$("body,html").animate({scrollTop:"0px"},800)},navbar:{mobile:function(){var a=$(window).scrollTop(),t=$(window).height();function e(){var e=$(window).scrollTop();CONFIG.isHome||(e<a?$(".navbar").removeClass("hide"):a<e&&300<e&&$(".navbar").addClass("hide")),CONFIG.isHome&&(e<t-100?$(".navbar").addClass("transparent"):$(".navbar").removeClass("transparent"),e<a?$(".navbar").removeClass("hide"):a<e&&300<e&&$(".navbar").addClass("hide")),a=e}CONFIG.isHome?$(".navbar").addClass("transparent"):$(".navbar").removeClass("transparent").removeClass("hide"),e(),$(window).on("scroll",ZHAOO.utils.throttle(function(){e()},250))},desktop:function(){function t(){60<$(window).scrollTop()?$(".navbar .center").addClass("hide"):($(".navbar .center").removeClass("hide"),$(".navbar").removeClass("hide"),CONFIG.isHome?($(".navbar").addClass("transparent"),$(".navbar .pc-menu a").addClass("stroke")):$(".navbar").removeClass("transparent"))}$(".navbar").addClass("transparent"),t();var n=$(this).scrollTop();$(window).on("scroll",ZHAOO.utils.throttle(function(){t();var e=$(window).height(),a=$(this).scrollTop();a<n?($(".navbar").removeClass("hide"),CONFIG.isHome&&(e-100<a?($(".navbar").removeClass("transparent"),$(".navbar .pc-menu a").removeClass("stroke")):($(".navbar").addClass("transparent"),$(".navbar .pc-menu a").addClass("stroke")))):n<a&&100<a&&$(".navbar").addClass("hide"),n=a},250))}},motto:function(){if("custom"!==CONFIG.preview.motto.api)if(CONFIG.preview.motto.api){var e=CONFIG.preview.motto.data_contents&&JSON.parse(CONFIG.preview.motto.data_contents);$.get(CONFIG.preview.motto.api,function(a){0<e.length&&e.forEach(function(e){a=a[e]}),a&&fn.printMotto(a)})}else fn.printMotto(CONFIG.preview.motto.default)},printMotto:function(a,t){if(t=t||{},CONFIG.preview.motto.typing){"。"===a.charAt(a.length-1)&&(a=a.substr(0,a.length-1));var n=0;setTimeout(function(){var e=setInterval(function(){n>=a.length&&clearInterval(e),$("#motto").text(a.slice(0,n++)),$("#motto").attr("title",t?t.title+" "+t.date:a),$("#motto").attr("data-href",t.path||"")},120)},260)}else $("#motto").text(a)},preloadImages:function(e){var a=[];"string"==typeof e?a=[e]:Array.isArray(e)&&(a=e),a.forEach(function(e){var a=new Image;a.onload=function(){},a.src=e})},background:function(){if("custom"===CONFIG.preview.background.api){var e=window.localPosts?window.localPosts:[],a=e[n=Math.floor(Math.random()*e.length)];if(!a)return;var t=a.image;(o=new Image).onload=function(){console.log("图片加载好了",t),$(".preview-image .loading-ani").css({"background-image":"url("+encodeURI(t)+")"}).fadeIn(350),setTimeout(function(){$(".preview .preview-motto-wrapper .preview-motto").css({color:"#fff","text-shadow":"1px 1px 2px #333"})},350)},$(".preview-image .remark").html(a.title+"<br /><small>"+a.date+"</small>"),fn.printMotto(a.excerpt,a),o.src=t}else if("local"===CONFIG.preview.background.api){var n,o,i=window.siteData?window.siteData.local_images:[];t=i[n=Math.floor(Math.random()*i.length)];console.log("随机图片2:",n),(o=new Image).onload=function(){console.log("图片加载好了",t),$(".preview-image .loading-ani").fadeIn(520).css({"background-image":"url("+t+")"}),$(".preview .preview-motto-wrapper .preview-motto").css({color:"#fff"})},o.src=t}},doSearch:function(e,i,r){$.ajax({url:e,dataType:"xml",cache:!0,success:function(e){var a=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),t=document.getElementById(i),n=document.getElementById(r);var o=ZHAOO.utils.debounce(function(){var m='<ul class="search-result-list">',h=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length<=0||(a.forEach(function(e){var t=!0,n=e.title.trim().toLowerCase(),o=e.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),a=e.url,i=-1,r=-1,c=-1;if(""!=n&&""!=o&&h.forEach(function(e,a){i=n.indexOf(e),r=o.indexOf(e),i<0&&r<0?t=!1:(r<0&&(r=0),0==a&&(c=r))}),t){var s=n;h.forEach(function(e){var a=new RegExp(e,"gi");s=s.replace(a,'<em class="search-keyword">'+e+"</em>")}),m+="<li><a href='"+a+"' class='search-result-title' target='_blank'>"+s+"</a>";var l=e.content.trim().replace(/<[^>]+>/g,"");if(0<=c){var d=c-6,f=c+6;d<0&&(d=0),0==d&&(f=10),f>l.length&&(f=l.length);var u=l.substr(d,f);h.forEach(function(e){var a=new RegExp(e,"gi");u=u.replace(a,'<em class="search-keyword">'+e+"</em>")}),m+='<p class="search-result">'+u+"...</p>"}}}),n.innerHTML=m,$(n).prepend('<div class="search-count-box">共找到<span> '+$(".search-keyword").length+" </span>条结果</div>"))},500);t.addEventListener("input",o)}})}},action={smoothScroll:function(){$(".smooth-scroll, .toc-link").click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var e=$(decodeURIComponent(this.hash));if((e=e.length&&e||$("[name="+this.hash.slice(1)+"]")).length){var a=e.offset().top;return $("html,body").animate({scrollTop:a},500),location.hash=this.hash,!1}}})},loading:function(e){$(".loading").delay(e).fadeOut(350),$("body").removeClass("lock-screen"),setTimeout(function(){Array.isArray(animations)&&animations.forEach(function(e){return e.destroy()})},e+1e3)},fab:function(){$(".fab-plus").on("click",function(){$(this).hasClass("fab-plus-active")?fn.freezeFab():fn.activeFab()}),$(".fab-daovoice").on("click",function(){daovoice("openMessages")}),$(".fab-up, .fab-daovoice, fab-tencent-chao").on("click",function(){fn.freezeFab()}),CONFIG.fab.always_show?fn.showFab():$(window).scroll(fn.scroolFab)},menu:function(){$(".menu-close").on("click",function(){fn.hideMenu(),$(".navbar").removeClass("hide")}),$(".menu .menu-container").on("click",function(e){"menu-container"===$(e.target).attr("class")&&(fn.hideMenu(),$(".navbar").removeClass("hide"))})},scroolToTop:function(){$(".fab-up").on("click",function(){fn.scroolToTop()})},scroolToComment:function(){var e=document.querySelector(".fab.fab-comment");$(e).on("click",function(){var e=document.querySelector(".comments");e&&e.scrollIntoView({behavior:"smooth",block:"start"})})},fancybox:function(){$(".fancybox").fancybox(),$(".article .content img, .article .head img").each(function(){var e=document.createElement("a");$(e).attr("data-fancybox","images"),$(e).attr("href",$(this).attr("src")),$(this).wrap(e)})},pjax:function(){$(function(){$(document).pjax("a:not(.menu *)","#main",{fragment:"#main",timeout:6e3})}),$(document).on("pjax:complete",function(){CONFIG.fancybox&&action.fancybox()})},donate:function donate(){$(".donate .icon").on("mouseover",function(){$("#qrcode-donate").show()}),$(".donate .icon").children("a").on("mouseover",function(){$("#qrcode-donate img").attr("src",eval("CONFIG.donate."+$(this).attr("id")))}),$(".donate .icon").on("mouseout",function(){$("#qrcode-donate").hide()})},lazyload:function(e){var a=(e=e||{}).container,t=e.threshold;$("img.lazyload").lazyload({container:a||window,effect:"fadeIn",threshold:t||500,skip_invisible:!1})},fixLazyloadFancybox:function(){$(document).find(".article img[data-original]").each(function(){$(this).parent().attr("href",$(this).attr("data-original"))})},carrier:function(){$(".j-carrier-btn").on("click",ZHAOO.utils.throttle(function(){$(".j-carrier-data").select(),document.execCommand("Copy"),ZHAOO.zui.message({text:"已复制到剪切板",type:"success"})},1e3))},navbar:function(){$(window).resize(ZHAOO.utils.throttle(function(){ZHAOO.utils.isDesktop()&&fn.navbar.desktop(),ZHAOO.utils.isMobile()&&fn.navbar.mobile()},1e3)).resize(),$(".j-navbar-menu").on("click",function(){fn.showMenu(),$(".navbar").addClass("hide"),$(".qrcode").fadeOut(300)}),$(".j-navbar-qrcode").on("click",function(){$("#qrcode-navbar").is(":hidden")?$("#qrcode-navbar").fadeIn(300):$("#qrcode-navbar").fadeOut(300)}),$(".j-navbar-back-home").on("click",function(){window.location.href="/"}),$(".j-navbar-search").on("click",function(){fn.showSearch(),$(".navbar").addClass("hide"),$(".qrcode").fadeOut(300)})},preview:function(){fn.background(),fn.motto(),setTimeout(function(){},1e3)},qrcode:function(){"url"===CONFIG.qrcode.type?$("#qrcode-navbar").qrcode({text:window.location.href,width:150,height:150}):"image"===CONFIG.qrcode.type&&$("#qrcode-navbar").append('<img src="'+CONFIG.qrcode.image+'" alt="qrcode" />')},toc:function(){var o=[],i=new Map;function e(){var e,a=$(this).scrollTop()||$(window).scrollTop(),t=_createForOfIteratorHelper(i);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(n[0]>=a){o=n;break}}}catch(e){t.e(e)}finally{t.f()}$(".toc-link").removeClass("active"),$(".toc-link[href='#"+o[1]+"']").addClass("active")}$("article .content h1,h2,h3,h4,h5,h6").each(function(){var e=$(this).attr("id"),a=$(this).offset().top;i.set(a,e)}),$(window).on("scroll",ZHAOO.utils.debounce(e,500)),e()},scrollbar:function(){var t=$(document).height(),n=$(window).height();function e(){var e=t-n,a=$(document).scrollTop()/e*100;$(".j-scrollbar-current").css("height",a+"%")}$(window).on("scroll",ZHAOO.utils.debounce(e,500)),e(),$(".j-scrollbar").mousedown(function(e){var a=e.offsetY*t/100;$("html,body").animate({scrollTop:a},300),$(document).mousemove(function(e){var a=(1-(n-e.clientY)/n)*t;$("html,body").scrollTop(a),$("html,body").css({"user-select":"none",cursor:"move"})}),$(document).mouseup(function(){$(document).off("mousemove"),$("html,body").css({"user-select":"auto",cursor:"default"})})})},notification:function(){if(CONFIG.notification.list){var e=CONFIG.notification.page_white_list&&JSON.parse(CONFIG.notification.page_white_list),a=CONFIG.notification.page_black_list&&JSON.parse(CONFIG.notification.page_black_list),t=window.location.pathname;if(!(e&&e.indexOf(t)<0||a&&0<=a.indexOf(t))){var n=CONFIG.notification.delay;JSON.parse(CONFIG.notification.list).filter(function(e){return e.enable&&ZHAOO.utils.isDuringDate(e.startTime,e.endTime)&&e}).forEach(function(e){ZHAOO.zui.notification({title:e.title,content:e.content,delay:n})})}}},search:function(){var e=CONFIG.search.path;e&&($(".search-close").on("click",function(){fn.hideSearch(),$(".navbar").removeClass("hide")}),$(".search").on("click",".search-container",function(e){"search-container"===$(e.target).attr("class")&&(fn.hideSearch(),$(".navbar").removeClass("hide"))}),fn.doSearch(e,"search-input","search-output"))},switchLayout:function(){var a="layout";switch(localStorage.getItem(a)||"grid"){case"grid":$(".container .list-layout").hide(),$(".container .grid-layout").show(),$(".container").removeClass("list-layout").addClass("grid-layout"),$(".switch-box .gridBtn").addClass("active").siblings().removeClass("active");break;case"list":$(".container .grid-layout").hide(),$(".container .list-layout").show(),$(".container").removeClass("grid-layout").addClass("list-layout"),$(".switch-box .listBtn").addClass("active").siblings().removeClass("active")}$(".switch-box .siwtch-layout-btn").on("click",function(e){$(window).scrollTop();$(this).hasClass("gridBtn")&&(localStorage.setItem(a,"grid"),$(".container").removeClass("list-layout").addClass("grid-layout"),$(".container .grid-layout").fadeIn(300,function(){}),$(".container .list-layout").fadeOut()),$(this).hasClass("listBtn")&&(localStorage.setItem(a,"list"),$(".container").removeClass("grid-layout").addClass("list-layout"),$(".container .list-layout").fadeIn(300,function(){CONFIG.lazyload.enable&&action.lazyload({container:$(".container .list-layout"),threshold:500})}),$(".container .grid-layout").fadeOut()),$(this).addClass("active").siblings().removeClass("active")})},extraAction:function(){if(ZHAOO.utils.includes(location.pathname,["/board/","/references/",/lab/])){var e=document.querySelector(".article .wrap .main .extra");e&&(e.style.display="none")}var a=$("#motto");a.on("click",function(){var e=a.data("href");e&&window.open(e,"_blank")}),ZHAOO.utils.setColorMode("light"),action.celebrate(),"dark"===ZHAOO.utils.getModeStorage()&&document.querySelectorAll("#js_content  *").forEach(function(e){var a=e.style.backgroundColor;["rgb(255, 255, 255)","#fff","#ffffff"].includes(a)&&(e.style.backgroundColor="var(--color-background)")})},celebrate:function(){var e={"12-21":{action:action.snowing},"12-24":{action:action.snowing},"12-25":{action:action.snowing}}[ZHAOO.utils.todayString()];e&&e.action&&e.action()},autoIframe:function(){var t=["jinshuju.net"];window.addEventListener("message",function(a){if(t.some(function(e){return-1<a.origin.indexOf(e)})){var e=a.data||{};"heightChanged"===e.event&&(document.querySelector("iframe").scrolling="auto",document.querySelector("iframe").height=e.value,document.querySelector("iframe").style.height=e.value+"px")}})},snowing:function(){var e=document.createElement("div"),a=Math.max(window.innerHeight,document.documentElement.clientHeight,document.body.clientHeight);e.setAttribute("class","merry-christmas"),e.setAttribute("id","merry-christmas"),e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.zIndex="9999",e.style.pointerEvents="none",e.style.width="100%",e.style.height=a+"px",document.body.appendChild(e),ZHAOO.utils.setColorMode("dark"),setTimeout(function(){var e,a;window.Snow&&new window.Snow("#merry-christmas",{image:["/images/snow/snow.png"],vx:[-2,2],vy:[1,3],radius:(e=[1,12],a=window.devicePixelRatio||1,e.map(function(e){return e*a}))})},0)},loadFontFace:function(){$("head").append($('\n        <style type="text/css">\n        @font-face {\n          font-family: \'ming\';\n          src: url("https://cdn.jsdelivr.net/gh/small-rose/small-rose.github.io/box/font/GuDianMingChaoTi.otf");\n        }\n        \n        @font-face {\n          font-family: \'ming2\';\n          src: url("/fonts/WenYue-GuDian.otf");\n        }\n        \n        @font-face {\n          font-family: \'HanaMinA\';\n          src: url("/fonts/HanaMinA.ttf");\n        }\n        \n        @font-face {\n          font-family: \'HanaMinB\';\n          src: url("/fonts/HanaMinB.ttf");\n        }\n        </style>\n      ')),sessionStorage.setItem(SESSION_KEY,1)}};$(function(){var e=sessionStorage.getItem(SESSION_KEY);action.smoothScroll(),action.loading(window.loadingDuration||500),action.fab(),action.navbar(),action.menu(),action.scroolToTop(),action.scroolToComment(),action.preview(),action.switchLayout(),action.extraAction(),action.autoIframe(),CONFIG.fancybox&&action.fancybox(),CONFIG.pjax&&action.pjax(),CONFIG.lazyload.enable&&action.lazyload(),CONFIG.donate.enable&&action.donate(),CONFIG.lazyload&&CONFIG.fancybox&&action.fixLazyloadFancybox(),CONFIG.carrier.enable&&action.carrier(),CONFIG.qrcode.enable&&action.qrcode(),CONFIG.toc.enable&&action.toc(),"simple"===CONFIG.scrollbar.type&&action.scrollbar(),CONFIG.notification.enable&&action.notification(),console.log("page ready",e),e&&action.loadFontFace(),window.addEventListener("load",function(){!e&&action.loadFontFace(),console.log("page load"),CONFIG.search.enable&&setTimeout(function(){CONFIG.search.enable&&action.search()},200)})})}(jQuery);